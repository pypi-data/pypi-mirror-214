"use strict";(self.webpackChunkcontributor=self.webpackChunkcontributor||[]).push([[162],{5162:(ot,b,o)=>{o.r(b),o.d(b,{WidgetsModule:()=>V});var u=o(6895),c=o(4006),y=o(8281),l=o(1914),m=o(6188),P=o(577),t=o(4650),p=o(9341),d=o(4004),A=o(7579),M=o(9841),L=o(3900),U=o(2722),x=o(5698),f=o(4782),I=o(9300),N=o(8372),W=o(7653),O=o(4109),T=o(7278),k=o(3724),w=o(2663);let F=(()=>{class n{constructor(e){this.modal=e}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(l.bj))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-widget-hint"]],decls:19,vars:12,consts:[[1,"hint"],["name","check"],["kind","secondary","aspect","basic",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"pa-modal-dialog")(1,"pa-modal-title"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"pa-modal-content")(5,"div",0),t._UZ(6,"pa-icon",1),t.TgZ(7,"div"),t._uU(8),t.ALo(9,"translate"),t.qZA()(),t.TgZ(10,"div",0),t._UZ(11,"pa-icon",1),t.TgZ(12,"div"),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.TgZ(15,"pa-modal-footer")(16,"pa-button",2),t.NdJ("click",function(){return i.modal.close()}),t._uU(17),t.ALo(18,"translate"),t.qZA()()()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,4,"stash.widgets.recommendations")),t.xp6(6),t.Oqu(t.lcZ(9,6,"stash.widgets.hint_1")),t.xp6(5),t.Oqu(t.lcZ(14,8,"stash.widgets.hint_2")),t.xp6(4),t.hij(" ",t.lcZ(18,10,"generic.close")," "))},dependencies:[O.r,T.o,k.h,w.vP,w.If,w.jh,m.X$],styles:['@charset "UTF-8";.hint[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}']}),n})();var G=o(9892),S=o(8833),$=o(1481),J=o(4821),j=o(8711);function R(n,a){if(1&n&&(t.TgZ(0,"div",10),t._UZ(1,"span",11),t.ALo(2,"translate"),t.TgZ(3,"a",12),t.ALo(4,"async"),t._uU(5),t.ALo(6,"translate"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,3,"stash.widgets.publish_kb"),t.oJD),t.xp6(2),t.Q6J("routerLink",t.lcZ(4,5,e.homeUrl)),t.xp6(2),t.Oqu(t.lcZ(6,7,"stash.widgets.publish_kb_link"))}}function E(n,a){if(1&n&&(t.TgZ(0,"div",5),t._UZ(1,"pa-icon",6),t.TgZ(2,"div",7),t._UZ(3,"div",8),t.ALo(4,"translate"),t.YNc(5,R,7,9,"div",9),t.ALo(6,"async"),t.qZA()()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("innerHTML",t.lcZ(4,2,"stash.widgets.warning"),t.oJD),t.xp6(2),t.Q6J("ngIf",t.lcZ(6,4,e.showLink))}}function Y(n,a){1&n&&(t.TgZ(0,"pa-toggle",33),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"stash.widgets.suggestLabels")," "))}function H(n,a){1&n&&(t.TgZ(0,"pa-toggle",34),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"stash.widgets.answers")," "))}function D(n,a){1&n&&(t.TgZ(0,"pa-toggle",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"stash.widgets.onlyAnswers")," "))}function Q(n,a){1&n&&(t.TgZ(0,"pa-toggle",36),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"stash.widgets.synonyms")," "))}function q(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"pa-button",37),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.copy())}),t._uU(1," Copy snippet "),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("icon",e.copyIcon)}}function z(n,a){1&n&&(t.TgZ(0,"div",5),t._UZ(1,"pa-icon",38),t.TgZ(2,"div",7)(3,"div",39),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",40),t._uU(7),t.ALo(8,"translate"),t.qZA()()()),2&n&&(t.xp6(4),t.hij(" ",t.lcZ(5,2,"stash.widgets.warning-dangerous-snippet")," "),t.xp6(3),t.Oqu(t.lcZ(8,4,"stash.widgets.warning-dangerous-snippet-details")))}function K(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"form",13)(1,"div",14)(2,"section",15)(3,"h3"),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"pa-input",16),t.NdJ("valueChange",function(s){t.CHM(e);const g=t.oxw();return t.KtG(g.placeholder=s)})("valueChange",function(s){t.CHM(e);const g=t.oxw();return t.KtG(g.onPlaceholderChange(s))}),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"div",17)(10,"pa-toggle",18),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.YNc(13,Y,3,3,"pa-toggle",19),t.ALo(14,"async"),t.TgZ(15,"pa-toggle",20),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.YNc(18,H,3,3,"pa-toggle",21),t.ALo(19,"async"),t.YNc(20,D,3,3,"pa-toggle",22),t.ALo(21,"async"),t.TgZ(22,"pa-toggle",23),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"pa-toggle",24),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"pa-toggle",25),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"pa-toggle",26),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.YNc(34,Q,3,3,"pa-toggle",27),t.ALo(35,"async"),t.TgZ(36,"pa-toggle",28),t._uU(37),t.ALo(38,"translate"),t.qZA()()(),t.TgZ(39,"section",29)(40,"h3"),t._uU(41),t.ALo(42,"translate"),t.TgZ(43,"pa-button",30),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.showHints())}),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.YNc(46,q,2,1,"pa-button",31),t.qZA(),t.YNc(47,z,9,6,"div",1),t.ALo(48,"async"),t.TgZ(49,"pre")(50,"code",32),t._uU(51),t.qZA()()()()()}if(2&n){const e=t.oxw();t.Q6J("formGroup",e.mainForm),t.xp6(4),t.Oqu(t.lcZ(5,20,"stash.widgets.configuration")),t.xp6(2),t.Q6J("value",e.placeholder),t.xp6(1),t.hij(" ",t.lcZ(8,22,"stash.widgets.placeholder")," "),t.xp6(4),t.hij(" ",t.lcZ(12,24,"stash.widgets.suggestions")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(14,26,e.isTrainingEnabled)),t.xp6(3),t.hij(" ",t.lcZ(17,28,"stash.widgets.filter")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(19,30,e.areAnswersEnabled)),t.xp6(2),t.Q6J("ngIf",t.lcZ(21,32,e.areAnswersEnabled)),t.xp6(3),t.hij(" ",t.lcZ(24,34,"stash.widgets.relations")," "),t.xp6(3),t.hij(" ",t.lcZ(27,36,"stash.widgets.navigateToLink")," "),t.xp6(3),t.hij(" ",t.lcZ(30,38,"stash.widgets.navigateToFile")," "),t.xp6(3),t.hij(" ",t.lcZ(33,40,"stash.widgets.permalink")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(35,42,e.areSynonymsEnabled)),t.xp6(3),t.hij(" ",t.lcZ(38,44,"stash.widgets.autofilter")," "),t.xp6(4),t.hij(" ",t.lcZ(42,46,"stash.widgets.snippet")," "),t.xp6(3),t.hij(" ",t.lcZ(45,48,"stash.widgets.recommendations")," "),t.xp6(2),t.Q6J("ngIf",e.clipboardSupported),t.xp6(1),t.Q6J("ngIf",t.lcZ(48,50,e.showWarning)),t.xp6(4),t.Oqu(e.snippet)}}const X={features:[]},C="NUCLIA_WIDGETS_CONFIGURATION",B=[{path:"",component:(()=>{class n{get mainFormFeatures(){return this.mainForm?.controls.features.value||{}}get features(){return Object.entries(this.mainFormFeatures).reduce((e,[i,s])=>(s&&(e=`${e.length>0?e+",":""}${i}`),e),"")}constructor(e,i,s,g,v,Z,h,tt,et,nt){this.fb=e,this.sanitized=i,this.cdr=s,this.backendConfig=g,this.tracking=v,this.translation=Z,this.modalService=h,this.sdk=tt,this.navigation=et,this.stateService=nt,this.localStorage=(0,t.f3M)(G.H3),this.showWarning=this.sdk.currentKb.pipe((0,d.U)(r=>"PRIVATE"===r.state)),this.showLink=this.sdk.currentKb.pipe((0,d.U)(r=>!!r.admin&&"PRIVATE"===r.state)),this.homeUrl=this.navigation.homeUrl,this.validationMessages={title:{sluggable:"stash.widgets.invalid-id"}},this.snippet="",this.snippetPreview="",this.unsubscribeAll=new A.x,this.clipboardSupported=!(!navigator.clipboard||!navigator.clipboard.writeText),this.copyIcon="copy",this.isTrainingEnabled=this.tracking.isFeatureEnabled("training").pipe((0,f.d)(1)),this.areAnswersEnabled=this.tracking.isFeatureEnabled("answers").pipe((0,f.d)(1)),this.areSynonymsEnabled=(0,M.a)([this.tracking.isFeatureEnabled("manage-synonyms").pipe((0,f.d)(1)),this.stateService.account.pipe((0,I.h)(r=>!!r),(0,d.U)(r=>r?.type))]).pipe((0,d.U)(([r,it])=>r&&"stash-business"===it)),this.debouncePlaceholder=new A.x;const _=this.localStorage.getItem(C);if(_)try{this.widgetConfigurations=JSON.parse(_)}catch{this.widgetConfigurations={},this.localStorage.setItem(C,"{}")}else this.widgetConfigurations={};this.preloadAlternativeWidget()}ngOnInit(){this.sdk.currentKb.pipe((0,L.w)(e=>{const i=this.widgetConfigurations[e.id]||X;return this.placeholder=i.placeholder,this.mainForm=this.fb.group({features:this.fb.group({autofilter:[i.features.includes("autofilter")],answers:[i.features.includes("answers")],filter:[i.features.includes("filter")],navigateToFile:[i.features.includes("navigateToFile")],navigateToLink:[i.features.includes("navigateToLink")],onlyAnswers:[i.features.includes("onlyAnswers")],permalink:[i.features.includes("permalink")],relations:[i.features.includes("relations")],suggestLabels:[i.features.includes("suggestLabels")],suggestions:[i.features.includes("suggestions")],useSynonyms:[i.features.includes("useSynonyms")]})}),setTimeout(()=>this.generateSnippet(),100),this.mainForm.valueChanges}),(0,U.R)(this.unsubscribeAll)).subscribe(()=>{this.onFormChange(),this.mainForm?.markAsDirty()}),this.debouncePlaceholder.pipe((0,N.b)(500)).subscribe(e=>{this.placeholder=e||void 0,this.onFormChange()})}ngOnDestroy(){this.unsubscribeAll.next(),this.unsubscribeAll.complete(),this.deletePreview()}deletePreview(){const e=document.querySelector("nuclia-search"),i=document.querySelector("nuclia-search-bar"),s=document.querySelector("nuclia-search-results");"function"==typeof e?.$destroy&&e.$destroy(),"function"==typeof i?.$destroy&&i.$destroy(),"function"==typeof s?.$destroy&&s.$destroy(),e?.remove(),i?.remove(),s?.remove()}generateSnippet(){this.deletePreview();const e=this.hasPlaceholder()?`\n  placeholder="${this.placeholder}"`:"";this.sdk.currentKb.pipe((0,x.q)(1)).subscribe(i=>{const s=this.sdk.nuclia.options.standalone?'standalone="true"':`zone="${this.sdk.nuclia.options.zone}"`,g='apikey="YOUR_API_TOKEN"',v="PRIVATE"===i.state?`\n  state="${i.state}"\n  account="${i.account}"\n  kbslug="${i.slug}"\n  ${g}`:"",Z=this.sdk.nuclia.options.standalone?`\n  backend="${this.backendConfig.getAPIURL()}"`:"",h=`<nuclia-search-bar\n  knowledgebox="${i.id}"\n  ${s}\n  features="${this.features}" ${e}${v}${Z}></nuclia-search-bar>\n<nuclia-search-results></nuclia-search-results>`;this.snippet=`<script src="https://cdn.nuclia.cloud/nuclia-video-widget.umd.js"><\/script>\n${h}`,this.snippetPreview=this.sanitized.bypassSecurityTrustHtml(h.replace("zone=",`client="dashboard" backend="${this.backendConfig.getAPIURL()}"\n      lang="${this.translation.currentLang}"\n      zone=`).replace("standalone=",'client="dashboard" standalone=').replace(g,""))}),(0,l.$)(this.cdr)}hasPlaceholder(){return!!this.placeholder}copy(){navigator.clipboard.writeText(this.snippet),this.copyIcon="check",(0,l.$)(this.cdr),setTimeout(()=>{this.copyIcon="copy",(0,l.$)(this.cdr)},1e3)}onPlaceholderChange(e){this.debouncePlaceholder.next(e)}showHints(){this.modalService.openModal(F)}preloadAlternativeWidget(){const e="old-widget-script";if(!document.querySelector(`#${e}`)){const i=window.document.createElement("script");i.id=e,i.type="text/javascript",i.async=!0,i.defer=!0,i.src=`${this.backendConfig.getCDN()}/nuclia-widget.umd.js`,window.document.body.appendChild(i)}}onFormChange(){this.generateSnippet(),this.sdk.currentKb.pipe((0,x.q)(1)).subscribe(e=>{this.widgetConfigurations[e.id]={features:this.features.split(","),placeholder:this.placeholder},this.localStorage.setItem(C,JSON.stringify(this.widgetConfigurations))})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c.j3),t.Y36($.H7),t.Y36(t.sBO),t.Y36(p.Fo),t.Y36(p.qE),t.Y36(l.sK),t.Y36(W.yp),t.Y36(p.rc),t.Y36(S.f5),t.Y36(p.b2))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-widget-generator"]],decls:12,vars:11,consts:[[1,"widget-generator"],["class","warning",4,"ngIf"],[1,"widget-preview"],["id","preview",1,"preview-container",3,"innerHtml"],[3,"formGroup",4,"ngIf"],[1,"warning"],["name","warning","size","large"],[1,"warning-content"],[1,"title-m",3,"innerHTML"],["class","publish-link body-m",4,"ngIf"],[1,"publish-link","body-m"],[3,"innerHTML"],[3,"routerLink"],[3,"formGroup"],[1,"snippet-configuration-container"],[1,"snippet-configuration"],[3,"value","valueChange"],["formGroupName","features",1,"widget-features"],["labelOnRight","","help","stash.widgets.suggestions.help","formControlName","suggestions"],["labelOnRight","","help","stash.widgets.suggestLabels.help","formControlName","suggestLabels",4,"ngIf"],["labelOnRight","","help","stash.widgets.filter.help","formControlName","filter"],["labelOnRight","","help","stash.widgets.answers.help","formControlName","answers",4,"ngIf"],["labelOnRight","","help","stash.widgets.onlyAnswers.help","formControlName","onlyAnswers",4,"ngIf"],["labelOnRight","","help","stash.widgets.relations.help","formControlName","relations"],["labelOnRight","","help","stash.widgets.navigateToLink.help","formControlName","navigateToLink"],["labelOnRight","","help","stash.widgets.navigateToFile.help","formControlName","navigateToFile"],["labelOnRight","","help","stash.widgets.permalink.help","formControlName","permalink"],["labelOnRight","","help","stash.widgets.synonyms.help","formControlName","useSynonyms",4,"ngIf"],["labelOnRight","","help","stash.widgets.autofilter.help","formControlName","autofilter"],[1,"snippet"],["aspect","basic","icon","info","iconAndText","",3,"click"],["aspect","basic","size","small",3,"icon","click",4,"ngIf"],[1,"highlight"],["labelOnRight","","help","stash.widgets.suggestLabels.help","formControlName","suggestLabels"],["labelOnRight","","help","stash.widgets.answers.help","formControlName","answers"],["labelOnRight","","help","stash.widgets.onlyAnswers.help","formControlName","onlyAnswers"],["labelOnRight","","help","stash.widgets.synonyms.help","formControlName","useSynonyms"],["aspect","basic","size","small",3,"icon","click"],["name","warning"],[1,"title-xxs"],[1,"body-m"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"h2"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,E,7,6,"div",1),t.ALo(5,"async"),t.TgZ(6,"div",2)(7,"h3"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t._UZ(10,"div",3),t.qZA(),t.YNc(11,K,52,52,"form",4),t.qZA()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,5,"stash.widgets.title")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(5,7,i.showWarning)),t.xp6(4),t.Oqu(t.lcZ(9,9,"stash.widgets.preview")),t.xp6(2),t.Q6J("innerHtml",i.snippetPreview,t.oJD),t.xp6(1),t.Q6J("ngIf",i.mainForm))},dependencies:[u.O5,y.rH,c._Y,c.JJ,c.JL,c.sg,c.u,c.x0,J.a,O.r,j.n,T.o,u.Ov,m.X$],styles:['@charset "UTF-8";.widget-generator[_ngcontent-%COMP%]{padding:3rem 6rem}.widget-generator[_ngcontent-%COMP%] > .warning[_ngcontent-%COMP%]{margin-bottom:2rem}.widget-generator[_ngcontent-%COMP%]   .snippet[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{margin-bottom:1rem}.widget-generator[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{align-items:center;background:hsl(51,100%,55%);display:flex;gap:.5rem;padding:.5rem}.widget-generator[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   .warning-content[_ngcontent-%COMP%]{flex-direction:column}.widget-generator[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   .warning-content[_ngcontent-%COMP%], .widget-generator[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   .publish-link[_ngcontent-%COMP%]{display:flex;gap:.25rem}.widget-generator[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:inherit;text-decoration:underline}.widget-generator[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]{display:flex;gap:1.5rem;margin-top:1.5rem}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{background:hsl(240,7%,97%);border-radius:.25rem;padding:1rem 1.5rem}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:300}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section.snippet-configuration[_ngcontent-%COMP%]{display:flex;flex:0 0 auto;flex-direction:column;gap:1rem;width:28rem}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section.snippet-configuration[_ngcontent-%COMP%]   .widget-features[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section.snippet[_ngcontent-%COMP%]{flex:1 0 auto;max-width:calc(100vw - 44.5rem)}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section.snippet[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.widget-generator[_ngcontent-%COMP%]   .snippet-configuration-container[_ngcontent-%COMP%]   section.snippet[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;word-break:break-all}'],changeDetection:0}),n})()}];let V=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,m.aw.forChild(),y.Bz.forChild(B),c.UX,l.p,l.w1,l.nc,P._J,l.v6,l.$Q]}),n})()}}]);