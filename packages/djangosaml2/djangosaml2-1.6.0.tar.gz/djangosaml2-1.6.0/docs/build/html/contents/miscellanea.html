<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SimpleSAMLphp issues &mdash; djangosaml2 0.2.4 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="Testing" href="developer.html" />
    <link href="../_static/custom.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="../_static/favicon.ico">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


    
    <a href="../index.html" id="logo_main"><img src="../_static/logo.jpg" class="logo" alt="Logo" /></a>



    <a id="title_under_logo" href="../index.html"> djangosaml2

</a>


    
    



<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html#users-attributes-and-account-linking">Users, attributes and account linking</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html#custom-user-attributes-processing">Custom user attributes processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html#urls">URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html#pysaml2-specific-files-and-configuration">PySAML2 specific files and configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html#test-idp">Test IdP</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer's</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html#unit-tests">Unit tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html#code-coverage">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html#custom-error-handler">Custom error handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html#contributing">Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellanea</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">SimpleSAMLphp issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="#okta-federation">Okta federation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
    <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
    <a href="../index.html">
        <img src="../_static/logo.jpg" class="logo" alt="Logo"/>
        </a>
    <a href="../index.html">
        djangosaml2
    </a>

      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">SimpleSAMLphp issues</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/contents/miscellanea.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simplesamlphp-issues">
<h1>SimpleSAMLphp issues<a class="headerlink" href="#simplesamlphp-issues" title="Permalink to this heading"></a></h1>
<p>As of SimpleSAMLphp 1.8.2 there is a problem if you specify attributes in
the SP configuration. When the SimpleSAMLphp metadata parser converts the
XML into its custom php format it puts the following option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;attributes.NameFormat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;urn:oasis:names:tc:SAML:2.0:attrname-format:uri&#39;</span>
</pre></div>
</div>
<p>But it need to be replaced by this one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;AttributeNameFormat&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;urn:oasis:names:tc:SAML:2.0:attrname-format:uri&#39;</span>
</pre></div>
</div>
<p>Otherwise the Assertions sent from the IdP to the SP will have a wrong
Attribute Name Format and pysaml2 will be confused.</p>
<p>Furthermore if you have a AttributeLimit filter in your SimpleSAMLphp
configuration  you will need to enable another attribute filter just
before to make sure that the AttributeLimit does not remove the attributes
from the authentication source. The filter you need to add is an AttributeMap
filter like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="o">=&gt;</span> <span class="n">array</span><span class="p">(</span>
           <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;core:AttributeMap&#39;</span><span class="p">,</span> <span class="s1">&#39;name2oid&#39;</span>
      <span class="p">),</span>
</pre></div>
</div>
</section>
<section id="okta-federation">
<h1>Okta federation<a class="headerlink" href="#okta-federation" title="Permalink to this heading"></a></h1>
<p>Okta settings to configure on your Idp’s SAML app advanced settings:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Single</span> <span class="n">Logout</span> <span class="n">URL</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">saml2</span><span class="o">/</span><span class="n">ls</span><span class="o">/</span><span class="n">post</span><span class="o">/</span>
<span class="n">SP</span> <span class="n">Issuer</span> <span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">saml2</span><span class="o">/</span><span class="n">metadata</span><span class="o">/</span>
</pre></div>
</div>
<p>Okta sample configuration for setting up an Okta SSO with Django:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="s1">&#39;service&#39;</span><span class="p">:</span> <span class="p">{</span>
 <span class="c1"># we are just a lonely SP</span>
 <span class="s1">&#39;sp&#39;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;XXX&#39;</span><span class="p">,</span>
     <span class="s1">&#39;allow_unsolicited&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
     <span class="s1">&#39;want_assertions_signed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># assertion signing (default=True)</span>
     <span class="s1">&#39;want_response_signed&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
     <span class="s2">&quot;want_assertions_or_response_signed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># is response signing required</span>
     <span class="s1">&#39;name_id_format&#39;</span><span class="p">:</span> <span class="n">NAMEID_FORMAT_UNSPECIFIED</span><span class="p">,</span>

     <span class="c1"># Must for signed logout requests</span>
     <span class="s2">&quot;logout_requests_signed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
     <span class="s1">&#39;endpoints&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="c1"># url and binding to the assetion consumer service view</span>
         <span class="c1"># do not change the binding or service name</span>
         <span class="s1">&#39;assertion_consumer_service&#39;</span><span class="p">:</span> <span class="p">[</span>
             <span class="p">(</span><span class="s1">&#39;http://localhost:8000/saml2/acs/&#39;</span><span class="p">,</span>
              <span class="n">saml2</span><span class="o">.</span><span class="n">BINDING_HTTP_POST</span><span class="p">),</span>
         <span class="p">],</span>
         <span class="c1"># url and binding to the single logout service view</span>
         <span class="c1"># do not change the binding or service name</span>
         <span class="s1">&#39;single_logout_service&#39;</span><span class="p">:</span> <span class="p">[</span>
             <span class="c1"># (&#39;http://localhost:8000/saml2/ls/&#39;,</span>
             <span class="c1">#  saml2.BINDING_HTTP_REDIRECT),</span>
             <span class="p">(</span><span class="s1">&#39;http://localhost:8000/saml2/ls/post/&#39;</span><span class="p">,</span>
              <span class="n">saml2</span><span class="o">.</span><span class="n">BINDING_HTTP_POST</span><span class="p">),</span>
         <span class="p">],</span>
     <span class="p">},</span>
     <span class="c1"># Mandates that the identity provider MUST authenticate the</span>
     <span class="c1"># presenter directly rather than rely on a previous security context.</span>
     <span class="s1">&#39;force_authn&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

     <span class="s2">&quot;allow_unsolicited&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

     <span class="c1"># Enable AllowCreate in NameIDPolicy.</span>
     <span class="s1">&#39;name_id_format_allow_create&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

     <span class="c1"># attributes that this project need to identify a user</span>
     <span class="s1">&#39;required_attributes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>

     <span class="c1"># in this section the list of IdPs we talk to are defined</span>
     <span class="s1">&#39;idp&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="c1"># we do not need a WAYF service since there is</span>
         <span class="c1"># only an IdP defined here. This IdP should be</span>
         <span class="c1"># present in our metadata</span>

         <span class="c1"># the keys of this dictionary are entity ids</span>
         <span class="s1">&#39;https://xxx.okta.com/app/XXXXXXXXXX/sso/saml/metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
             <span class="c1"># Okta only uses HTTP_POST disable this</span>
             <span class="c1"># &#39;single_sign_on_service&#39;: {</span>
             <span class="c1">#     saml2.BINDING_HTTP_REDIRECT: &#39;https://xxx.okta.com/app/APPNAME/xxxxxxxxx/sso/saml&#39;,</span>
             <span class="c1"># },</span>
             <span class="s1">&#39;single_logout_service&#39;</span><span class="p">:</span> <span class="p">{</span>
                 <span class="n">saml2</span><span class="o">.</span><span class="n">BINDING_HTTP_POST</span><span class="p">:</span> <span class="s1">&#39;https://xxx.okta.com/app/APPNAME/xxxxxxxxxx/slo/saml&#39;</span><span class="p">,</span>
             <span class="p">},</span>
         <span class="p">},</span>
     <span class="p">},</span>

 <span class="p">},</span>
<span class="p">},</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="faq.html" class="btn btn-neutral float-right" title="FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="developer.html" class="btn btn-neutral" title="Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        2020, Giuseppe De Marco.

    </p>
  </div>

  <span style="font-size:0.8em">
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>.
  
   </span>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>