{"version":3,"file":"avatarSettingsFormView.js","names":["readyPromise","resolve","Promise","withResolver","Djblets","Avatars","SettingsFormView","Backbone","View","extend","events","initialize","console","assert","instance","_configForms","Map","_$config","$","services","model","get","listenTo","_showHideForms","_onSubmit","e","serviceID","currentForm","validate","preventDefault","renderForms","form","values","render","change","previousID","previous","previousForm","undefined","$el","hide","show","_onServiceChanged","$target","target","set","val","addConfigForm","formClass","el","ready"],"sources":["../../../../../../static/djblets/js/avatars/views/avatarSettingsFormView.es6.js"],"sourcesContent":["(function() {\n\n\nconst [readyPromise, resolve] = Promise.withResolver();\n\n\n/**\n * A form for managing the settings of avatar services.\n *\n * This form lets you select the avatar service you wish to use, as well as\n * configure the settings for that avatar service.\n */\nDjblets.Avatars.SettingsFormView = Backbone.View.extend({\n    events: {\n        'change #id_avatar_service_id': '_onServiceChanged',\n        'submit': '_onSubmit'\n    },\n\n    /**\n     * Initialize the form.\n     */\n    initialize() {\n        console.assert(Djblets.Avatars.SettingsFormView.instance === null);\n        Djblets.Avatars.SettingsFormView.instance = this;\n        this._configForms = new Map();\n\n        this._$config = this.$('.avatar-service-configuration');\n\n        const services = this.model.get('services');\n        this.listenTo(this.model, 'change:serviceID',\n                      () => this._showHideForms());\n\n        /*\n         * The promise continuations will only be executed once the stack is\n         * unwound.\n         */\n        resolve();\n    },\n\n    /**\n     * Validate the current form upon submission.\n     *\n     * Args:\n     *     e (Event):\n     *         The form submission event.\n     */\n    _onSubmit(e) {\n        const serviceID = this.model.get('serviceID');\n        const currentForm = this._configForms.get(serviceID);\n\n        if (currentForm && !currentForm.validate()) {\n            e.preventDefault();\n        }\n    },\n\n    /**\n     * Render the child forms.\n     *\n     * This will show the for the currently selected service if it has one.\n     *\n     * Returns:\n     *     Djblets.Avatars.SettingsFormView:\n     *     This view (for chaining).\n     */\n    renderForms() {\n        for (const form of this._configForms.values()) {\n            form.render();\n        }\n\n        /*\n         * Ensure that if the browser sets the value of the <select> upon\n         * refresh that we update the model accordingly.\n         */\n        this.$('#id_avatar_service_id').change();\n        this._showHideForms(true);\n\n        return this;\n    },\n\n    /**\n     * Show or hide the configuration form.\n     */\n    _showHideForms() {\n        const services = this.model.get('services');\n        const serviceID = this.model.get('serviceID');\n        const currentForm = this._configForms.get(serviceID);\n        const previousID = this.model.previous('serviceID');\n        const previousForm = previousID\n            ? this._configForms.get(previousID)\n            : undefined;\n\n        if (previousForm && currentForm) {\n            previousForm.$el.hide();\n            currentForm.$el.show();\n        } else if (previousForm) {\n            previousForm.$el.hide();\n            this._$config.hide();\n        } else if (currentForm) {\n            currentForm.$el.show();\n            this._$config.show();\n        }\n\n    },\n\n    /**\n     * Handle the service being changed.\n     *\n     * Args:\n     *     e (Event):\n     *         The change event.\n     */\n    _onServiceChanged(e) {\n        const $target = $(e.target);\n        this.model.set('serviceID', $target.val());\n    }\n}, {\n    /**\n     * The form instance.\n     */\n    instance: null,\n\n    /**\n     * Add a configuration form to the instance.\n     *\n     * Args:\n     *     serviceID (string):\n     *         The unique ID for the avatar service.\n     *\n     *     formClass (constructor):\n     *         The view to use for the form.\n     */\n    addConfigForm(serviceID, formClass) {\n        Djblets.Avatars.SettingsFormView.instance._configForms.set(\n            serviceID,\n            new formClass({\n                el: $(`[data-avatar-service-id=\"${serviceID}\"]`),\n                model: Djblets.Avatars.SettingsFormView.instance.model\n            }));\n    },\n\n    /**\n     * A promise that is resolved when the avatar services form has been\n     * initialized.\n     */\n    ready: readyPromise\n});\n\n\n})();\n"],"mappings":"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"}