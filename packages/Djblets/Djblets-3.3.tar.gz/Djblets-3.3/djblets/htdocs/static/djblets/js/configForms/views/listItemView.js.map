{"version":3,"file":"listItemView.js","names":["Djblets","Config","ListItemView","Backbone","View","extend","tagName","className","iconBaseClassName","itemStateClasses","disabled","enabled","error","actionHandlers","template","_","initialize","listenTo","model","render","showSpinner","hideSpinner","remove","$spinnerParent","$spinner","$el","empty","append","defaults","attributes","getRenderContext","_$itemState","$","_onItemStateChanged","addActions","getActionsParent","fadeOut","prototype","call","attr","addClass","prependTo","hide","css","fadeIn","removeAttr","$parentEl","$actions","actions","forEach","action","$action","_buildActionEl","appendTo","children","label","click","defer","_showActionDropdown","actionPos","position","$menu","minWidth","outerWidth","e","stopPropagation","$items","actionLeft","left","getExtents","childAction","id","trigger","parent","winWidth","window","width","paneWidth","move","offset","innerWidth","top","outerHeight","document","one","actionHandlerName","isCheckbox","type","isRadio","$result","inputID","uniqueId","name","$label","text","propName","bindProperty","radioValue","enabledPropName","inverse","enabledPropInverse","actionHandler","debounce","bind","change","dispatchOnClick","url","ariaLabel","iconName","prepend","evt","preventDefault","_onActionButtonClicked","danger","primary","prop","oldItemState","previous","itemState","get","removeClass","itemStateTexts","promise","then","childrenHTML","html","finally"],"sources":["../../../../../../static/djblets/js/configForms/views/listItemView.es6.js"],"sourcesContent":["/**\n * Display a list item for a config page.\n *\n * The list item will show information on the item and any actions that can\n * be invoked.\n *\n * By default, this will show the text from the ListItem model, linking it\n * if the model has an editURL attribute. This can be customized by subclasses\n * by overriding `template`.\n */\nDjblets.Config.ListItemView = Backbone.View.extend({\n    tagName: 'li',\n    className: 'djblets-c-config-forms-list__item',\n    iconBaseClassName: 'djblets-icon',\n\n    /**\n     * A mapping of item states to CSS classes.\n     *\n     * Subclasses can extend this to provide custom CSS classes, or support\n     * custom item states.\n     */\n    itemStateClasses: {\n        disabled: '-is-disabled',\n        enabled: '-is-enabled',\n        error: '-has-error',\n    },\n\n    actionHandlers: {},\n\n    template: _.template(dedent`\n        <% if (editURL) { %>\n        <a href=\"<%- editURL %>\"><%- text %></a>\n        <% } else { %>\n        <%- text %>\n        <% } %>\n    `),\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this.listenTo(this.model, 'actionsChanged', this.render);\n        this.listenTo(this.model, 'request', this.showSpinner);\n        this.listenTo(this.model, 'sync', this.hideSpinner);\n        this.listenTo(this.model, 'destroy', this.remove);\n\n        this.$spinnerParent = null;\n        this.$spinner = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * This will be called every time the list of actions change for\n     * the item.\n     *\n     * Returns:\n     *     Djblets.Config.ListItemView:\n     *     This view.\n     */\n    render() {\n        const model = this.model;\n\n        this.$el\n            .empty()\n            .append(this.template(_.defaults(\n                model.attributes,\n                this.getRenderContext()\n            )));\n\n        this._$itemState =\n            this.$('.djblets-c-config-forms-list__item-state');\n\n        this.listenTo(model, 'change:itemState', this._onItemStateChanged);\n        this._onItemStateChanged();\n\n        this.addActions(this.getActionsParent());\n\n        return this;\n    },\n\n    /**\n     * Return additional render context.\n     *\n     * By default this returns an empty object. Subclasses can use this to\n     * provide additional values to :js:attr:`template` when it is rendered.\n     *\n     * Returns:\n     *     object:\n     *     Additional rendering context for the template.\n     */\n    getRenderContext() {\n        return {};\n    },\n\n    /**\n     * Remove the item.\n     *\n     * This will fade out the item, and then remove it from view.\n     */\n    remove() {\n        this.$el.fadeOut('normal',\n                         () => Backbone.View.prototype.remove.call(this));\n    },\n\n    /**\n     * Return the container for the actions.\n     *\n     * This defaults to being this element, but it can be overridden to\n     * return a more specific element.\n     *\n     * Returns:\n     *     jQuery:\n     *     The container for the actions.\n     */\n    getActionsParent() {\n        return this.$el;\n    },\n\n    /**\n     * Display a spinner on the item.\n     *\n     * This can be used to show that the item is being loaded from the\n     * server.\n     */\n    showSpinner() {\n        if (this.$spinner) {\n            return;\n        }\n\n        this.$el.attr('aria-busy', 'true');\n        this.$spinner = $('<span>')\n            .addClass('djblets-o-spinner')\n            .attr('aria-hidden', 'true')\n            .prependTo(this.$spinnerParent)\n            .hide()\n            .css('visibility', 'visible')\n            .fadeIn();\n    },\n\n    /**\n     * Hide the currently visible spinner.\n     */\n    hideSpinner() {\n        if (!this.$spinner) {\n            return;\n        }\n\n        /*\n         * The slow fadeout does two things:\n         *\n         * 1) It prevents the spinner from disappearing too quickly\n         *    (in combination with the fadeIn above), in case the operation\n         *    is really fast, giving some feedback that something actually\n         *    happened.\n         *\n         * 2) By fading out, it doesn't look like it just simply stops.\n         *    Helps provide a sense of completion.\n         */\n        this.$spinner.fadeOut('slow', () => {\n            this.$spinner.remove();\n            this.$spinner = null;\n        });\n\n        this.$el.removeAttr('aria-busy');\n    },\n\n    /**\n     * Add all registered actions to the view.\n     *\n     * Args:\n     *     $parentEl (jQuery):\n     *         The parent element to add the actions to.\n     */\n    addActions($parentEl) {\n        const $actions = $('<span>')\n            .addClass('djblets-c-config-forms-list__item-actions');\n\n        this.model.actions.forEach(action => {\n            const $action = this._buildActionEl(action)\n                .appendTo($actions);\n\n            if (action.children) {\n                if (action.label) {\n                    $action.append(' &#9662;');\n                }\n\n                /*\n                 * Show the dropdown after we let this event propagate.\n                 */\n                $action.click(() => _.defer(\n                    () => this._showActionDropdown(action, $action)\n                ));\n            }\n        });\n\n        this.$spinnerParent = $actions;\n\n        $actions.prependTo($parentEl);\n    },\n\n    /**\n     * Show a dropdown for a menu action.\n     *\n     * Args:\n     *     action (object):\n     *         The action to show the dropdown for. See\n     *         :js:class:`Djblets.Config.ListItem`. for a list of attributes.\n     *\n     *     $action (jQuery):\n     *         The element that represents the action.\n     */\n    _showActionDropdown(action, $action) {\n        const actionPos = $action.position();\n        const $menu = $('<div/>')\n            .css({\n                minWidth: $action.outerWidth(),\n                position: 'absolute',\n            })\n            .addClass('djblets-c-config-forms-popup-menu')\n            .click(e => e.stopPropagation());\n        const $items = $('<ul/>')\n            .addClass('djblets-c-config-forms-popup-menu__items')\n            .appendTo($menu);\n        const actionLeft = actionPos.left + $action.getExtents('m', 'l');\n\n        action.children.forEach(\n            childAction => $('<li/>')\n                .addClass('djblets-c-config-forms-popup-menu__item ' +\n                          `config-forms-list-action-row-${childAction.id}`)\n                .append(this._buildActionEl(childAction))\n                .appendTo($items)\n        );\n\n        this.trigger('actionMenuPopUp', {\n            action: action,\n            $action: $action,\n            $menu: $menu,\n        });\n\n        $menu.appendTo($action.parent());\n\n        const winWidth = $(window).width();\n        const paneWidth = $menu.width();\n\n        $menu.move(($action.offset().left + paneWidth > winWidth\n                    ? actionLeft + $action.innerWidth() - paneWidth\n                    : actionLeft),\n                   actionPos.top + $action.outerHeight(),\n                   'absolute');\n\n        /* Any click outside this dropdown should close it. */\n        $(document).one('click', () => {\n            this.trigger('actionMenuPopDown', {\n                action: action,\n                $action: $action,\n                $menu: $menu,\n            });\n\n            $menu.remove();\n        });\n    },\n\n    /**\n     * Build the element for an action.\n     *\n     * If the action's type is ``'checkbox'``, a checkbox will be shown.\n     * Otherwise, the action will be shown as a button.\n     *\n     * Args:\n     *     action (object):\n     *         The action to show the dropdown for. See\n     *         :js:class:`Djblets.Config.ListItem` for a list of attributes.\n     */\n    _buildActionEl(action) {\n        const enabled = (action.enabled !== false);\n        const actionHandlerName = (enabled\n                                   ? this.actionHandlers[action.id]\n                                   : null);\n        const isCheckbox = (action.type === 'checkbox');\n        const isRadio = (action.type === 'radio');\n\n        let $action;\n        let $result;\n\n        if (isCheckbox || isRadio) {\n            const inputID = _.uniqueId('action_' + action.type);\n            $action = $('<input/>')\n                .attr({\n                    name: action.name,\n                    type: action.type,\n                    id: inputID\n                });\n            const $label = $('<label>')\n                .attr('for', inputID)\n                .text(action.label);\n\n            if (action.id) {\n                $label.addClass(`config-forms-list-action-label-${action.id}`);\n            }\n\n            $result = $('<span/>')\n                .append($action)\n                .append($label);\n\n            if (action.propName) {\n                if (isCheckbox) {\n                    $action.bindProperty('checked', this.model,\n                                         action.propName);\n                } else if (isRadio) {\n                    $action.bindProperty(\n                        'checked', this.model, action.propName, {\n                            radioValue: action.radioValue\n                        }\n                    );\n                }\n            }\n\n            if (action.enabledPropName) {\n                $action.bindProperty(\n                    'disabled', this.model, action.enabledPropName,\n                    {\n                        inverse: (action.enabledPropInverse !== true)\n                    });\n            }\n\n            if (actionHandlerName) {\n                const actionHandler = _.debounce(\n                    _.bind(this[actionHandlerName], this),\n                    50,\n                    true\n                );\n\n                $action.change(actionHandler);\n\n                if (isRadio && action.dispatchOnClick) {\n                    $action.click(actionHandler);\n                }\n            }\n        } else {\n            if (action.url) {\n                $action = $('<a class=\"btn\" role=\"button\">')\n                    .attr('href', action.url);\n            } else {\n                $action = $('<button type=\"button\">');\n            }\n\n            $result = $action;\n\n            if (action.label) {\n                $action.text(action.label);\n            }\n\n            if (action.ariaLabel) {\n                $action.attr('aria-label', action.ariaLabel);\n            }\n\n            if (action.iconName) {\n                $action.prepend($('<span>')\n                    .addClass(this.iconBaseClassName)\n                    .addClass(`${this.iconBaseClassName}-${action.iconName}`));\n            }\n\n            if (actionHandlerName) {\n                $action.click(evt => {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n\n                    this._onActionButtonClicked(evt, actionHandlerName,\n                                                $action);\n                });\n            }\n        }\n\n        $action.addClass('djblets-c-config-forms-list__item-action');\n\n        if (action.id) {\n            $action.addClass(`config-forms-list-action-${action.id}`);\n        }\n\n        if (action.danger) {\n            $action.addClass('-is-danger');\n        }\n\n        if (action.primary) {\n            $action.addClass('-is-primary');\n        }\n\n        if (!enabled) {\n            $action.prop('disabled', true);\n        }\n\n        return $result;\n    },\n\n    /**\n     * Handle changes to the item state.\n     *\n     * This will update the CSS class used on the item and any relevant text\n     * contained within the item to reflect the current state.\n     */\n    _onItemStateChanged() {\n        const model = this.model;\n        const oldItemState = model.previous('itemState');\n        const itemState = model.get('itemState');\n\n        if (oldItemState) {\n            this.$el.removeClass(this.itemStateClasses[oldItemState]);\n        }\n\n        if (itemState) {\n            this.$el.addClass(this.itemStateClasses[itemState]);\n\n            /*\n             * Note that if we didn't find an element in the template for\n             * this before, this is basically a no-op.\n             */\n            this._$itemState.text(model.itemStateTexts[itemState]);\n        }\n    },\n\n    /**\n     * Handle clicks on a list item action button.\n     *\n     * This will invoke the click handler on the view. If that handler\n     * returns a Promise, this will disable the button, replace its contents\n     * with a spinner, and then wait for the promise to resolve before\n     * setting the button's contents and enabled states back to normal.\n     *\n     * Args:\n     *     evt (jQuery.Event):\n     *         The click event on the button.\n     *\n     *     actionHandlerName (string):\n     *         The name of the action handler function to call.\n     *\n     *     $action (jQuery):\n     *         The action button that was clicked.\n     */\n    _onActionButtonClicked(evt, actionHandlerName, $action) {\n        const promise = this[actionHandlerName].call(this, evt);\n\n        if (promise && typeof promise.then === 'function') {\n            $action.prop('disabled', true);\n\n            const childrenHTML = $action.html();\n            $action.empty();\n\n            const $spinner = $('<span class=\"djblets-o-spinner\">')\n                .appendTo($action);\n\n            /*\n             * This is a promise, so there's an async operation\n             * going on. Set up the spinner.\n             */\n            promise.finally(() => {\n                $spinner.remove();\n                $action.html(childrenHTML);\n                $action.prop('disabled', false);\n            });\n        }\n    },\n});\n"],"mappings":"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"}