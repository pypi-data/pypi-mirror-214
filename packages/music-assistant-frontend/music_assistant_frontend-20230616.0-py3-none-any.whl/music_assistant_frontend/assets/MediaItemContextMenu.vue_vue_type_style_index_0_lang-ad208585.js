import{l as X,r as A,c as G,$ as ae,P as te,q as r,v as m,x as i,j as s,L as b,J as P,M as v,A as V,k as ie,K as I,ao as ne,ap as B,I as oe,w as se,y as h,z as E,F as N,B as R,N as u,R as k,a4 as J,aq as re,ar as _,Z as T}from"./index-4ed1b7ec.js";import{_ as Q,h as ue,p as de}from"./MediaItemThumb.vue_vue_type_style_index_0_lang-00aa6de8.js";import{c as pe,V as F}from"./VMenu-33b23cd5.js";import{V as ce,a as me,b as D,P as ye}from"./ListviewItem.vue_vue_type_script_setup_true_lang-0ef9dac8.js";import{V as $,d as fe,i as q,c as W,g as U,a as x}from"./VCard-d28303d2.js";import{j as L,V as j}from"./VBtn-59a8c524.js";import{V as be,_ as ve}from"./ProviderIcon.vue_vue_type_script_setup_true_lang-68d20eb3.js";import{V as ge,b as H}from"./VToolbar-0f623306.js";import{V as he}from"./VDivider-2f28134f.js";import{a as _e,V as ke}from"./VSelect-e1d1d1d7.js";import{V as Ae}from"./VDialog-1d6b20ef.js";const qe=X({__name:"PanelviewItem",props:{item:{},size:{default:200},isSelected:{type:Boolean},showCheckboxes:{type:Boolean,default:!1},showTrackNumber:{type:Boolean,default:!0}},emits:["menu","click","select"],setup(e,{emit:n}){const l=e,c=A(!1),g=G(()=>{for(const a of l.item.provider_mappings)if(a.content_type!=null&&a.content_type in[B.DSF,B.FLAC,B.AIFF,B.WAV]&&(a.sample_rate>48e3||a.bit_depth>16))return`${a.sample_rate}kHz ${a.bit_depth} bits`;return""});return(a,y)=>{const C=ae("hold");return te((r(),m(W,{class:"panel-item",onClick:y[1]||(y[1]=f=>a.showCheckboxes?null:n("click",a.item)),onContextmenu:y[2]||(y[2]=ne(f=>a.showCheckboxes?null:n("menu",a.item),["right","prevent"])),onMouseover:y[3]||(y[3]=f=>c.value=!0),onMouseleave:y[4]||(y[4]=f=>c.value=!0)},{default:i(()=>[a.showCheckboxes?(r(),m(pe,{key:0,"model-value":a.showCheckboxes,contained:"",scrim:a.isSelected?a.$vuetify.theme.current.dark?"rgba(0,0,0,.75)":"rgba(255,255,255,.75)":"#ffffff00",onClick:y[0]||(y[0]=f=>{n("select",a.item,!a.isSelected)})},{default:i(()=>[s(ce,{class:"panel-item-checkbox",ripple:!1,"model-value":a.isSelected},null,8,["model-value"])]),_:1},8,["model-value","scrim"])):b("",!0),s(Q,{item:a.item,width:"100%"},null,8,["item"]),s($,{class:"list-item-main",style:{"padding-left":"0px !important","padding-right":"0px !important","padding-top":"10px !important"}},{default:i(()=>[s(fe,{class:"line-clamp-1"},{default:i(()=>[P(v(a.item.name)+" "+v("version"in a.item&&a.item.version?`- ${a.item.version}`:""),1)]),_:1}),"artists"in a.item&&a.item.artists?(r(),m(q,{key:0,class:"line-clamp-1"},{default:i(()=>[P(v(V(ue)(a.item.artists,1)),1)]),_:1})):"owner"in a.item&&a.item.owner?(r(),m(q,{key:1,class:"line-clamp-1"},{default:i(()=>[P(v(a.item.owner),1)]),_:1})):b("",!0),a.item&&a.item.media_type==="track"?(r(),m(me,{key:2,style:{"min-height":"22px","padding-top":"5px"}},{default:i(()=>[s(D,null,{default:i(()=>[V(de)(a.item.metadata.explicit||!1)?(r(),m(L,{key:0,icon:"mdi-alpha-e-box"})):b("",!0)]),_:1}),s(D,null,{default:i(()=>[g.value?(r(),m(be,{key:0,bottom:""},{activator:i(({props:f})=>[s(L,ie(f,{icon:"mdi-quality-high"}),null,16)]),default:i(()=>[I("span",null,v(g.value),1)]),_:1})):b("",!0)]),_:1}),"disc_number"in a.item&&a.item.disc_number&&a.showTrackNumber?(r(),m(D,{key:0},{default:i(()=>[s(L,{style:{"margin-left":"5px"},icon:"md:album"}),P(" "+v(a.item.disc_number),1)]),_:1})):b("",!0),"track_number"in a.item&&a.item.track_number&&a.showTrackNumber?(r(),m(D,{key:1},{default:i(()=>[s(L,{style:{"margin-left":"5px"},icon:"mdi-music-circle-outline"}),P(" "+v(a.item.track_number),1)]),_:1})):b("",!0)]),_:1})):b("",!0)]),_:1})]),_:1})),[[C,()=>a.showCheckboxes?null:n("menu",a.item)]])}}});const Ve={key:0},Ce={class:"media-thumb"},we={key:0},S=function(e){var n;for(const l of e.provider_mappings)if(l.available&&((n=u.providers[l.provider_instance])!=null&&n.available))return!0;return!1},Pe=function(e){var n;for(const l of e.provider_mappings)if((n=u.providers[l.provider_instance])!=null&&n.supported_features.includes(J.SIMILAR_TRACKS))return!0;return!1},Ie=function(e,n){const l=[];if(e.length==0||!S(e[0]))return l;let c=_.PLAY,g=_.NEXT;return(e.length>10||[k.ALBUM,k.PLAYLIST].includes(e[0].media_type))&&(c=_.REPLACE,g=_.REPLACE_NEXT),e.length==1&&n&&n.media_type==k.PLAYLIST&&l.push({label:"play_playlist_from",action:()=>{u.playPlaylistFromIndex(n,e[0].position||0)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length==1&&n&&n.media_type==k.ALBUM&&l.push({label:"play_album_from",action:()=>{u.playAlbumFromItem(n,e[0])},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),e.length<10?(l.push({label:"play_now",action:()=>{u.playMedia(e,_.PLAY)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),l.push({label:"play_now_replace",action:()=>{u.playMedia(e,_.REPLACE)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"})):l.push({label:"play_now",action:()=>{u.playMedia(e,_.REPLACE)},icon:"mdi-play-circle-outline",labelArgs:[],actionStr:"play"}),Pe(e[0])&&l.push({label:"play_radio",action:()=>{u.playMedia(e,c,!0)},icon:"mdi-radio-tower",labelArgs:[],actionStr:"play"}),(e.length===1||e[0].media_type===k.TRACK)&&l.push({label:"play_next",action:()=>{u.playMedia(e,g)},icon:"mdi-skip-next-circle-outline",labelArgs:[],actionStr:"play"}),l.push({label:"add_queue",action:()=>{u.playMedia(e,_.ADD)},icon:"mdi-playlist-plus",labelArgs:[],actionStr:"play"}),l},Se=function(e,n){const l=[];if(e.length==0)return l;if(e.length===1&&e[0]!==n&&S(e[0])&&l.push({label:"show_info",labelArgs:[],action:()=>{var c;T.push({name:e[0].media_type,params:{itemId:e[0].item_id,provider:e[0].provider},query:{album:"album"in e[0]?(c=e[0].album)==null?void 0:c.uri:""}})},icon:"mdi-information-outline"}),e.length===1&&S(e[0])&&"artists"in e[0]&&e[0].artists.length===1)for(const c of e[0].artists)l.push({label:"goto_artist",labelArgs:[c.name],action:()=>{T.push({name:"artist",params:{itemId:c.item_id,provider:c.provider}})},icon:"mdi-account-music"});if(e.length===1&&S(e[0])&&"album"in e[0]&&e[0].album&&l.push({label:"goto_album",labelArgs:[e[0].album.name],action:()=>{T.push({name:"album",params:{itemId:e[0].album.item_id,provider:e[0].album.provider}})},icon:"mdi-album"}),e.length===1&&(e[0]==n||!S(e[0]))&&l.push({label:"refresh_item",labelArgs:[],action:async()=>{await u.refreshItem(e[0]),T.go(0)},icon:"mdi-refresh"}),!e[0].in_library&&S(e[0])&&l.push({label:"add_library",labelArgs:[],action:()=>{u.addItemsToLibrary(e)},icon:"mdi-heart-outline"}),e[0].in_library&&l.push({label:"remove_library",labelArgs:[],action:()=>{u.removeItemsFromLibrary(e)},icon:"mdi-heart"}),n&&n.media_type===k.PLAYLIST){const c=n;e[0].media_type===k.TRACK&&c.is_editable&&l.push({label:"remove_playlist",labelArgs:[],action:()=>{u.removePlaylistTracks(c.item_id,e.map(g=>g.position))},icon:"mdi-minus-circle-outline"})}return e[0].media_type==="track"&&l.push({label:"add_playlist",labelArgs:[],actionStr:"add_playlist",icon:"mdi-plus-circle-outline"}),e.length==1&&e[0].provider=="database"&&l.push({label:"delete_db",labelArgs:[],action:()=>{u.deleteDbItem(e[0].media_type,e[0].item_id,!0),n&&n.item_id==e[0].item_id&&T.push({name:`${n.media_type}s`})},icon:"mdi-cancel"}),e.length>1&&l.push({label:"clear_selection",labelArgs:[],actionStr:"clear",icon:"mdi-cancel"}),l},Ke=X({__name:"MediaItemContextMenu",props:{items:{},parentItem:{default:void 0},modelValue:{type:Boolean},enablePlayItems:{type:Boolean,default:!0},enableActionMenuItems:{type:Boolean,default:!0},fullscreen:{type:Boolean,default:!0}},emits:["refresh","clear","update:modelValue","update:items"],setup(e,{emit:n}){const l=e,{t:c}=oe(),g=A([]),a=A([]),y=A(""),C=A([]),f=A(!1),K=A("");se(()=>l.modelValue,t=>{t&&Z()});const Z=async function(){if(f.value=!1,C.value=[],!l.items)return;l.items.length===1?y.value=l.items[0].name:y.value=c("items_selected",[l.items.length]).toString(),R.selectedPlayer&&R.selectedPlayer.available?a.value=Ie(l.items,l.parentItem):a.value=[];let t=l.items[0],d=0;if("position"in t&&(d=t.position),t.provider!=="database"){try{t=await u.getItemByUri(l.items[0].uri)}catch{t=l.items[0]}"position"in t&&(t.position=d);const o=l.items;o[0]=t,n("update:items",o)}g.value=Se(l.items,l.parentItem),ee()},ee=async function(){C.value=[];const t=await u.getPlaylists();for(const d of t.items)d.is_editable&&!(l.parentItem&&l.parentItem.media_type===k.PLAYLIST&&d.item_id===l.parentItem.item_id)&&C.value.push(d)},Y=function(t){u.addPlaylistTracks(t.item_id,l.items.map(d=>d.uri)),M()},z=async function(t){const d=await u.createPlaylist(K.value,t);Y(d)},O=async function(t){t.actionStr=="add_playlist"?f.value=!0:t.actionStr=="clear"?(n("clear"),M()):t.action&&t.actionStr=="play"?(t.action(),n("clear"),M()):t.action&&(M(),t.action())},M=function(){l.items.length==1&&n("clear"),n("update:modelValue",!1)},le=G(()=>{var d,o;const t=[];for(const p in(d=u)==null?void 0:d.players){const w=(o=u)==null?void 0:o.players[p];w.synced_to||t.push({title:w.display_name,value:w.player_id})}return t.slice().sort((p,w)=>p.title.toUpperCase()>w.title.toUpperCase()?1:-1)});return(t,d)=>(r(),m(Ae,{"model-value":t.modelValue,fullscreen:t.$vuetify.display.mobile,"min-height":"80%",scrim:!0,"onUpdate:modelValue":d[3]||(d[3]=o=>t.$emit("update:modelValue",o))},{default:i(()=>[s(W,null,{default:i(()=>[s(ge,{color:"transparent",style:{padding:"10px 0px"},density:"compact",class:"titlebar"},{default:i(()=>[s(j,{icon:"mdi-play-circle-outline"}),f.value?(r(),m(H,{key:0,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(t.$t("add_playlist")),1),t.$vuetify.display.mobile?b("",!0):(r(),h("span",Ve," | "+v(y.value),1))]),_:1})):(r(),m(H,{key:1,style:{"padding-left":"10px"}},{default:i(()=>[I("b",null,v(y.value),1)]),_:1})),s(j,{icon:"mdi-close",dark:"",onClick:d[0]||(d[0]=o=>M())})]),_:1}),s(he),t.enablePlayItems&&!f.value&&a.value.length>0?(r(),m(U,{key:0},{default:i(()=>{var o;return[s(_e,{label:t.$t("play_on"),"model-value":(o=V(R).selectedPlayer)==null?void 0:o.player_id,items:le.value,"hide-details":"","onUpdate:modelValue":d[1]||(d[1]=p=>{V(R).selectedPlayer=V(u).players[p]})},null,8,["label","model-value","items"]),s(F,null,{default:i(()=>[(r(!0),h(N,null,E(a.value,p=>(r(),h("div",{key:p.label},[s($,{class:"list-item-main",title:t.$t(p.label,p.labelArgs),density:"default",onClick:w=>O(p)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(L,{icon:p.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]}),_:1})):b("",!0),t.enableActionMenuItems&&!f.value&&g.value.length>0?(r(),m(U,{key:1,style:{"padding-top":"0","margin-top":"-10px","padding-bottom":"0"}},{default:i(()=>[s(q,{style:{"margin-left":"10px"}},{default:i(()=>[P(v(t.$t("actions")),1)]),_:1}),s(F,null,{default:i(()=>[(r(!0),h(N,null,E(g.value,o=>(r(),h("div",{key:o.label},[s($,{class:"list-item-main",title:t.$t(o.label,o.labelArgs),density:"default",onClick:p=>O(o)},{prepend:i(()=>[s(x,{style:{"padding-right":"10px"}},{default:i(()=>[s(L,{icon:o.icon},null,8,["icon"])]),_:2},1024)]),_:2},1032,["title","onClick"])]))),128))]),_:1})]),_:1})):b("",!0),f.value?(r(),m(U,{key:2},{default:i(()=>[s(F,null,{default:i(()=>[(r(!0),h(N,null,E(C.value,o=>(r(),h("div",{key:o.item_id},[s($,{class:"list-item-main",ripple:"",density:"default",onClick:p=>Y(o)},{prepend:i(()=>[I("div",Ce,[s(Q,{item:o,size:50,width:"50px",height:"50px"},null,8,["item"])])]),title:i(()=>[I("div",null,v(o.name),1)]),subtitle:i(()=>[I("div",null,v(o.owner),1)]),append:i(()=>[o.provider_mappings?(r(),m(ye,{key:0,"provider-mappings":o.provider_mappings,height:20},null,8,["provider-mappings"])):b("",!0)]),_:2},1032,["onClick"])]))),128)),(r(!0),h(N,null,E(V(u).providers,o=>(r(),h("div",{key:o.instance_id},[o.supported_features.includes(V(J).PLAYLIST_CREATE)?(r(),h("div",we,[s($,{class:"list-item-main",ripple:""},{prepend:i(()=>[s(ve,{domain:o.domain,size:"40px",class:"media-thumb"},null,8,["domain"])]),title:i(()=>[s(ke,{label:t.$t("create_playlist",[o.name]),"append-icon":"mdi-playlist-plus",variant:"plain","hide-details":"","onUpdate:modelValue":d[2]||(d[2]=p=>{K.value=p}),"onClick:append":p=>z(o.instance_id),onKeydown:re(p=>z(o.instance_id),["enter"])},null,8,["label","onClick:append","onKeydown"])]),_:2},1024)])):b("",!0)]))),128))]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["model-value","fullscreen"]))}});export{Ke as _,qe as a,Ie as b,Se as g,S as i};
