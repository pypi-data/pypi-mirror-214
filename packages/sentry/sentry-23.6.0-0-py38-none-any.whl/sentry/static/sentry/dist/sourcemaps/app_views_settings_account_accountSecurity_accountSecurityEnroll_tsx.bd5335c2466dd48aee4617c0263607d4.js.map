{"version":3,"file":"chunks/app_views_settings_account_accountSecurity_accountSecurityEnroll_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/u2f/webAuthnHelper.tsx","webpack:///./app/components/u2f/u2finterface.tsx","webpack:///./app/components/u2f/u2fsign.tsx","webpack:///./app/utils/getPendingInvite.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/account/accountSecurity/accountSecurityEnroll.tsx","webpack:///./app/views/settings/account/accountSecurity/components/confirmHeader.tsx","webpack:///./app/views/settings/account/accountSecurity/components/removeConfirm.tsx"],"sourcesContent":["// Copyright (c) 2019 GitHub, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"),\n// to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,\n// and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n// DEALINGS IN THE SOFTWARE.\n\n// below is from https://github.com/github/webauthn-json/tree/66322fc5c12184c5269691ab5abaac79545a3916\n\nexport function base64urlToBuffer(baseurl64String: string): ArrayBuffer {\n  // Base64url to Base64\n  const padding = '=='.slice(0, (4 - (baseurl64String.length % 4)) % 4);\n  const base64String = baseurl64String.replace(/-/g, '+').replace(/_/g, '/') + padding;\n\n  // Base64 to binary string\n  const str = atob(base64String);\n\n  // Binary string to buffer\n  const buffer = new ArrayBuffer(str.length);\n  const byteView = new Uint8Array(buffer);\n  for (let i = 0; i < str.length; i++) {\n    byteView[i] = str.charCodeAt(i);\n  }\n  return buffer;\n}\n\nexport function bufferToBase64url(buffer: ArrayBuffer): string {\n  // Buffer to binary string\n  const byteView = new Uint8Array(buffer);\n  let str = '';\n  for (const charCode of byteView) {\n    str += String.fromCharCode(charCode);\n  }\n\n  // Binary string to base64\n  const base64String = btoa(str);\n\n  // Base64 to base64url\n  // We assume that the base64url string is well-formed.\n  const base64urlString = base64String\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n  return base64urlString;\n}\n","import {Component} from 'react';\nimport * as Sentry from '@sentry/react';\nimport * as cbor from 'cbor-web';\n\nimport {base64urlToBuffer, bufferToBase64url} from 'sentry/components/u2f/webAuthnHelper';\nimport {t, tct} from 'sentry/locale';\nimport ConfigStore from 'sentry/stores/configStore';\nimport {ChallengeData, Organization} from 'sentry/types';\nimport withOrganization from 'sentry/utils/withOrganization';\n\ntype TapParams = {\n  challenge: string;\n  response: string;\n  isSuperuserModal?: boolean;\n  superuserAccessCategory?: string;\n  superuserReason?: string;\n};\n\ntype Props = {\n  challengeData: ChallengeData;\n  flowMode: string;\n  onTap: ({\n    response,\n    challenge,\n    isSuperuserModal,\n    superuserAccessCategory,\n    superuserReason,\n  }: TapParams) => Promise<void>;\n  organization: Organization;\n  silentIfUnsupported: boolean;\n  children?: React.ReactNode;\n  style?: React.CSSProperties;\n};\n\ntype State = {\n  challengeElement: HTMLInputElement | null;\n  deviceFailure: string | null;\n  failCount: number;\n  formElement: HTMLFormElement | null;\n  hasBeenTapped: boolean;\n  isSafari: boolean;\n  isSupported: boolean | null;\n  responseElement: HTMLInputElement | null;\n};\n\nclass U2fInterface extends Component<Props, State> {\n  state: State = {\n    isSupported: null,\n    formElement: null,\n    challengeElement: null,\n    hasBeenTapped: false,\n    deviceFailure: null,\n    responseElement: null,\n    isSafari: false,\n    failCount: 0,\n  };\n\n  componentDidMount() {\n    const supported = !!window.PublicKeyCredential;\n\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({isSupported: supported});\n\n    const isSafari =\n      navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome');\n\n    if (isSafari) {\n      // eslint-disable-next-line react/no-did-mount-set-state\n      this.setState({\n        deviceFailure: 'safari: requires interaction',\n        isSafari,\n        hasBeenTapped: false,\n      });\n    }\n\n    if (supported && !isSafari) {\n      this.invokeU2fFlow();\n    }\n  }\n\n  getU2FResponse(data) {\n    if (!data.response) {\n      return JSON.stringify(data);\n    }\n\n    if (this.props.flowMode === 'sign') {\n      const authenticatorData = {\n        keyHandle: data.id,\n        clientData: bufferToBase64url(data.response.clientDataJSON),\n        signatureData: bufferToBase64url(data.response.signature),\n        authenticatorData: bufferToBase64url(data.response.authenticatorData),\n      };\n      return JSON.stringify(authenticatorData);\n    }\n    if (this.props.flowMode === 'enroll') {\n      const authenticatorData = {\n        id: data.id,\n        rawId: bufferToBase64url(data.rawId),\n        response: {\n          attestationObject: bufferToBase64url(data.response.attestationObject),\n          clientDataJSON: bufferToBase64url(data.response.clientDataJSON),\n        },\n        type: bufferToBase64url(data.type),\n      };\n      return JSON.stringify(authenticatorData);\n    }\n\n    throw new Error(`Unsupported flow mode '${this.props.flowMode}'`);\n  }\n\n  submitU2fResponse(promise) {\n    promise\n      .then(data => {\n        this.setState(\n          {\n            hasBeenTapped: true,\n          },\n          () => {\n            const u2fResponse = this.getU2FResponse(data);\n            const challenge = JSON.stringify(this.props.challengeData);\n\n            if (this.state.responseElement) {\n              // eslint-disable-next-line react/no-direct-mutation-state\n              this.state.responseElement.value = u2fResponse;\n            }\n\n            if (!this.props.onTap) {\n              this.state.formElement?.submit();\n              return;\n            }\n\n            this.props\n              .onTap({\n                response: u2fResponse,\n                challenge,\n              })\n              .catch(() => {\n                // This is kind of gross but I want to limit the amount of changes to this component\n                this.setState({\n                  deviceFailure: 'UNKNOWN_ERROR',\n                  hasBeenTapped: false,\n                });\n              });\n          }\n        );\n      })\n      .catch(err => {\n        let failure = 'DEVICE_ERROR';\n        // in some rare cases there is no metadata on the error which\n        // causes this to blow up badly.\n        if (err.metaData) {\n          if (err.metaData.type === 'DEVICE_INELIGIBLE') {\n            if (this.props.flowMode === 'enroll') {\n              failure = 'DUPLICATE_DEVICE';\n            } else {\n              failure = 'UNKNOWN_DEVICE';\n            }\n          } else if (err.metaData.type === 'BAD_REQUEST') {\n            failure = 'BAD_APPID';\n          }\n        }\n        // we want to know what is happening here.  There are some indicators\n        // that users are getting errors that should not happen through the\n        // regular u2f flow.\n        Sentry.captureException(err);\n        this.setState({\n          deviceFailure: failure,\n          hasBeenTapped: false,\n          failCount: this.state.failCount + 1,\n        });\n      });\n  }\n\n  webAuthnSignIn(publicKeyCredentialRequestOptions) {\n    const promise = navigator.credentials.get({\n      publicKey: publicKeyCredentialRequestOptions,\n    });\n    this.submitU2fResponse(promise);\n  }\n\n  webAuthnRegister(publicKey) {\n    const promise = navigator.credentials.create({\n      publicKey,\n    });\n    this.submitU2fResponse(promise);\n  }\n\n  invokeU2fFlow() {\n    if (this.props.flowMode === 'sign') {\n      const challengeArray = base64urlToBuffer(\n        this.props.challengeData.webAuthnAuthenticationData\n      );\n      const challenge = cbor.decodeFirst(challengeArray);\n      challenge\n        .then(data => {\n          this.webAuthnSignIn(data);\n        })\n        .catch(err => {\n          const failure = 'DEVICE_ERROR';\n          Sentry.captureException(err);\n          this.setState({\n            deviceFailure: failure,\n            hasBeenTapped: false,\n          });\n        });\n    } else if (this.props.flowMode === 'enroll') {\n      const challengeArray = base64urlToBuffer(\n        this.props.challengeData.webAuthnRegisterData\n      );\n      const challenge = cbor.decodeFirst(challengeArray);\n      // challenge contains a PublicKeyCredentialRequestOptions object for webauthn registration\n      challenge\n        .then(data => {\n          this.webAuthnRegister(data.publicKey);\n        })\n        .catch(err => {\n          const failure = 'DEVICE_ERROR';\n          Sentry.captureException(err);\n          this.setState({\n            deviceFailure: failure,\n            hasBeenTapped: false,\n          });\n        });\n    } else {\n      throw new Error(`Unsupported flow mode '${this.props.flowMode}'`);\n    }\n  }\n\n  onTryAgain = () => {\n    this.setState(\n      {hasBeenTapped: false, deviceFailure: null},\n      () => void this.invokeU2fFlow()\n    );\n  };\n\n  bindChallengeElement: React.RefCallback<HTMLInputElement> = ref => {\n    this.setState({\n      challengeElement: ref,\n      formElement: ref && ref.form,\n    });\n\n    if (ref) {\n      ref.value = JSON.stringify(this.props.challengeData);\n    }\n  };\n\n  bindResponseElement: React.RefCallback<HTMLInputElement> = ref =>\n    this.setState({responseElement: ref});\n\n  renderUnsupported() {\n    return this.props.silentIfUnsupported ? null : (\n      <div className=\"u2f-box\">\n        <div className=\"inner\">\n          <p className=\"error\">\n            {t(\n              `\n             Unfortunately your browser does not support U2F. You need to use\n             a different two-factor method or switch to a browser that supports\n             it (Google Chrome or Microsoft Edge).`\n            )}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  get canTryAgain() {\n    return this.state.deviceFailure !== 'BAD_APPID';\n  }\n\n  renderSafariWebAuthn = () => {\n    return (\n      <a onClick={this.onTryAgain} className=\"btn btn-primary\">\n        {this.props.flowMode === 'enroll'\n          ? t('Enroll with WebAuthn')\n          : t('Sign in with WebAuthn')}\n      </a>\n    );\n  };\n\n  renderFailure = () => {\n    const {deviceFailure} = this.state;\n    const supportMail = ConfigStore.get('supportEmail');\n    const support = supportMail ? (\n      <a href={'mailto:' + supportMail}>{supportMail}</a>\n    ) : (\n      <span>{t('Support')}</span>\n    );\n    if (this.state.isSafari && this.state.failCount === 0) {\n      return this.renderSafariWebAuthn();\n    }\n    return (\n      <div className=\"failure-message\">\n        <div>\n          <strong>{t('Error: ')}</strong>{' '}\n          {\n            {\n              UNKNOWN_ERROR: t('There was an unknown problem, please try again'),\n              DEVICE_ERROR: t('Your U2F device reported an error.'),\n              DUPLICATE_DEVICE: t('This device is already registered with Sentry.'),\n              UNKNOWN_DEVICE: t('The device you used for sign-in is unknown.'),\n              BAD_APPID: tct(\n                `[p1:The Sentry server administrator modified the device\n                 registrations.] [p2:You need to remove and re-add the device to continue using\n                 your U2F device. Use a different sign-in method or contact [support] for\n                 assistance.]`,\n                {\n                  p1: <p />,\n                  p2: <p />,\n                  support,\n                }\n              ),\n            }[deviceFailure || '']\n          }\n        </div>\n        {this.canTryAgain && (\n          <div style={{marginTop: 18}}>\n            <a onClick={this.onTryAgain} className=\"btn btn-primary\">\n              {t('Try Again')}\n            </a>\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  renderBody() {\n    return this.state.deviceFailure ? this.renderFailure() : this.props.children;\n  }\n\n  renderPrompt() {\n    const {style} = this.props;\n\n    return (\n      <div\n        style={style}\n        className={\n          'u2f-box' +\n          (this.state.hasBeenTapped ? ' tapped' : '') +\n          (this.state.deviceFailure\n            ? this.state.failCount === 0 && this.state.isSafari\n              ? ' loading-dots'\n              : ' device-failure'\n            : '')\n        }\n      >\n        <div className=\"device-animation-frame\">\n          <div className=\"device-failed\" />\n          <div className=\"device-animation\" />\n          <div className=\"loading-dots\">\n            <span className=\"dot\" />\n            <span className=\"dot\" />\n            <span className=\"dot\" />\n          </div>\n        </div>\n        <input type=\"hidden\" name=\"challenge\" ref={this.bindChallengeElement} />\n        <input type=\"hidden\" name=\"response\" ref={this.bindResponseElement} />\n        <div className=\"inner\">{this.renderBody()}</div>\n      </div>\n    );\n  }\n\n  render() {\n    const {isSupported} = this.state;\n    // if we are still waiting for the browser to tell us if we can do u2f this\n    // will be null.\n    if (isSupported === null) {\n      return null;\n    }\n\n    if (!isSupported) {\n      return this.renderUnsupported();\n    }\n\n    return this.renderPrompt();\n  }\n}\n\nexport default withOrganization(U2fInterface);\n","import {t} from 'sentry/locale';\n\nimport U2fInterface from './u2finterface';\n\nconst MESSAGES = {\n  signin: t(\n    'Insert your U2F device or tap the button on it to confirm the sign-in request.'\n  ),\n  sudo: t('Alternatively you can use your U2F device to confirm the action.'),\n  enroll: t(\n    'To enroll your U2F device insert it now or tap the button on it to activate it.'\n  ),\n};\n\ntype InterfaceProps = React.ComponentProps<typeof U2fInterface>;\n\ntype Props = Omit<InterfaceProps, 'silentIfUnsupported' | 'flowMode'> & {\n  displayMode?: 'signin' | 'enroll' | 'sudo';\n};\n\nfunction U2fSign({displayMode = 'signin', ...props}: Props) {\n  const flowMode = displayMode === 'enroll' ? 'enroll' : 'sign';\n\n  return (\n    <U2fInterface\n      {...props}\n      silentIfUnsupported={displayMode === 'sudo'}\n      flowMode={flowMode}\n    >\n      <p>{MESSAGES[displayMode] ?? null}</p>\n    </U2fInterface>\n  );\n}\n\nexport default U2fSign;\n","import Cookies from 'js-cookie';\nimport * as qs from 'query-string';\n\ntype PendingInvite = {\n  memberId: number;\n  token: string;\n  url: string;\n};\n\nexport default function getPendingInvite(): PendingInvite | null {\n  const data = Cookies.get('pending-invite');\n\n  if (!data) {\n    return null;\n  }\n\n  return qs.parse(data) as any;\n}\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Fragment} from 'react';\nimport {WithRouterProps} from 'react-router';\nimport styled from '@emotion/styled';\nimport {QRCodeCanvas} from 'qrcode.react';\n\nimport {\n  addErrorMessage,\n  addLoadingMessage,\n  addSuccessMessage,\n} from 'sentry/actionCreators/indicator';\nimport {openRecoveryOptions} from 'sentry/actionCreators/modal';\nimport {fetchOrganizationByMember} from 'sentry/actionCreators/organizations';\nimport {Alert} from 'sentry/components/alert';\nimport {Button} from 'sentry/components/button';\nimport ButtonBar from 'sentry/components/buttonBar';\nimport CircleIndicator from 'sentry/components/circleIndicator';\nimport FieldGroup from 'sentry/components/forms/fieldGroup';\nimport Form, {FormProps} from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport FormModel from 'sentry/components/forms/model';\nimport {FieldObject} from 'sentry/components/forms/types';\nimport {PanelItem} from 'sentry/components/panels';\nimport TextCopyInput from 'sentry/components/textCopyInput';\nimport U2fsign from 'sentry/components/u2f/u2fsign';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {Authenticator} from 'sentry/types';\nimport getPendingInvite from 'sentry/utils/getPendingInvite';\n// eslint-disable-next-line no-restricted-imports\nimport withSentryRouter from 'sentry/utils/withSentryRouter';\nimport AsyncView from 'sentry/views/asyncView';\nimport RemoveConfirm from 'sentry/views/settings/account/accountSecurity/components/removeConfirm';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\n\ntype GetFieldsOpts = {\n  authenticator: Authenticator;\n  /**\n   * Flag to track if totp has been sent\n   */\n  hasSentCode: boolean;\n  /**\n   * Callback to reset SMS 2fa enrollment\n   */\n  onSmsReset: () => void;\n  /**\n   * Callback when u2f device is activated\n   */\n  onU2fTap: React.ComponentProps<typeof U2fsign>['onTap'];\n  /**\n   * Flag to track if we are currently sending the otp code\n   */\n  sendingCode: boolean;\n};\n\n/**\n * Retrieve additional form fields (or modify ones) based on 2fa method\n */\nconst getFields = ({\n  authenticator,\n  hasSentCode,\n  sendingCode,\n  onSmsReset,\n  onU2fTap,\n}: GetFieldsOpts): null | FieldObject[] => {\n  const {form} = authenticator;\n\n  if (!form) {\n    return null;\n  }\n\n  if (authenticator.id === 'totp') {\n    return [\n      () => (\n        <CodeContainer key=\"qrcode\">\n          <StyledQRCode\n            aria-label={t('Enrollment QR Code')}\n            value={authenticator.qrcode}\n            size={228}\n          />\n        </CodeContainer>\n      ),\n      () => (\n        <FieldGroup key=\"secret\" label={t('Authenticator secret')}>\n          <TextCopyInput>{authenticator.secret ?? ''}</TextCopyInput>\n        </FieldGroup>\n      ),\n      ...form,\n      () => (\n        <Actions key=\"confirm\">\n          <Button priority=\"primary\" type=\"submit\">\n            {t('Confirm')}\n          </Button>\n        </Actions>\n      ),\n    ];\n  }\n\n  // Sms Form needs a start over button + confirm button\n  // Also inputs being disabled vary based on hasSentCode\n  if (authenticator.id === 'sms') {\n    // Ideally we would have greater flexibility when rendering footer\n    return [\n      {...form[0], disabled: sendingCode || hasSentCode},\n      ...(hasSentCode ? [{...form[1], required: true}] : []),\n      () => (\n        <Actions key=\"sms-footer\">\n          <ButtonBar gap={1}>\n            {hasSentCode && <Button onClick={onSmsReset}>{t('Start Over')}</Button>}\n            <Button priority=\"primary\" type=\"submit\">\n              {hasSentCode ? t('Confirm') : t('Send Code')}\n            </Button>\n          </ButtonBar>\n        </Actions>\n      ),\n    ];\n  }\n\n  // Need to render device name field + U2f component\n  if (authenticator.id === 'u2f') {\n    const deviceNameField = form.find(({name}) => name === 'deviceName')!;\n    return [\n      deviceNameField,\n      () => (\n        <U2fsign\n          key=\"u2f-enroll\"\n          style={{marginBottom: 0}}\n          challengeData={authenticator.challenge}\n          displayMode=\"enroll\"\n          onTap={onU2fTap}\n        />\n      ),\n    ];\n  }\n\n  return null;\n};\n\ntype Props = AsyncView['props'] & WithRouterProps<{authId: string}, {}> & {};\n\ntype State = AsyncView['state'] & {\n  authenticator: Authenticator | null;\n  hasSentCode: boolean;\n  sendingCode: boolean;\n};\n\ntype PendingInvite = ReturnType<typeof getPendingInvite>;\n\n/**\n * Renders necessary forms in order to enroll user in 2fa\n */\nclass AccountSecurityEnroll extends AsyncView<Props, State> {\n  formModel = new FormModel();\n\n  getTitle() {\n    return t('Security');\n  }\n\n  getDefaultState() {\n    return {...super.getDefaultState(), hasSentCode: false};\n  }\n\n  get authenticatorEndpoint() {\n    return `/users/me/authenticators/${this.props.params.authId}/`;\n  }\n\n  get enrollEndpoint() {\n    return `${this.authenticatorEndpoint}enroll/`;\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const errorHandler = (err: any) => {\n      const alreadyEnrolled =\n        err &&\n        err.status === 400 &&\n        err.responseJSON &&\n        err.responseJSON.details === 'Already enrolled';\n\n      if (alreadyEnrolled) {\n        this.props.router.push('/settings/account/security/');\n        addErrorMessage(t('Already enrolled'));\n      }\n\n      // Allow the endpoint to fail if the user is already enrolled\n      return alreadyEnrolled;\n    };\n\n    return [['authenticator', this.enrollEndpoint, {}, {allowError: errorHandler}]];\n  }\n\n  componentDidMount() {\n    super.componentDidMount();\n    this.pendingInvitation = getPendingInvite();\n  }\n\n  pendingInvitation: PendingInvite = null;\n\n  get authenticatorName() {\n    return this.state.authenticator?.name ?? 'Authenticator';\n  }\n\n  // This resets state so that user can re-enter their phone number again\n  handleSmsReset = () => this.setState({hasSentCode: false}, this.remountComponent);\n\n  // Handles SMS authenticators\n  handleSmsSubmit = async (dataModel: any) => {\n    const {authenticator, hasSentCode} = this.state;\n    const {phone, otp} = dataModel;\n\n    // Don't submit if empty\n    if (!phone || !authenticator) {\n      return;\n    }\n\n    const data = {\n      phone,\n      // Make sure `otp` is undefined if we are submitting OTP verification\n      // Otherwise API will think that we are on verification step (e.g. after submitting phone)\n      otp: hasSentCode ? otp : undefined,\n      secret: authenticator.secret,\n    };\n\n    // Only show loading when submitting OTP\n    this.setState({sendingCode: !hasSentCode});\n\n    if (!hasSentCode) {\n      addLoadingMessage(t('Sending code to %s...', data.phone));\n    } else {\n      addLoadingMessage(t('Verifying OTP...'));\n    }\n\n    try {\n      await this.api.requestPromise(this.enrollEndpoint, {data});\n    } catch (error) {\n      this.formModel.resetForm();\n\n      addErrorMessage(\n        this.state.hasSentCode ? t('Incorrect OTP') : t('Error sending SMS')\n      );\n\n      this.setState({\n        hasSentCode: false,\n        sendingCode: false,\n      });\n\n      // Re-mount because we want to fetch a fresh secret\n      this.remountComponent();\n\n      return;\n    }\n\n    if (!hasSentCode) {\n      // Just successfully finished sending OTP to user\n      this.setState({hasSentCode: true, sendingCode: false});\n      addSuccessMessage(t('Sent code to %s', data.phone));\n    } else {\n      // OTP was accepted and SMS was added as a 2fa method\n      this.handleEnrollSuccess();\n    }\n  };\n\n  // Handle u2f device tap\n  handleU2fTap = async (tapData: any) => {\n    const data = {deviceName: this.formModel.getValue('deviceName'), ...tapData};\n\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(this.enrollEndpoint, {data});\n    } catch (err) {\n      this.handleEnrollError();\n      return;\n    }\n\n    this.handleEnrollSuccess();\n  };\n\n  // Currently only TOTP uses this\n  handleTotpSubmit = async (dataModel: any) => {\n    if (!this.state.authenticator) {\n      return;\n    }\n\n    const data = {\n      ...(dataModel ?? {}),\n      secret: this.state.authenticator.secret,\n    };\n\n    this.setState({loading: true});\n\n    try {\n      await this.api.requestPromise(this.enrollEndpoint, {method: 'POST', data});\n    } catch (err) {\n      this.handleEnrollError();\n      return;\n    }\n\n    this.handleEnrollSuccess();\n  };\n\n  handleSubmit: FormProps['onSubmit'] = data => {\n    const id = this.state.authenticator?.id;\n\n    if (id === 'totp') {\n      this.handleTotpSubmit(data);\n      return;\n    }\n    if (id === 'sms') {\n      this.handleSmsSubmit(data);\n      return;\n    }\n  };\n\n  // Handler when we successfully add a 2fa device\n  async handleEnrollSuccess() {\n    // If we're pending approval of an invite, the user will have just joined\n    // the organization when completing 2fa enrollment. We should reload the\n    // organization context in that case to assign them to the org.\n    if (this.pendingInvitation) {\n      await fetchOrganizationByMember(\n        this.api,\n        this.pendingInvitation.memberId.toString(),\n        {\n          addOrg: true,\n          fetchOrgDetails: true,\n        }\n      );\n    }\n\n    this.props.router.push('/settings/account/security/');\n    openRecoveryOptions({authenticatorName: this.authenticatorName});\n  }\n\n  // Handler when we failed to add a 2fa device\n  handleEnrollError() {\n    this.setState({loading: false});\n    addErrorMessage(t('Error adding %s authenticator', this.authenticatorName));\n  }\n\n  // Removes an authenticator\n  handleRemove = async () => {\n    const {authenticator} = this.state;\n\n    if (!authenticator || !authenticator.authId) {\n      return;\n    }\n\n    // `authenticator.authId` is NOT the same as `props.params.authId` This is\n    // for backwards compatibility with API endpoint\n    try {\n      await this.api.requestPromise(this.authenticatorEndpoint, {method: 'DELETE'});\n    } catch (err) {\n      addErrorMessage(t('Error removing authenticator'));\n      return;\n    }\n\n    this.props.router.push('/settings/account/security/');\n    addSuccessMessage(t('Authenticator has been removed'));\n  };\n\n  renderBody() {\n    const {authenticator, hasSentCode, sendingCode} = this.state;\n\n    if (!authenticator) {\n      return null;\n    }\n\n    const fields = getFields({\n      authenticator,\n      hasSentCode,\n      sendingCode,\n      onSmsReset: this.handleSmsReset,\n      onU2fTap: this.handleU2fTap,\n    });\n\n    // Attempt to extract `defaultValue` from server generated form fields\n    const defaultValues = fields\n      ? fields\n          .filter(\n            field =>\n              typeof field !== 'function' && typeof field.defaultValue !== 'undefined'\n          )\n          .map(field => [\n            field.name,\n            typeof field !== 'function' ? field.defaultValue : '',\n          ])\n          .reduce((acc, [name, value]) => {\n            acc[name] = value;\n            return acc;\n          }, {})\n      : {};\n\n    const isActive = authenticator.isEnrolled || authenticator.status === 'rotation';\n\n    return (\n      <Fragment>\n        <SettingsPageHeader\n          title={\n            <Fragment>\n              <span>{authenticator.name}</span>\n              <CircleIndicator\n                role=\"status\"\n                aria-label={\n                  isActive\n                    ? t('Authentication Method Active')\n                    : t('Authentication Method Inactive')\n                }\n                enabled={isActive}\n                css={{marginLeft: 6}}\n              />\n            </Fragment>\n          }\n          action={\n            authenticator.isEnrolled &&\n            authenticator.removeButton && (\n              <RemoveConfirm onConfirm={this.handleRemove}>\n                <Button priority=\"danger\">{authenticator.removeButton}</Button>\n              </RemoveConfirm>\n            )\n          }\n        />\n\n        <TextBlock>{authenticator.description}</TextBlock>\n\n        {authenticator.rotationWarning && authenticator.status === 'rotation' && (\n          <Alert type=\"warning\" showIcon>\n            {authenticator.rotationWarning}\n          </Alert>\n        )}\n\n        {!!authenticator.form?.length && (\n          <Form\n            model={this.formModel}\n            apiMethod=\"POST\"\n            apiEndpoint={this.authenticatorEndpoint}\n            onSubmit={this.handleSubmit}\n            initialData={{...defaultValues, ...authenticator}}\n            hideFooter\n          >\n            <JsonForm forms={[{title: 'Configuration', fields: fields ?? []}]} />\n          </Form>\n        )}\n      </Fragment>\n    );\n  }\n}\n\nconst CodeContainer = styled(PanelItem)`\n  justify-content: center;\n`;\n\nconst Actions = styled(PanelItem)`\n  justify-content: flex-end;\n`;\n\nconst StyledQRCode = styled(QRCodeCanvas)`\n  background: white;\n  padding: ${space(2)};\n`;\n\nexport default withSentryRouter(AccountSecurityEnroll);\n","import styled from '@emotion/styled';\n\nconst ConfirmHeader = styled('div')`\n  font-size: 1.2em;\n  margin-bottom: 10px;\n`;\n\nexport default ConfirmHeader;\n","import {Fragment} from 'react';\n\nimport Confirm from 'sentry/components/confirm';\nimport {t} from 'sentry/locale';\nimport ConfirmHeader from 'sentry/views/settings/account/accountSecurity/components/confirmHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\n\ntype Props = React.ComponentProps<typeof Confirm>;\n\nconst message = (\n  <Fragment>\n    <ConfirmHeader>{t('Do you want to remove this method?')}</ConfirmHeader>\n    <TextBlock>\n      {t(\n        'Removing the last authentication method will disable two-factor authentication completely.'\n      )}\n    </TextBlock>\n  </Fragment>\n);\n\nfunction RemoveConfirm(props: Props) {\n  return <Confirm {...props} message={message} />;\n}\n\nexport default RemoveConfirm;\n"],"names":["base64urlToBuffer","baseurl64String","padding","slice","length","base64String","replace","str","atob","buffer","ArrayBuffer","byteView","Uint8Array","i","charCodeAt","bufferToBase64url","charCode","String","fromCharCode","btoa","U2fInterface","Component","constructor","arguments","_defineProperty","isSupported","formElement","challengeElement","hasBeenTapped","deviceFailure","responseElement","isSafari","failCount","this","setState","invokeU2fFlow","ref","form","value","JSON","stringify","props","challengeData","_jsx","onClick","onTryAgain","className","children","flowMode","t","state","supportMail","ConfigStore","support","href","renderSafariWebAuthn","_jsxs","UNKNOWN_ERROR","DEVICE_ERROR","DUPLICATE_DEVICE","UNKNOWN_DEVICE","BAD_APPID","tct","p1","p2","canTryAgain","style","marginTop","componentDidMount","supported","window","PublicKeyCredential","navigator","userAgent","includes","getU2FResponse","data","response","authenticatorData","keyHandle","id","clientData","clientDataJSON","signatureData","signature","rawId","attestationObject","type","Error","submitU2fResponse","promise","then","u2fResponse","challenge","onTap","catch","submit","err","failure","metaData","Sentry","webAuthnSignIn","publicKeyCredentialRequestOptions","credentials","get","publicKey","webAuthnRegister","create","challengeArray","webAuthnAuthenticationData","cbor","decodeFirst","webAuthnRegisterData","renderUnsupported","silentIfUnsupported","renderBody","renderFailure","renderPrompt","name","bindChallengeElement","bindResponseElement","render","displayName","withOrganization","MESSAGES","signin","sudo","enroll","U2fSign","_ref","displayMode","getPendingInvite","Cookies","qs","AsyncView","AsyncComponent","getTitle","SentryDocumentTitle","title","renderComponent","_ref4","styles","AccountSecurityEnroll","FormModel","hasSentCode","remountComponent","async","authenticator","phone","otp","dataModel","undefined","secret","sendingCode","addLoadingMessage","api","requestPromise","enrollEndpoint","error","formModel","resetForm","addErrorMessage","handleEnrollSuccess","addSuccessMessage","deviceName","getValue","tapData","loading","handleEnrollError","method","handleSmsSubmit","handleTotpSubmit","authId","authenticatorEndpoint","router","push","getDefaultState","super","params","getEndpoints","allowError","alreadyEnrolled","status","responseJSON","details","pendingInvitation","authenticatorName","fetchOrganizationByMember","memberId","toString","addOrg","fetchOrgDetails","openRecoveryOptions","fields","onSmsReset","onU2fTap","CodeContainer","StyledQRCode","qrcode","size","FieldGroup","label","TextCopyInput","Actions","Button","priority","disabled","required","ButtonBar","gap","find","_ref2","U2fsign","marginBottom","getFields","handleSmsReset","handleU2fTap","defaultValues","filter","field","defaultValue","map","reduce","acc","_ref3","isActive","isEnrolled","Fragment","SettingsPageHeader","CircleIndicator","role","enabled","css","action","removeButton","RemoveConfirm","onConfirm","handleRemove","TextBlock","description","rotationWarning","Alert","showIcon","Form","model","apiMethod","apiEndpoint","onSubmit","handleSubmit","initialData","hideFooter","JsonForm","forms","_styled","PanelItem","target","QRCodeCanvas","space","withSentryRouter","message","ConfirmHeader","Confirm"],"sourceRoot":""}