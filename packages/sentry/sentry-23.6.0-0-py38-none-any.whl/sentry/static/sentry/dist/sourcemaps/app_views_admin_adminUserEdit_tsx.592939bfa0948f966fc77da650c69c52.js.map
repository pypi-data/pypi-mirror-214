{"version":3,"file":"chunks/app_views_admin_adminUserEdit_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/admin/adminUserEdit.tsx","webpack:///./app/views/asyncView.tsx"],"sourcesContent":["import {Component, Fragment} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {ModalRenderProps, openModal} from 'sentry/actionCreators/modal';\nimport {Button} from 'sentry/components/button';\nimport RadioGroup from 'sentry/components/forms/controls/radioGroup';\nimport Form from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport FormModel from 'sentry/components/forms/model';\nimport {JsonFormObject} from 'sentry/components/forms/types';\nimport {t} from 'sentry/locale';\nimport {space} from 'sentry/styles/space';\nimport {User} from 'sentry/types';\nimport AsyncView from 'sentry/views/asyncView';\n\nconst userEditForm: JsonFormObject = {\n  title: 'User details',\n  fields: [\n    {\n      name: 'name',\n      type: 'string',\n      required: true,\n      label: t('Name'),\n    },\n    {\n      name: 'username',\n      type: 'string',\n      required: true,\n      label: t('Username'),\n      help: t('The username is the unique id of the user in the system'),\n    },\n    {\n      name: 'email',\n      type: 'string',\n      required: true,\n      label: t('Email'),\n      help: t('The users primary email address'),\n    },\n    {\n      name: 'isActive',\n      type: 'boolean',\n      required: true,\n      label: t('Active'),\n      help: t(\n        'Designates whether this user should be treated as active. Unselect this instead of deleting accounts.'\n      ),\n    },\n    {\n      name: 'isStaff',\n      type: 'boolean',\n      required: true,\n      label: t('Admin'),\n      help: t('Designates whether this user can perform administrative functions.'),\n    },\n    {\n      name: 'isSuperuser',\n      type: 'boolean',\n      required: true,\n      label: t('Superuser'),\n      help: t(\n        'Designates whether this user has all permissions without explicitly assigning them.'\n      ),\n    },\n  ],\n};\n\nconst REMOVE_BUTTON_LABEL = {\n  disable: t('Disable User'),\n  delete: t('Permanently Delete User'),\n};\n\ntype DeleteType = 'disable' | 'delete';\n\ntype RemoveModalProps = ModalRenderProps & {\n  onRemove: (type: DeleteType) => void;\n  user: User;\n};\n\ntype RemoveModalState = {\n  deleteType: DeleteType;\n};\n\nclass RemoveUserModal extends Component<RemoveModalProps, RemoveModalState> {\n  state: RemoveModalState = {\n    deleteType: 'disable',\n  };\n\n  onRemove = () => {\n    this.props.onRemove(this.state.deleteType);\n    this.props.closeModal();\n  };\n\n  render() {\n    const {user} = this.props;\n    const {deleteType} = this.state;\n\n    return (\n      <Fragment>\n        <RadioGroup\n          value={deleteType}\n          label={t('Remove user %s', user.email)}\n          onChange={type => this.setState({deleteType: type})}\n          choices={[\n            ['disable', t('Disable the account.')],\n            ['delete', t('Permanently remove the user and their data.')],\n          ]}\n        />\n        <ModalFooter>\n          <Button priority=\"danger\" onClick={this.onRemove}>\n            {REMOVE_BUTTON_LABEL[deleteType]}\n          </Button>\n          <Button onClick={this.props.closeModal}>{t('Cancel')}</Button>\n        </ModalFooter>\n      </Fragment>\n    );\n  }\n}\n\ntype Props = AsyncView['props'] & RouteComponentProps<{id: string}, {}>;\n\ntype State = AsyncView['state'] & {\n  user: User | null;\n};\n\nclass AdminUserEdit extends AsyncView<Props, State> {\n  get userEndpoint() {\n    const {params} = this.props;\n    return `/users/${params.id}/`;\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['user', this.userEndpoint]];\n  }\n\n  async deleteUser() {\n    await this.api.requestPromise(this.userEndpoint, {\n      method: 'DELETE',\n      data: {hardDelete: true, organizations: []},\n    });\n\n    addSuccessMessage(t(\"%s's account has been deleted.\", this.state.user?.email));\n    browserHistory.replace('/manage/users/');\n  }\n\n  async deactivateUser() {\n    const response = await this.api.requestPromise(this.userEndpoint, {\n      method: 'PUT',\n      data: {isActive: false},\n    });\n\n    this.setState({user: response});\n    this.formModel.setInitialData(response);\n    addSuccessMessage(t(\"%s's account has been deactivated.\", response.email));\n  }\n\n  removeUser = (actionTypes: DeleteType) =>\n    actionTypes === 'delete' ? this.deleteUser() : this.deactivateUser();\n\n  formModel = new FormModel();\n\n  renderBody() {\n    const {user} = this.state;\n\n    if (user === null) {\n      return null;\n    }\n\n    const openDeleteModal = () =>\n      openModal(opts => (\n        <RemoveUserModal user={user} onRemove={this.removeUser} {...opts} />\n      ));\n\n    return (\n      <Fragment>\n        <h3>{t('Users')}</h3>\n        <p>{t('Editing user: %s', user.email)}</p>\n        <Form\n          model={this.formModel}\n          initialData={user}\n          apiMethod=\"PUT\"\n          apiEndpoint={this.userEndpoint}\n          requireChanges\n          onSubmitError={err => {\n            addErrorMessage(err?.responseJSON?.detail);\n          }}\n          onSubmitSuccess={data => {\n            this.setState({user: data});\n            addSuccessMessage(t('User account updated.'));\n          }}\n          extraButton={\n            <Button\n              onClick={openDeleteModal}\n              style={{marginLeft: space(1)}}\n              priority=\"danger\"\n            >\n              {t('Remove User')}\n            </Button>\n          }\n        >\n          <JsonForm forms={[userEditForm]} />\n        </Form>\n      </Fragment>\n    );\n  }\n}\n\nconst ModalFooter = styled('div')`\n  display: grid;\n  grid-auto-flow: column;\n  gap: ${space(1)};\n  justify-content: end;\n  padding: 20px 30px;\n  margin: 20px -30px -30px;\n  border-top: 1px solid ${p => p.theme.border};\n`;\n\nexport default AdminUserEdit;\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n"],"names":["userEditForm","title","fields","name","type","required","label","t","help","REMOVE_BUTTON_LABEL","disable","delete","RemoveUserModal","Component","constructor","arguments","_defineProperty","deleteType","this","props","onRemove","state","closeModal","render","user","_jsxs","Fragment","children","_jsx","RadioGroup","value","email","onChange","setState","choices","ModalFooter","Button","priority","onClick","displayName","AdminUserEdit","AsyncView","actionTypes","deleteUser","deactivateUser","FormModel","userEndpoint","params","id","getEndpoints","async","api","requestPromise","method","data","hardDelete","organizations","addSuccessMessage","browserHistory","response","isActive","formModel","setInitialData","renderBody","Form","model","initialData","apiMethod","apiEndpoint","requireChanges","onSubmitError","err","addErrorMessage","responseJSON","detail","onSubmitSuccess","extraButton","openDeleteModal","openModal","opts","removeUser","style","marginLeft","space","JsonForm","forms","_styled","target","p","theme","border","AsyncComponent","getTitle","SentryDocumentTitle","renderComponent"],"sourceRoot":""}