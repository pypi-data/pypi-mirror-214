"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_organizationStats_teamInsights_issues_tsx"],{"./app/views/organizationStats/teamInsights/issues.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ve});var n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("../node_modules/react/index.js"),o=s("./app/components/layouts/thirds.tsx"),i=s("./app/components/loadingIndicator.tsx"),a=s("./app/components/noProjectMessage.tsx"),d=s("./app/components/sentryDocumentTitle.tsx"),l=s("./app/locale.tsx"),u=s("./app/utils/localStorage.tsx"),p=s("./app/utils/routeAnalytics/useRouteAnalyticsEventNames.tsx"),c=s("./app/utils/useOrganization.tsx"),m=s("./app/utils/useTeams.tsx"),g=s("./app/views/organizationStats/header.tsx"),h=s("./app/views/organizationStats/teamInsights/controls.tsx"),Z=s("./app/views/organizationStats/teamInsights/descriptionCard.tsx"),v=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),y=s("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),x=s("../node_modules/moment/moment.js"),b=s.n(x),f=s("./app/components/asyncComponent.tsx"),w=s("./app/components/charts/barChart.tsx"),S=s("./app/components/count.tsx"),j=s("./app/components/idBadge/projectBadge.tsx"),D=s("./app/components/links/link.tsx"),B=s("./app/components/panels/panelTable.tsx"),I=s("./app/components/placeholder.tsx"),z=s("./app/components/timeSince.tsx"),T=s("./app/icons/index.tsx"),C=s("./app/styles/space.tsx"),k=s("./app/utils/events.tsx"),q=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function A(e){if("> 1 year"===e)return b()().subtract(1,"y").subtract(1,"d").valueOf();const[t,s,n]=e.split(" ");return b()().subtract(s,n).valueOf()}const N={"< 1 hour":(0,l.t)("1 hour"),"< 4 hour":(0,l.t)("4 hours"),"< 12 hour":(0,l.t)("12 hours"),"< 1 day":(0,l.t)("1 day"),"< 1 week":(0,l.t)("1 week"),"< 4 week":(0,l.t)("1 month"),"< 24 week":(0,l.t)("6 months"),"< 1 year":(0,l.t)("1 year"),"> 1 year":(0,l.t)("> 1 year")};class E extends f.Z{constructor(){super(...arguments),(0,v.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),oldestIssues:null,unresolvedIssueAge:null}}getEndpoints(){const{organization:e,teamSlug:t}=this.props;return[["oldestIssues",`/teams/${e.slug}/${t}/issues/old/`,{query:{limit:7}}],["unresolvedIssueAge",`/teams/${e.slug}/${t}/unresolved-issue-age/`]]}componentDidUpdate(e){const{teamSlug:t}=this.props;e.teamSlug!==t&&this.remountComponent()}renderLoading(){return this.renderBody()}renderBody(){const{organization:e}=this.props,{unresolvedIssueAge:t,oldestIssues:s,loading:n}=this.state,o=Object.entries(t??{}).map((e=>{let[t,s]=e;return{name:t,value:s}})).sort(((e,t)=>A(t.name)-A(e.name)));return(0,q.BX)("div",{children:[(0,q.BX)(O,{children:[n&&(0,q.tZ)(I.Z,{height:"200px"}),!n&&(0,q.tZ)(w.v,{style:{height:190},legend:{right:3,top:0},yAxis:{minInterval:1},xAxis:{type:"category",min:0,axisLabel:{showMaxLabel:!0,showMinLabel:!0,formatter:e=>N[e]??e}},series:[{seriesName:(0,l.t)("Unresolved Issues"),silent:!0,data:o,barCategoryGap:"5%"}]})]}),(0,q.tZ)(R,{isEmpty:!s||0===s.length,emptyMessage:(0,l.t)("No unresolved issues for this teamâ€™s projects"),headers:[(0,l.t)("Oldest Issues"),(0,q.tZ)($,{children:(0,l.t)("Events")},"events"),(0,q.tZ)($,{children:(0,l.t)("Users")},"users"),(0,q.BX)($,{children:[(0,l.t)("Age")," ",(0,q.tZ)(T.CC,{direction:"down",size:"xs",color:"gray300"})]},"age")],isLoading:n,children:s?.map((t=>{const{title:s}=(0,k.YQ)(t,e?.features,!1);return(0,q.BX)(r.Fragment,{children:[(0,q.BX)(L,{children:[(0,q.tZ)(_,{disableLink:!0,hideName:!0,avatarSize:18,project:t.project}),(0,q.tZ)(M,{children:(0,q.tZ)(D.Z,{to:{pathname:`/organizations/${e.slug}/issues/${t.id}/`},children:s})})]}),(0,q.tZ)($,{children:(0,q.tZ)(S.Z,{value:t.count})}),(0,q.tZ)($,{children:(0,q.tZ)(S.Z,{value:t.userCount})}),(0,q.tZ)($,{children:(0,q.tZ)(z.Z,{date:t.firstSeen})})]},t.id)}))})]})}}const X=E,O=(0,n.Z)("div",{target:"eq9p07m5"})("padding:",(0,C.D)(2)," ",(0,C.D)(2)," 0 ",(0,C.D)(2),";border-bottom:1px solid ",(e=>e.theme.border),";"),R=(0,n.Z)(B.Z,{target:"eq9p07m4"})("grid-template-columns:1fr 0.15fr 0.15fr 0.25fr;white-space:nowrap;margin-bottom:0;border:0;font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:unset;>*{padding:",(0,C.D)(1)," ",(0,C.D)(2),";}",(e=>e.isEmpty&&(0,y.iv)("&>div:last-child{padding:48px ",(0,C.D)(2),";}","")),";"),$=(0,n.Z)("span",{target:"eq9p07m3"})({name:"19mh0x6",styles:"display:flex;align-items:center;justify-content:flex-end"}),L=(0,n.Z)("div",{target:"eq9p07m2"})((e=>e.theme.overflowEllipsis),";display:flex;align-items:center;"),M=(0,n.Z)("div",{target:"eq9p07m1"})((e=>e.theme.overflowEllipsis),";"),_=(0,n.Z)(j.Z,{target:"eq9p07m0"})("display:inline-flex;align-items:center;margin-right:",(0,C.D)(1),";*>img{box-shadow:none;}");var G=s("../node_modules/lodash/isEqual.js"),U=s.n(G),F=s("./app/components/collapsePanel.tsx"),P=s("./app/components/organizations/pageFilters/parse.tsx"),W=s("./app/stores/projectsStore.tsx"),K=s("./app/views/organizationStats/teamInsights/styles.tsx"),H=s("./app/views/organizationStats/teamInsights/utils.tsx");const Q=["deleted","ignored","resolved","unignored","regressed","new","total"];class V extends f.Z{constructor(){super(...arguments),(0,v.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),issuesBreakdown:null}}getEndpoints(){const{organization:e,start:t,end:s,period:n,utc:r,teamSlug:o,statuses:i,environment:a}=this.props,d={start:t,end:s,period:n,utc:r};return[["issuesBreakdown",`/teams/${e.slug}/${o}/issue-breakdown/`,{query:{...(0,P.fK)(d),statuses:i,environment:a}}]]}componentDidUpdate(e){const{start:t,end:s,period:n,utc:r,teamSlug:o,projects:i,environment:a}=this.props;e.start===t&&e.end===s&&e.period===n&&e.utc===r&&e.teamSlug===o&&e.environment===a&&U()(e.projects,i)||this.remountComponent()}renderLoading(){return this.renderBody()}renderBody(){const{loading:e}=this.state,t=this.state.issuesBreakdown??{},{projects:s,statuses:n}=this.props,o={},i={};for(const[e,s]of Object.entries(t))for(const[t,n]of Object.entries(s)){i[e]||(i[e]={deleted:0,ignored:0,resolved:0,unignored:0,regressed:0,new:0,total:0});for(const t of Q)i[e][t]+=n[t];o[e]||(o[e]={}),void 0===o[e][t]?o[e][t]=n.total:o[e][t]+=n.total}const a=Object.entries(i).map((e=>{let[t,{total:s}]=e;return{projectId:t,total:s}})).sort(((e,t)=>t.total-e.total)),d=Object.keys(o).map(((e,t)=>({seriesName:W.Z.getById(e)?.slug??e,data:(0,H.Gs)((0,H.E7)(o[e])),animationDuration:500,animationDelay:500*t,silent:!0,barCategoryGap:"5%"})));return(0,q.BX)(r.Fragment,{children:[(0,q.BX)(ee,{children:[e&&(0,q.tZ)(I.Z,{height:"200px"}),!e&&(0,q.tZ)(w.v,{style:{height:200},stacked:!0,isGroupedByDate:!0,useShortDate:!0,legend:{right:0,top:0},xAxis:(0,H.tP)(),yAxis:{minInterval:1},series:d})]}),(0,q.tZ)(F.Z,{items:a.length,children:t=>{let{isExpanded:o,showMoreButton:d}=t;return(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(te,{numActions:n.length,headers:[(0,l.t)("Project"),...n.map((e=>(0,q.tZ)(se,{children:e},e))),(0,q.BX)(se,{children:[(0,l.t)("total")," ",(0,q.tZ)(T.CC,{direction:"down",size:"xs",color:"gray300"})]},"total")],isLoading:e,children:a.map(((e,t)=>{let{projectId:a}=e;const d=s.find((e=>e.id===a));return t>=F.$&&!o?null:(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(K.R,{children:d&&(0,q.tZ)(K.W,{avatarSize:18,project:d})}),n.map((e=>(0,q.tZ)(se,{children:i[a][e]},e))),(0,q.tZ)(se,{children:i[a].total})]},a)}))}),!e&&d]})}})]})}}const Y=V,J=(0,n.Z)("div",{target:"e1hoqdvl3"})("padding:",(0,C.D)(2)," ",(0,C.D)(2)," 0 ",(0,C.D)(2),";"),ee=(0,n.Z)(J,{target:"e1hoqdvl2"})("border-bottom:1px solid ",(e=>e.theme.border),";"),te=(0,n.Z)(B.Z,{target:"e1hoqdvl1"})("grid-template-columns:1fr ",(e=>" 0.2fr".repeat(e.numActions))," 0.2fr;font-size:",(e=>e.theme.fontSizeMedium),";white-space:nowrap;margin-bottom:0;border:0;box-shadow:unset;&>div{padding:",(0,C.D)(1)," ",(0,C.D)(2),";}"),se=(0,n.Z)("div",{target:"e1hoqdvl0"})({name:"mnwtso",styles:"text-align:right;font-variant-numeric:tabular-nums"});var ne=s("./app/utils/formatters.tsx");class re extends f.Z{constructor(){super(...arguments),(0,v.Z)(this,"shouldRenderBadRequests",!0)}getDefaultState(){return{...super.getDefaultState(),resolutionTime:null}}getEndpoints(){const{organization:e,start:t,end:s,period:n,utc:r,teamSlug:o,environment:i}=this.props,a={start:t,end:s,period:n,utc:r};return[["resolutionTime",`/teams/${e.slug}/${o}/time-to-resolution/`,{query:{...(0,P.fK)(a),environment:i}}]]}componentDidUpdate(e){const{start:t,end:s,period:n,utc:r,teamSlug:o,environment:i}=this.props;e.start===t&&e.end===s&&e.period===n&&e.utc===r&&e.teamSlug===o&&e.environment===i||this.remountComponent()}renderLoading(){return(0,q.tZ)(ie,{children:(0,q.tZ)(i.Z,{})})}renderBody(){const{resolutionTime:e}=this.state,t=Object.entries(e??{}).map((e=>{let[t,{avg:s}]=e;return{value:s,name:new Date(t).getTime()}})),s=(0,H.Gs)(t);return(0,q.tZ)(ie,{children:(0,q.tZ)(w.v,{style:{height:190},isGroupedByDate:!0,useShortDate:!0,period:"7d",tooltip:{valueFormatter:e=>(0,ne.g9)(e,1)},yAxis:{minInterval:86400,axisLabel:{formatter:e=>0===e?"":(0,ne.g9)(e,0,!0,!0)}},legend:{right:0,top:0},xAxis:(0,H.tP)(),series:[{seriesName:(0,l.t)("Time to Resolution"),data:s,silent:!0,barCategoryGap:"5%"}]})})}}const oe=re,ie=(0,n.Z)("div",{target:"ew4ocpl0"})("padding:",(0,C.D)(2)," ",(0,C.D)(2)," 0 ",(0,C.D)(2),";");var ae=s("./app/components/loadingError.tsx"),de=s("./app/utils/queryClient.tsx");function le(e){let{organization:t,teamSlug:s,projects:n,start:o,end:i,period:a,utc:d,environment:u}=e;const{data:p={},isLoading:c,isError:m,refetch:g}=(0,de.WE)([`/teams/${t.slug}/${s}/all-unresolved-issues/`,{query:{...(0,P.fK)({start:o,end:i,period:a,utc:d}),environment:u}}],{staleTime:0});function h(e){const t=Object.values(p?.[e]??{}),s=t.reduce(((e,t)=>e+t.unresolved),0);return Math.round(s/t.length)}const Z={};for(const e of Object.keys(p)){const t=h(Number(e)),s=Object.values(p?.[e]??{}),n=s[s.length-1]?.unresolved??0,r=(n-t)/t;Z[e]={projectId:e,periodAvg:t,today:n,percentChange:Number.isNaN(r)?0:r}}const v=n.map((e=>({project:e,trend:Z[e.id]?.percentChange??0}))).sort(((e,t)=>Math.abs(t.trend)-Math.abs(e.trend))),y=(0,H.NW)(v),x=Object.values(p).flatMap((e=>Object.entries(e).map((e=>{let[t,{unresolved:s}]=e;return[t,s]})))).reduce(((e,t)=>{let[s,n]=t;return void 0===e[s]&&(e[s]=0),e[s]+=n,e}),{}),b=(0,H.Gs)((0,H.E7)(x));return m?(0,q.tZ)(ae.Z,{onRetry:g}):(0,q.BX)("div",{children:[(0,q.BX)(ue,{children:[c&&(0,q.tZ)(I.Z,{height:"200px"}),!c&&(0,q.tZ)(w.v,{style:{height:190},isGroupedByDate:!0,useShortDate:!0,legend:{right:3,top:0},yAxis:{minInterval:1},xAxis:(0,H.tP)(),series:[{seriesName:(0,l.t)("Unresolved Issues"),silent:!0,data:b,barCategoryGap:"6%"}]})]}),(0,q.tZ)(F.Z,{items:y.length,children:e=>{let{isExpanded:t,showMoreButton:s}=e;return(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(pe,{isEmpty:0===n.length,isLoading:c,headers:[(0,l.t)("Project"),(0,q.tZ)(ce,{children:(0,l._N)("Last [period] Average",{period:a})},"last"),(0,q.tZ)(ce,{children:(0,l.t)("Today")},"curr"),(0,q.tZ)(ce,{children:(0,l.t)("Change")},"diff")],children:y.map(((e,s)=>{let{project:n}=e;const o=Z[n.id]??{};return s>=F.$&&!t?null:(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(K.R,{children:(0,q.tZ)(K.W,{avatarSize:18,project:n})}),(0,q.tZ)(me,{children:o.periodAvg}),(0,q.tZ)(me,{children:o.today}),(0,q.tZ)(me,{children:(0,q.BX)(he,{color:0===o.percentChange?"subText":o.percentChange>0?"errorText":"successText",children:[(0,ne.rl)(Number.isNaN(o.percentChange)?0:o.percentChange,0),(0,q.tZ)(ge,{direction:o.percentChange>0?"up":"down",size:"xs"})]})})]},n.id)}))}),!c&&s]})}})]})}le.displayName="TeamUnresolvedIssues";const ue=(0,n.Z)("div",{target:"e4muyu35"})("padding:",(0,C.D)(2)," ",(0,C.D)(2)," 0 ",(0,C.D)(2),";border-bottom:1px solid ",(e=>e.theme.border),";"),pe=(0,n.Z)(B.Z,{target:"e4muyu34"})("grid-template-columns:1fr 0.2fr 0.2fr 0.2fr;white-space:nowrap;margin-bottom:0;border:0;font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:unset;&>div{padding:",(0,C.D)(1)," ",(0,C.D)(2),";}"),ce=(0,n.Z)("span",{target:"e4muyu33"})({name:"2qga7i",styles:"text-align:right"}),me=(0,n.Z)("div",{target:"e4muyu32"})({name:"4os8x4",styles:"display:flex;align-items:center;justify-content:flex-end;text-align:right"}),ge=(0,n.Z)(T.CC,{target:"e4muyu31"})("margin:0 ",(0,C.D)(.5),";"),he=(0,n.Z)("div",{target:"e4muyu30"})("color:",(e=>e.theme[e.color]),";");function Ze(e){let{location:t,router:s}=e;const n=(0,c.Z)(),{teams:v,initiallyLoaded:y}=(0,m.y)({provideUserTeams:!0});(0,p.Z)("team_insights.viewed","Team Insights: Viewed");const x=t?.query??{},b=`teamInsightsSelectedTeamId:${n.slug}`;let f=x.team??u.Z.getItem(b);f&&!v.find((e=>e.id===f))&&(f=null);const w=f??v[0]?.id,S=v.find((e=>e.id===w)),j=S?.projects??[],D=x.environment,{period:B,start:I,end:z,utc:T}=(0,H.lI)(x);return 0===v.length?(0,q.tZ)(a.Z,{organization:n,superuserNeedsToBeProjectMember:!0}):(0,q.BX)(r.Fragment,{children:[(0,q.tZ)(d.Z,{title:(0,l.t)("Team Issues"),orgSlug:n.slug}),(0,q.tZ)(g.Z,{organization:n,activeTab:"issues"}),(0,q.BX)(ye,{children:[(0,q.tZ)(h.Z,{showEnvironment:!0,location:t,router:s,currentTeam:S,currentEnvironment:D}),!y&&(0,q.tZ)(i.Z,{}),y&&(0,q.BX)(o.or,{fullWidth:!0,children:[(0,q.tZ)(Z.Z,{title:(0,l.t)("All Unresolved Issues"),description:(0,l.t)("This includes New and Returning issues in the last 7 days as well as those that havenâ€™t been resolved or ignored in the past."),children:(0,q.tZ)(le,{projects:j,organization:n,teamSlug:S.slug,environment:D,period:B,start:I,end:z,utc:T})}),(0,q.tZ)(Z.Z,{title:(0,l.t)("New and Returning Issues"),description:(0,l.t)("The new, regressed, and unignored issues that were assigned to your team."),children:(0,q.tZ)(Y,{organization:n,projects:j,teamSlug:S.slug,environment:D,period:B,start:I?.toString(),end:z?.toString(),location:t,statuses:["new","regressed","unignored"]})}),(0,q.tZ)(Z.Z,{title:(0,l.t)("Issues Triaged"),description:(0,l.t)("How many new and returning issues were reviewed by your team each week. Reviewing an issue includes marking as reviewed, resolving, assigning to another team, or deleting."),children:(0,q.tZ)(Y,{organization:n,projects:j,teamSlug:S.slug,environment:D,period:B,start:I?.toString(),end:z?.toString(),location:t,statuses:["resolved","ignored","deleted"]})}),(0,q.tZ)(Z.Z,{title:(0,l.t)("Age of Unresolved Issues"),description:(0,l.t)("How long ago since unresolved issues were first created."),children:(0,q.tZ)(X,{organization:n,teamSlug:S.slug})}),(0,q.tZ)(Z.Z,{title:(0,l.t)("Time to Resolution"),description:(0,l.t)("The mean time it took for issues to be resolved by your team."),children:(0,q.tZ)(oe,{organization:n,environment:D,teamSlug:S.slug,period:B,start:I?.toString(),end:z?.toString(),location:t})})]})]})]})}Ze.displayName="TeamStatsIssues";const ve=Ze,ye=(0,n.Z)(o.uT,{target:"e1bncyea0"})("@media (min-width: ",(e=>e.theme.breakpoints.medium),"){display:block;}")}}]);
//# sourceMappingURL=../sourcemaps/app_views_organizationStats_teamInsights_issues_tsx.167177ce117994884e9e6d95b0ee7eca.js.map