"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_rules_metric_details_index_tsx"],{"./app/components/alertBadge.tsx":(e,t,r)=>{r.d(t,{Z:()=>u});var i=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/diamondStatus.tsx"),a=r("./app/icons/index.tsx"),n=r("./app/locale.tsx"),o=r("./app/styles/space.tsx"),l=r("./app/views/alerts/types.tsx"),d=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function c(e){let{status:t,withText:r,isIssue:i}=e,o=(0,n.t)("Resolved"),c=a.DL,u="successText";return i?(o=(0,n.t)("Issue"),c=p,u="subText"):t===l.vt.CRITICAL?(o=(0,n.t)("Critical"),c=a.zC,u="errorText"):t===l.vt.WARNING&&(o=(0,n.t)("Warning"),c=a.qV,u="warningText"),(0,d.BX)(m,{"data-test-id":"alert-badge",children:[(0,d.tZ)(s.V,{icon:c,color:u,"aria-label":r?void 0:o}),r&&(0,d.tZ)("div",{children:o})]})}c.displayName="AlertBadge";const u=c,p=(0,i.Z)(a.XI,{target:"eyo3n0p1"})({name:"6rcvar",styles:"width:13px"}),m=(0,i.Z)("div",{target:"eyo3n0p0"})("display:flex;align-items:center;gap:",(0,o.D)(1),";")},"./app/components/charts/components/markArea.tsx":(e,t,r)=>{function i(e){return{...e}}r.d(t,{Z:()=>i}),r("../node_modules/echarts/lib/component/markArea.js")},"./app/components/charts/sessionsRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>g});var i=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../node_modules/react/index.js"),a=r("../node_modules/lodash/isEqual.js"),n=r.n(a),o=r("../node_modules/lodash/omitBy.js"),l=r.n(o),d=r("./app/actionCreators/indicator.tsx"),c=r("./app/locale.tsx"),u=r("./app/utils/sessions.tsx");const p=["api","children","organization"],m=e=>l()(e,((e,t)=>p.includes(t)));class h extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{reloading:!1,errored:!1,response:null}),(0,i.Z)(this,"fetchData",(async()=>{const{api:e,isDisabled:t,shouldFilterSessionsInTimeWindow:r}=this.props;if(!t){this.setState((e=>({reloading:null!==e.response,errored:!1})));try{const t=await e.requestPromise(this.path,{query:this.baseQueryParams});this.setState({reloading:!1,response:r?(0,u.U5)(t,this.baseQueryParams.start,this.baseQueryParams.end):t})}catch(e){(0,d.Iw)(e.responseJSON?.detail??(0,c.t)("Error loading health data")),this.setState({reloading:!1,errored:!0})}}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){n()(m(e),m(this.props))||this.fetchData()}get path(){const{organization:e}=this.props;return`/organizations/${e.slug}/sessions/`}get baseQueryParams(){const{project:e,environment:t,field:r,statsPeriod:i,start:s,end:a,query:n,groupBy:o,interval:l,organization:d}=this.props;return{project:e,environment:t,field:r,statsPeriod:i,query:n,groupBy:o,start:s,end:a,interval:l||(0,u.Xz)({start:s,end:a,period:i},{highFidelity:d.features.includes("minute-resolution-sessions")})}}render(){const{reloading:e,errored:t,response:r}=this.state,{children:i}=this.props;return i({loading:null===r,reloading:e,errored:t,response:r})}}h.displayName="SessionsRequest";const g=h},"./app/components/diamondStatus.tsx":(e,t,r)=>{r.d(t,{V:()=>n});var i=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/icons/index.tsx"),a=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(e){let{color:t,icon:r,...i}=e;return(0,a.BX)(l,{role:"presentation",color:t,...i,children:[(0,a.tZ)(o,{color:t}),(0,a.tZ)(r,{color:"white"})]})}n.displayName="DiamondStatus";const o=(0,i.Z)(s.Sq,{target:"ehwnb4y1"})({name:"bgbjt4",styles:"width:36px;height:36px"}),l=(0,i.Z)("div",{target:"ehwnb4y0"})({name:"1uzdu7j",styles:"width:36px;height:36px;position:relative;svg:last-child{width:16px;z-index:2;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;}"})},"./app/components/keyValueTable.tsx":(e,t,r)=>{r.d(t,{G:()=>l,v:()=>o});var i=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("../node_modules/react/index.js"),a=r("./app/styles/space.tsx"),n=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const o=(0,i.Z)("dl",{target:"ehev67y2"})("display:grid;grid-template-columns:50% 50%;",(e=>e.noMargin?"margin-bottom: 0;":null),";");function l(e){let{keyName:t,value:r}=e;return(0,n.BX)(s.Fragment,{children:[(0,n.tZ)(c,{children:t}),(0,n.tZ)(u,{children:r})]})}l.displayName="KeyValueTableRow";const d=e=>{let{theme:t}=e;return`\nfont-size: ${t.fontSizeMedium};\npadding: ${(0,a.D)(.5)} ${(0,a.D)(1)};\nfont-weight: normal;\nline-height: inherit;\n${e=>e.theme.overflowEllipsis};\n&:nth-of-type(2n-1) {\n  background-color: ${t.backgroundSecondary};\n}\n`},c=(0,i.Z)("dt",{target:"ehev67y1"})(d,";color:",(e=>e.theme.textColor),";"),u=(0,i.Z)("dd",{target:"ehev67y0"})(d,";color:",(e=>e.theme.subText),";text-align:right;")},"./app/components/statusIndicator.tsx":(e,t,r)=>{r.d(t,{Z:()=>o});var i=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=r("./app/components/tooltip.tsx"),a=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function n(e){let{status:t,tooltipTitle:r}=e,i="error";return"muted"===t?i="muted":"info"===t?i="info":"warning"===t?i="warning":"success"!==t&&"resolved"!==t||(i="success"),(0,a.tZ)(s.u,{title:r,skipWrapper:!0,children:(0,a.tZ)(l,{color:i})})}n.displayName="StatusIndicator";const o=n,l=(0,i.Z)("div",{target:"ecry7ku0"})("position:absolute;left:-1px;width:9px;height:15px;border-radius:0 3px 3px 0;background-color:",(e=>e.theme.alert[e.color].background),";& span{display:block;width:9px;height:15px;}")},"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>l,_:()=>o});var i=r("./app/utils/discover/genericDiscoverQuery.tsx"),s=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function a(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function n(e){return(0,s.tZ)(i.ZP,{route:"events",shouldRefetchData:a,afterFetch:(e,t)=>{const{fields:r,...i}=e.meta??{};return{...e,meta:{...r,...i}}},...e})}function o(e){const t=(0,i.JC)({route:"events",shouldRefetchData:a,afterFetch:(e,t)=>{const{fields:r,...i}=e.meta??{};return{...e,meta:{...r,...i}}},...e}),r=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:r}}n.displayName="DiscoverQuery";const l=n},"./app/views/alerts/rules/metric/details/constants.tsx":(e,t,r)=>{r.d(t,{N7:()=>n,U2:()=>c,UC:()=>d,e2:()=>l,ud:()=>a,v3:()=>o});var i=r("./app/locale.tsx"),s=r("./app/views/alerts/rules/metric/types.tsx");const a={[s.XH.SIX_HOURS]:(0,i.t)("Last 6 hours"),[s.XH.ONE_DAY]:(0,i.t)("Last 24 hours"),[s.XH.THREE_DAYS]:(0,i.t)("Last 3 days"),[s.XH.SEVEN_DAYS]:(0,i.t)("Last 7 days")},n="7d",o=[{label:(0,i.t)("Last 6 hours"),value:s.XH.SIX_HOURS},{label:(0,i.t)("Last 24 hours"),value:s.XH.ONE_DAY},{label:(0,i.t)("Last 3 days"),value:s.XH.THREE_DAYS},{label:(0,i.t)("Last 7 days"),value:s.XH.SEVEN_DAYS},{label:(0,i.t)("Last 14 days"),value:s.XH.FOURTEEN_DAYS}],l={[s.XH.SIX_HOURS]:6*s.Tb.ONE_HOUR*60*1e3,[s.XH.ONE_DAY]:60*s.Tb.ONE_DAY*1e3,[s.XH.THREE_DAYS]:3*s.Tb.ONE_DAY*60*1e3,[s.XH.SEVEN_DAYS]:7*s.Tb.ONE_DAY*60*1e3,[s.XH.FOURTEEN_DAYS]:14*s.Tb.ONE_DAY*60*1e3},d=(s.XH.FOURTEEN_DAYS,1e4),c=150},"./app/views/alerts/rules/metric/details/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ot});var i=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=r("../node_modules/react/index.js"),a=r("../node_modules/moment/moment.js"),n=r.n(a),o=r("./app/actionCreators/members.tsx"),l=r("./app/components/alert.tsx"),d=r("./app/components/dateTime.tsx"),c=r("./app/components/layouts/thirds.tsx"),u=r("./app/components/organizations/pageFilters/container.tsx"),p=r("./app/components/sentryDocumentTitle.tsx"),m=r("./app/locale.tsx"),h=r("./app/utils/analytics.tsx"),g=r("./app/utils/dates.tsx"),y=r("./app/utils/withApi.tsx"),x=r("./app/utils/withProjects.tsx"),v=r("./app/views/alerts/rules/metric/types.tsx"),f=r("./app/views/alerts/utils/apiCalls.tsx"),Z=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),w=(r("../node_modules/core-js/modules/es.array.push.js"),r("./app/components/charts/utils.tsx")),b=r("./app/components/duration.tsx"),T=r("./app/components/pageTimeRangeSelector.tsx"),S=r("./app/components/panels/index.tsx"),D=r("./app/components/placeholder.tsx"),C=r("./app/styles/space.tsx"),R=r("../node_modules/moment-timezone/index.js"),N=r.n(R),E=r("./app/components/collapsePanel.tsx"),q=r("./app/components/links/link.tsx"),z=r("./app/components/panels/panelTable.tsx"),_=r("./app/components/statusIndicator.tsx"),I=r("./app/utils/getDynamicText.tsx"),A=r("./app/utils/useOrganization.tsx"),j=r("./app/views/alerts/types.tsx"),P=r("./app/views/alerts/utils/index.tsx"),B=r("./app/views/alerts/wizard/options.tsx"),M=r("./app/views/alerts/wizard/utils.tsx"),X=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function L(e){let{organization:t,incident:r}=e;const i=(r.activities??[]).filter((e=>e.type===j.lm.STATUS_CHANGE)),a=i.find((e=>e.value===`${j.vt.CRITICAL}`)),n=i.find((e=>e.value===`${j.vt.WARNING}`)),o=a||n,l=Number(o.value)===j.vt.CRITICAL,d=i.find((e=>{let{previousValue:t}=e;return t===o.value})),c=(d?N()(d.dateCreated):N()()).diff(N()(o.dateCreated),"milliseconds"),u=l?"critical":"warning",p=r.alertRule.triggers.find((e=>e.label===u));return(0,X.BX)(s.Fragment,{children:[(0,X.BX)(H,{children:[o.value&&(0,X.tZ)(_.Z,{status:l?"error":"warning",tooltipTitle:(0,m.t)("Status: %s",l?(0,m.t)("Critical"):(0,m.t)("Warning"))}),(0,X.BX)(q.Z,{to:{pathname:(0,P.Gu)(t,r),query:{alert:r.identifier}},children:["#",r.identifier]})]}),(0,X.BX)(H,{children:[B.gb[(0,M.k)(r.alertRule)]," ",r.alertRule.thresholdType===v.lT.ABOVE?(0,m.t)("above"):(0,m.t)("below")," ",p?.alertThreshold]}),(0,X.tZ)(H,{children:c&&(0,I.Z)({value:(0,X.tZ)(b.Z,{abbreviation:!0,seconds:c/1e3}),fixed:"30s"})}),(0,X.tZ)(H,{children:(0,X.tZ)(O,{date:(0,I.Z)({value:r.dateCreated,fixed:"Mar 4, 2022 10:44:13 AM UTC"}),year:!0,seconds:!0,timeZone:!0})})]})}function k(e){let{incidents:t}=e;const r=(0,A.Z)(),i=(t??[]).filter((e=>e.activities?.length)),s=i.length;return(0,X.tZ)(E.Z,{items:s,collapseCount:3,disableBorder:!1,buttonTitle:(0,m.tn)("Hidden Alert","Hidden Alerts",s-3),children:e=>{let{isExpanded:t,showMoreButton:a}=e;return(0,X.BX)("div",{children:[(0,X.tZ)($,{headers:[(0,m.t)("Alert"),(0,m.t)("Reason"),(0,m.t)("Duration"),(0,m.t)("Date Triggered")],isEmpty:!s,emptyMessage:(0,m.t)("No alerts triggered during this time."),expanded:s<=3||t,children:i.map(((e,i)=>i>=3&&!t?null:(0,X.tZ)(L,{incident:e,organization:r},i)))}),a]})}})}L.displayName="MetricAlertActivity",k.displayName="MetricHistory";const F=k;var W={name:"ha13ji",styles:"margin-bottom:0px;border-bottom-left-radius:0px;border-bottom-right-radius:0px;border-bottom:none"};const $=(0,Z.Z)(z.Z,{target:"efqdtri2"})("grid-template-columns:max-content 1fr repeat(2, max-content);&>div{padding:",(0,C.D)(1)," ",(0,C.D)(2),";}div:last-of-type{padding:",(e=>e.isEmpty&&`48px ${(0,C.D)(1)}`),";}",(e=>!e.expanded&&W),";"),O=(0,Z.Z)(d.Z,{target:"efqdtri1"})("color:",(e=>e.theme.gray300),";"),H=(0,Z.Z)("div",{target:"efqdtri0"})("display:flex;align-items:center;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";padding:",(0,C.D)(1),";");var V=r("./app/views/alerts/rules/metric/utils/getEventTypeFilter.tsx"),G=r("./app/views/alerts/rules/metric/utils/isCrashFreeAlert.tsx"),U=r("./app/views/alerts/rules/metric/details/constants.tsx"),Y=r("../node_modules/react-router/es/index.js"),Q=r("../node_modules/color/index.js"),K=r.n(Q),J=r("../node_modules/lodash/capitalize.js"),ee=r.n(J),te=r("./app/components/acl/feature.tsx"),re=r("./app/components/button.tsx"),ie=r("./app/components/charts/areaChart.tsx"),se=r("./app/components/charts/chartZoom.tsx"),ae=r("./app/components/charts/components/markArea.tsx"),ne=r("./app/components/charts/components/markLine.tsx"),oe=r("./app/components/charts/eventsRequest.tsx"),le=r("./app/components/charts/series/lineSeries.tsx"),de=r("./app/components/charts/sessionsRequest.tsx"),ce=r("./app/components/charts/styles.tsx"),ue=r("./app/components/circleIndicator.tsx"),pe=r("./app/components/organizations/pageFilters/parse.tsx"),me=r("./app/components/truncate.tsx"),he=r("./app/icons/index.tsx"),ge=r("./app/stores/configStore.tsx"),ye=r("./app/utils/formatters.tsx"),xe=r("./app/utils/sessions.tsx"),ve=r("./app/utils/theme.tsx"),fe=r("./app/utils/toArray.tsx"),Ze=r("./app/utils/withDomainRequired.tsx"),we=r("./app/utils/withSentryRouter.tsx"),be=r("./app/views/alerts/rules/metric/constants.tsx"),Te=r("./app/utils/discover/types.tsx"),Se=r("./app/utils/discover/eventView.tsx"),De=r("./app/utils/discover/fields.tsx"),Ce=r("./app/views/performance/data.tsx");function Re(e){let{orgSlug:t,...r}=e;const i=Ne(r);if(!i||!r.rule)return"";const{query:s,...a}=i.getResultsViewUrlTarget(t);return{query:{...s,interval:`${r.rule.timeWindow}m`},...a}}function Ne(e){let{projects:t,rule:r,timePeriod:i,query:s,extraQueryParams:a}=e;if(!t||!t.length||!r)return"";const n=(0,De.LY)(r.aggregate),o=i.usingPeriod?{range:i.period===v.XH.SEVEN_DAYS?"7d":i.period}:{start:i.start,end:i.end},l=r.dataset===v.qz.ERRORS?["issue","count()","count_unique(user)"]:["transaction","project",`${r.aggregate}`,"count_unique(user)",`user_misery(${Ce.mW})`],d={id:void 0,name:r&&r.name||"Transactions",fields:l,orderby:`-${n}`,query:s??r.query??"",version:2,projects:t.filter((e=>{let{slug:t}=e;return r.projects.includes(t)})).map((e=>Number(e.id))),environment:r.environment?[r.environment]:void 0,...o,...a};return Se.ZP.fromSavedQuery(d)}function Ee(e){let{orgSlug:t,projects:r,rule:i,timePeriod:s,query:a}=e;if(!i)return{buttonText:(0,m.t)("Open in Discover"),to:""};const n={display:Te.DC.TOP5};return{buttonText:(0,m.t)("Open in Discover"),to:Re({orgSlug:t,projects:r,rule:i,timePeriod:s,query:a,extraQueryParams:n})}}var qe=r("./app/views/alerts/utils/getChangeStatus.tsx"),ze=r("./app/views/alerts/rules/metric/utils/getMetricDatasetQueryExtras.tsx"),_e=r("./app/constants/chartPalette.tsx");function Ie(e,t,r,i){return{seriesName:"",type:"line",markLine:(0,ne.Z)({silent:!0,lineStyle:{color:e,type:"solid",width:4},data:[[{coord:[t,i]},{coord:[r,i]}]]}),data:[]}}function Ae(e,t){return{seriesName:"Threshold Line",type:"line",markLine:(0,ne.Z)({silent:!0,lineStyle:{color:e,type:"dashed",width:1},data:[{yAxis:t}],label:{show:!1}}),data:[]}}function je(e,t){const{options:{timezone:r}}=ge.Z.get("user");return N().tz(e,r).format(t)}function Pe(e,t){const{dateModified:r}=e;if(!t.length||!t[0].data.length||!r)return[];const i=t[0].data,s=new Date(i[0].name).getTime(),a=new Date(r).getTime();return a<s?[]:[{type:"line",markLine:(0,ne.Z)({silent:!0,animation:!1,lineStyle:{color:ve.ZP.gray200,type:"solid",width:1},data:[{xAxis:a}],label:{show:!1}}),markArea:(0,ae.Z)({silent:!0,itemStyle:{color:K()(ve.ZP.gray100).alpha(.42).rgb().string()},data:[[{xAxis:s},{xAxis:a}]]}),data:[]}]}class Be extends s.PureComponent{constructor(){super(...arguments),(0,i.Z)(this,"state",{width:-1,height:-1}),(0,i.Z)(this,"ref",null),(0,i.Z)(this,"updateDimensions",(()=>{const e=this.ref?.getEchartsInstance?.();if(!e)return;const t=e.getWidth(),r=e.getHeight();t===this.state.width&&r===this.state.height||this.setState({width:t,height:r})})),(0,i.Z)(this,"handleRef",(e=>{e&&!this.ref&&(this.ref=e,this.updateDimensions()),e||(this.ref=null)})),(0,i.Z)(this,"handleZoom",((e,t)=>{const{location:r}=this.props;Y.browserHistory.push({pathname:r.pathname,query:{start:e,end:t}})}))}renderChartActions(e,t,r){const{rule:i,organization:s,project:a,timePeriod:n,query:o}=this.props,{buttonText:l,...d}=Ee({orgSlug:s.slug,projects:[a],rule:i,timePeriod:n,query:o}),c=100*Math.max(e-t-r,0)/e,u=100*Math.min(t/e,1),p=100*Math.min(r/e,1);return(0,X.BX)(ke,{children:[(0,X.BX)(Fe,{children:[(0,X.tZ)(ce.OT,{children:(0,m.t)("Summary")}),(0,X.BX)(He,{children:[(0,X.BX)(Ve,{children:[(0,X.tZ)(he.DL,{color:"successText",isCircled:!0}),c?c.toFixed(2):0,"%"]}),(0,X.BX)(Ve,{children:[(0,X.tZ)(he.FC,{color:"warningText"}),p?p.toFixed(2):0,"%"]}),(0,X.BX)(Ve,{children:[(0,X.tZ)(he.zC,{color:"errorText"}),u?u.toFixed(2):0,"%"]})]})]}),!(0,P.Eb)(i.aggregate)&&(0,X.tZ)(te.Z,{features:["discover-basic"],children:(0,X.tZ)(re.zx,{size:"sm",...d,children:l})})]})}renderChart(e,t,r,i){const{router:s,selectedIncident:a,interval:o,filter:l,incidents:d,rule:c,organization:u,timePeriod:{start:p,end:h}}=this.props,{width:g}=this.state,{dateModified:y,timeWindow:x}=c;if(e||!t)return this.renderEmpty();const{criticalDuration:f,warningDuration:Z,totalDuration:w,chartOption:b}=function(e){let{timeseriesData:t,rule:r,incidents:i,selectedIncident:s,handleIncidentClick:a}=e;const o=r.triggers.find((e=>{let{label:t}=e;return t===v.F4.CRITICAL})),l=r.triggers.find((e=>{let{label:t}=e;return t===v.F4.WARNING})),d=[...t],c=[];d[0].z=1,d[0].color=_e.$[0][0];const u=t[0].data,p=u.reduce(((e,t)=>Math.max(e,t.value)),0),h=(0,P.QR)(r.aggregate)?Math.floor(Math.min(u.reduce(((e,t)=>Math.min(e,t.value)),1/0),"number"==typeof l?.alertThreshold?l.alertThreshold:1/0,"number"==typeof o?.alertThreshold?o.alertThreshold:1/0)/P.t3):0,g=new Date(u[0]?.name).getTime(),y=new Date(u[u.length-1]?.name).getTime(),x=y-g;let f=0,Z=0;d.push(Ie(ve.Wb.green300,g,y,h)),i&&i.filter((e=>!e.dateClosed||new Date(e.dateClosed).getTime()>g)).forEach((e=>{const t=(e.activities??[]).filter((e=>{let{type:t,value:r}=e;return t===j.lm.STATUS_CHANGE&&[j.vt.WARNING,j.vt.CRITICAL].includes(Number(r))})).sort(((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime())),i=e.dateClosed??(new Date).getTime(),o=60*r.timeWindow*1e3,p=l&&!t.find((e=>{let{value:t}=e;return Number(t)===j.vt.CRITICAL}))?ve.Wb.yellow300:ve.Wb.red300,x=new Date(e.dateStarted).getTime(),v=e.dateClosed?new Date(e.dateClosed).getTime():y,w=u.find((e=>new Date(e.name).getTime()>=x));d.push(function(e,t,r,i,s,a,o){const l=t=>{let{value:r,marker:o}=t;const l=function(e,t){const{options:{timezone:r}}=ge.Z.get("user");return N().tz(e,r).format("MMM D, YYYY LT")}(n()(r));return['<div class="tooltip-series"><div>',`<span class="tooltip-label">${o} <strong>${(0,m.t)("Alert")} #${e.identifier}</strong></span>${i?.value?`${s} ${(0,P.qn)(i.value,s??"",a??"")}`:""}`,"</div></div>",`<div class="tooltip-footer">${l}</div>`,'<div class="tooltip-arrow"></div>'].join("")};return{seriesName:"Incident Line",type:"line",markLine:(0,ne.Z)({silent:!1,lineStyle:{color:t,type:"solid"},data:[{xAxis:r,onClick:()=>o?.(e)}],label:{silent:!0,show:!!e.identifier,position:"insideEndBottom",formatter:e.identifier,color:t,fontSize:10,fontFamily:"Rubik"},tooltip:{formatter:l}}),data:[],tooltip:{trigger:"item",alwaysShowContent:!0,formatter:l}}}(e,p,x,w,d[0].seriesName,r.aggregate,a));const b=Math.max(new Date(e.dateStarted).getTime(),g),T=Math.min(t.length&&t[0].dateCreated?new Date(t[0].dateCreated).getTime()-o:new Date(i).getTime(),y),S=l?ve.Wb.yellow300:ve.Wb.red300;if(T>b&&(d.push(Ie(S,b,T,h)),S===ve.Wb.yellow300?Z+=Math.abs(T-b):f+=Math.abs(T-b)),t.forEach(((e,r)=>{const s=Math.max(new Date(e.dateCreated).getTime()-o,g),a=Math.min(r===t.length-1?new Date(i).getTime():new Date(t[r+1].dateCreated).getTime()-o,y),n=e.value===`${j.vt.CRITICAL}`?ve.Wb.red300:ve.Wb.yellow300;a>s&&(d.push(Ie(n,s,a,h)),n===ve.Wb.yellow300?Z+=Math.abs(a-s):f+=Math.abs(a-s))})),s&&e.id===s.id){const e=p===ve.Wb.yellow300?ve.Wb.yellow100:ve.Wb.red100;c.push({seriesName:"",type:"line",markArea:(0,ae.Z)({silent:!0,itemStyle:{color:K()(e).alpha(.42).rgb().string()},data:[[{xAxis:x},{xAxis:v}]]}),data:[]})}}));let w=0;if(!r.comparisonDelta&&l?.alertThreshold){const{alertThreshold:e}=l,t=Ae(ve.Wb.yellow300,e);d.push(t),w=Math.max(w,e)}if(!r.comparisonDelta&&o?.alertThreshold){const{alertThreshold:e}=o,t=Ae(ve.Wb.red300,e);d.push(t),w=Math.max(w,e)}if(!r.comparisonDelta&&r.resolveThreshold){const e=Ae(ve.Wb.green300,r.resolveThreshold);d.push(e),w=Math.max(w,r.resolveThreshold)}const b={axisLabel:{formatter:e=>(0,P.lR)(e,t[0].seriesName,r.aggregate)},max:(0,G.I)(r.dataset)?100:w>p?w:void 0,min:h||void 0};return{criticalDuration:f,warningDuration:Z,totalDuration:x,chartOption:{isGroupedByDate:!0,yAxis:b,series:d,grid:{left:(0,C.D)(.25),right:(0,C.D)(2),top:(0,C.D)(3),bottom:0}}}}({timeseriesData:t,rule:c,incidents:d,selectedIncident:a,handleIncidentClick:e=>{s.push((0,Ze.D)({pathname:(0,P.Gu)(u,e),query:{alert:e.identifier}}))}}),T=ee()(be.KP.find((e=>{let{value:t}=e;return t===c.comparisonDelta}))?.label||""),S=[...(i||[]).map((e=>{let{data:t,...r}=e;return(0,le.Z)({name:T,data:t.map((e=>{let{name:t,value:r}=e;return[t,r]})),lineStyle:{color:ve.ZP.gray200,type:"dashed",width:1},itemStyle:{color:ve.ZP.gray200},animation:!1,animationThreshold:1,animationDuration:0,...r})})),...Pe(c,t)],R=l?.join(" ")+(0,m.t)(" over ")+(0,ye.g9)(60*c.timeWindow),E=(g>=1151?15:g<1151&&g>=700?14:g<700&&g>=515?13:g<515&&g>=300?12:8)/100*g;return(0,X.BX)(Xe,{children:[(0,X.BX)(Ge,{withPadding:!0,children:[(0,X.tZ)(Le,{children:(0,X.tZ)(ce.ws,{children:B.gb[(0,M.k)(c)]})}),(0,X.BX)($e,{children:[(0,X.tZ)(We,{size:8}),(0,X.tZ)(Oe,{children:c.aggregate}),(0,X.tZ)(me.Z,{value:R??"",maxLength:E})]}),(0,I.Z)({value:(0,X.tZ)(se.Z,{router:s,start:p,end:h,onZoom:e=>this.handleZoom(e.start,e.end),onFinished:()=>{this.updateDimensions()},children:e=>(0,X.tZ)(ie.T,{...e,...b,showTimeInTooltip:!0,minutesThresholdToDisplaySeconds:r,forwardedRef:this.handleRef,additionalSeries:S,tooltip:{formatter:e=>{const t=(0,fe.Z)(e),{marker:r,data:i,seriesName:s}=t[0],[a,l]=i,d=(0,P.qn)(l,s??"",c.aggregate),u=y&&a<=new Date(y).getTime(),p=je(n()(a),"MMM D LT"),{period:h,periodLength:g}=(0,pe.su)(o)??{periodLength:"m",period:`${x}`},f=je(n()(a).add(parseInt(h,10),g),"MMM D LT"),Z=t.length>1?t.find((e=>{let{seriesName:t}=e;return t===T})):void 0,w=Z?.data[1],b=void 0!==w?(0,P.qn)(w,s??"",c.aggregate):void 0,S=void 0===w?NaN:100*(l-w)/w,D=(0,qe.R)(S,c.thresholdType,c.triggers),C=D===v.F4.CRITICAL?ve.ZP.red300:D===v.F4.WARNING?ve.ZP.yellow300:ve.ZP.green300;return['<div class="tooltip-series">',u&&`<div><span class="tooltip-label"><strong>${(0,m.t)("Alert Rule Modified")}</strong></span></div>`,`<div><span class="tooltip-label">${r} <strong>${s}</strong></span>${d}</div>`,Z&&`<div><span class="tooltip-label">${Z.marker} <strong>${T}</strong></span>${b}</div>`,"</div>",'<div class="tooltip-footer">',`<span>${p} &mdash; ${f}</span>`,void 0!==w&&Math.abs(S)!==1/0&&!isNaN(S)&&`<span style="color:${C};margin-left:10px;">${1===Math.sign(S)?"+":"-"}${Math.abs(S).toFixed(2)}%</span>`,"</div>",'<div class="tooltip-arrow"></div>'].filter((e=>e)).join("")}}})}),fixed:(0,X.tZ)(D.Z,{height:"200px",testId:"skeleton-ui"})})]}),this.renderChartActions(w,f,Z)]})}renderEmpty(){return(0,X.tZ)(Xe,{children:(0,X.tZ)(S.N,{withPadding:!0,children:(0,X.tZ)(D.Z,{height:"200px"})})})}render(){const{api:e,rule:t,organization:r,timePeriod:i,project:s,interval:a,query:o,location:l}=this.props,{aggregate:d,timeWindow:c,environment:u,dataset:p}=t;i.usingPeriod&&i.period===v.XH.SEVEN_DAYS&&"1m"===a&&(i.start=(0,g.v5)(n()(n().utc(i.end).subtract(9995,"minutes"))));const m=(0,g.v5)(n().min(n().utc(i.start),n().utc(i.end).subtract(c,"minutes"))),h=(0,g.v5)(n().utc(i.end).add(c,"minutes")),y=(0,ze.L)({organization:r,location:l,dataset:p,newAlertOrQuery:!1});return(0,G.I)(p)?(0,X.tZ)(de.Z,{api:e,organization:r,project:s.id?[Number(s.id)]:[],environment:u?[u]:void 0,start:m,end:h,query:o,interval:a,field:P.Vc[d],groupBy:["session.status"],children:e=>{let{loading:r,response:i}=e;return this.renderChart(r,function(e,t){const{aggregate:r}=t;return[{seriesName:B.gb[(0,M.k)({aggregate:r,dataset:v.qz.SESSIONS})],data:(0,xe.FS)(e?.groups,e?.intervals,P.Vc[r])}]}(i,t),xe.VH)}}):(0,X.tZ)(oe.Z,{api:e,organization:r,query:o,environment:u?[u]:void 0,project:s.id?[Number(s.id)]:[],interval:a,comparisonDelta:t.comparisonDelta?60*t.comparisonDelta:void 0,start:m,end:h,yAxis:d,includePrevious:!1,currentSeriesNames:[d],partial:!1,queryExtras:y,referrer:"api.alerts.alert-rule-chart",children:e=>{let{loading:t,timeseriesData:r,comparisonTimeseriesData:i}=e;return this.renderChart(t,r,void 0,i)}})}}Be.displayName="MetricChart";const Me=(0,we.Z)(Be),Xe=(0,Z.Z)(S.s_,{target:"ei2qm399"})("margin-top:",(0,C.D)(2),";"),Le=(0,Z.Z)("div",{target:"ei2qm398"})("margin-bottom:",(0,C.D)(3),";"),ke=(0,Z.Z)(ce.xx,{target:"ei2qm397"})({name:"qgg235",styles:"display:flex;justify-content:space-between;flex-wrap:wrap"}),Fe=(0,Z.Z)(ce.m2,{target:"ei2qm396"})("grid-auto-flow:column;grid-column-gap:",(0,C.D)(1),";"),We=(0,Z.Z)(ue.Z,{target:"ei2qm395"})("background:",(e=>e.theme.formText),";height:",(0,C.D)(1),";margin-right:",(0,C.D)(.5),";"),$e=(0,Z.Z)("div",{target:"ei2qm394"})("font-size:",(e=>e.theme.fontSizeSmall),";font-family:",(e=>e.theme.text.family),";color:",(e=>e.theme.textColor),";display:inline-grid;grid-template-columns:repeat(3, max-content);align-items:center;"),Oe=(0,Z.Z)("span",{target:"ei2qm393"})("margin-right:",(0,C.D)(1),";"),He=(0,Z.Z)(ce.uN,{target:"ei2qm392"})("display:grid;grid-template-columns:repeat(3, auto);gap:",(0,C.D)(1.5),";margin:0 0 0 ",(0,C.D)(1.5),";"),Ve=(0,Z.Z)("div",{target:"ei2qm391"})("display:grid;grid-template-columns:repeat(2, auto);gap:",(0,C.D)(.5),";align-items:center;font-variant-numeric:tabular-nums;"),Ge=(0,Z.Z)(S.N,{target:"ei2qm390"})({name:"sgs7ru",styles:"padding-right:6px"});var Ue=r("./app/components/emptyStateWarning.tsx"),Ye=r("./app/components/issues/groupList.tsx"),Qe=r("./app/components/loadingError.tsx"),Ke=r("./app/views/alerts/rules/metric/details/relatedIssuesNotAvailable.tsx");function Je(e){let{rule:t,organization:r,projects:i,query:a,timePeriod:n}=e;const{start:o,end:l}=n,d=`/organizations/${r.slug}/issues/`,c={start:o,end:l,groupStatsPeriod:"auto",limit:5,...t.environment?{environment:t.environment}:{},sort:"count_unique(user)"===t.aggregate?"user":"freq",query:a,project:i.map((e=>e.id))},u={pathname:`/organizations/${r.slug}/issues/`,query:c};return(0,X.BX)(s.Fragment,{children:[(0,X.BX)(tt,{children:[(0,X.tZ)(et,{children:(0,m.t)("Related Issues")}),(0,X.tZ)(re.zx,{"data-test-id":"issues-open",size:"xs",to:u,children:(0,m.t)("Open in Issues")})]}),(0,X.tZ)(rt,{children:(0,X.tZ)(Ye.Z,{orgId:r.slug,endpointPath:d,queryParams:c,query:`start=${o}&end=${l}&groupStatsPeriod=auto`,canSelectGroups:!1,renderEmptyMessage:function(){return(0,X.tZ)(S.s_,{children:(0,X.tZ)(S.N,{children:(0,X.tZ)(Ue.Z,{small:!0,withIcon:!1,children:(0,m.t)("No issues for this alert rule")})})})},renderErrorMessage:function(e,s){let{detail:o}=e;if(o===Ke.H&&!(0,P.Eb)(t.aggregate)){const{buttonText:e,to:s}=Ee({orgSlug:r.slug,projects:i,rule:t,query:a,timePeriod:n});return(0,X.tZ)(Ke.z,{buttonTo:s,buttonText:e})}return(0,X.tZ)(Qe.Z,{onRetry:s})},withChart:!0,withPagination:!1,useFilteredStats:!0,customStatsPeriod:n,useTintRow:!1,source:"alerts-related-issues"})})]})}Je.displayName="RelatedIssues";const et=(0,Z.Z)(ce.OT,{target:"e19bgavq2"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),tt=(0,Z.Z)("div",{target:"e19bgavq1"})("display:flex;align-items:center;justify-content:space-between;margin-bottom:",(0,C.D)(1),";"),rt=(0,Z.Z)("div",{target:"e19bgavq0"})("margin-bottom:",(0,C.D)(4),";",S.s_,"{margin-bottom:-",(0,C.D)(1),";}"),it=Je;var st=r("./app/components/gridEditable/index.tsx"),at=r("./app/utils/discover/discoverQuery.tsx"),nt=r("./app/utils/discover/fieldRenderers.tsx"),ot=r("./app/views/performance/transactionSummary/utils.tsx"),lt=r("./app/views/performance/utils.tsx");class dt extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{widths:[]}),(0,i.Z)(this,"renderBodyCellWithData",(e=>(t,r)=>this.renderBodyCell(e,t,r))),(0,i.Z)(this,"renderHeadCellWithMeta",((e,t)=>{const r=["transactions","project",t,"users","user misery"];return(t,i)=>this.renderHeadCell(e,t,r[i])})),(0,i.Z)(this,"handleResizeColumn",((e,t)=>{const r=[...this.state.widths];r[e]=t.width?Number(t.width):st.z7,this.setState({widths:r})}))}renderBodyCell(e,t,r){const{eventView:i,organization:s,projects:a,location:n,summaryConditions:o}=this.props;if(!e||!e.meta)return r[t.key];const l=e.meta,d=String(t.key),c=(0,nt.Js)(d,l,!1)(r,{organization:s,location:n});if("transaction"===d){const e=(0,lt.cY)(r,a),t=i.clone();t.query=o;const n=(0,ot.e1)({orgSlug:s.slug,transaction:String(r.transaction)||"",query:t.generateQueryStringObject(),projectID:e});return(0,X.tZ)(q.Z,{to:n,children:c})}return c}renderHeadCell(e,t,r){const i=(0,De.qG)(t.name,t.type,e),s={field:t.name,width:t.width};return(0,X.tZ)(pt,{align:i,children:r||s.field})}getSortedEventView(){const{eventView:e}=this.props;return e.withSorts([...e.sorts])}render(){const{eventView:e,organization:t,location:r}=this.props,{widths:i}=this.state,a=e.getColumns().map(((e,t)=>"number"==typeof i[t]?{...e,width:i[t]}:e)),n=this.getSortedEventView(),o=n.getSorts();return(0,X.tZ)(s.Fragment,{children:(0,X.tZ)(at.Z,{eventView:n,orgSlug:t.slug,location:r,children:e=>{let{isLoading:t,tableData:i}=e;return(0,X.tZ)(st.ZP,{isLoading:t,data:i?i.data.slice(0,5):[],columnOrder:a,columnSortBy:o,grid:{onResizeColumn:this.handleResizeColumn,renderHeadCell:this.renderHeadCellWithMeta(i?.meta,a[2].name),renderBodyCell:this.renderBodyCellWithData(i)},location:r})}})})}}function ct(e){let{rule:t,projects:r,filter:i,location:s,organization:a,timePeriod:n}=e;const o=Ne({rule:t,timePeriod:n,projects:r});return o?(0,X.tZ)(dt,{eventView:o,projects:r,organization:a,location:s,summaryConditions:`${t.query} ${i}`}):null}dt.displayName="Table",ct.displayName="RelatedTransactions";const ut=ct,pt=(0,Z.Z)("div",{target:"e1dgy1j20"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";");var mt=r("./app/components/alertBadge.tsx"),ht=r("./app/components/avatar/actorAvatar.tsx"),gt=r("./app/components/keyValueTable.tsx"),yt=r("./app/components/timeSince.tsx");class xt extends s.PureComponent{getTimeWindow(){const{rule:e}=this.props;if(!e)return"";const{timeWindow:t}=e;return(0,X.tZ)(b.Z,{seconds:60*t})}renderTrigger(e,t,r){const{rule:i}=this.props,s=e===v.F4.CRITICAL?(0,m.t)("Critical"):e===v.F4.WARNING?(0,m.t)("Warning"):(0,m.t)("Resolved"),a=e===v.F4.CRITICAL?"errorText":e===v.F4.WARNING?"warningText":"successText",n=(0,m.t)("Change alert status to %s",s),o=(e===v.F4.RESOLVE?i.thresholdType===v.lT.BELOW:i.thresholdType===v.lT.ABOVE)?i.comparisonDelta?(0,m.t)("higher"):(0,m.t)("above"):i.comparisonDelta?(0,m.t)("lower"):(0,m.t)("below"),l=i.comparisonDelta?(0,m._N)("[metric] is [threshold]% [comparisonType] in [timeWindow] compared to [comparisonDelta]",{metric:B.gb[(0,M.k)(i)],threshold:t,comparisonType:o,timeWindow:this.getTimeWindow(),comparisonDelta:(be.KP.find((e=>{let{value:t}=e;return t===i.comparisonDelta}))??be.KP[0]).label}):(0,m._N)("[metric] is [condition] in [timeWindow]",{metric:B.gb[(0,M.k)(i)],condition:`${o} ${t}`,timeWindow:this.getTimeWindow()});return(0,X.BX)(St,{children:[(0,X.BX)(Dt,{children:[(0,X.tZ)(he.Sq,{color:a,size:"xs"}),(0,X.tZ)(Ct,{children:(0,m.t)("%s Conditions",s)})]}),(0,X.BX)(Rt,{children:[(0,X.tZ)(Ct,{children:"When"}),(0,X.tZ)(Nt,{children:(0,X.tZ)(Et,{children:l})})]}),(0,X.BX)(Rt,{children:[(0,X.tZ)(Ct,{children:"Then"}),(0,X.BX)(Nt,{children:[r.map((e=>(0,X.tZ)(Et,{children:e.desc},e.id))),(0,X.tZ)(Et,{children:n})]})]})]})}render(){const{rule:e}=this.props,t=e.latestIncident,r=t?t.status:j.vt.CLOSED,i=t?.dateClosed??t?.dateStarted??null,a=e?.triggers.find((e=>{let{label:t}=e;return t===v.F4.CRITICAL})),n=e?.triggers.find((e=>{let{label:t}=e;return t===v.F4.WARNING})),o=e.owner?.split(":")[1],l=o&&{type:"team",id:o,name:""};return(0,X.BX)(s.Fragment,{children:[(0,X.BX)(wt,{children:[(0,X.BX)(ft,{children:[(0,X.tZ)(bt,{noMargin:!0,children:(0,m.t)("Alert Status")}),(0,X.tZ)(Zt,{children:(0,X.tZ)(mt.Z,{status:r,withText:!0})})]}),(0,X.BX)(ft,{children:[(0,X.tZ)(bt,{noMargin:!0,children:(0,m.t)("Last Triggered")}),(0,X.tZ)(Zt,{children:i?(0,X.tZ)(yt.Z,{date:i}):(0,m.t)("No alerts triggered")})]})]}),(0,X.BX)(vt,{children:["number"==typeof a?.alertThreshold&&this.renderTrigger(a.label,a.alertThreshold,a.actions),"number"==typeof n?.alertThreshold&&this.renderTrigger(n.label,n.alertThreshold,n.actions),"number"==typeof e.resolveThreshold&&this.renderTrigger(v.F4.RESOLVE,e.resolveThreshold,[])]}),(0,X.BX)(vt,{children:[(0,X.tZ)(bt,{children:(0,m.t)("Alert Rule Details")}),(0,X.BX)(gt.v,{children:[(0,X.tZ)(gt.G,{keyName:(0,m.t)("Environment"),value:(0,X.tZ)(Tt,{children:e.environment??"-"})}),(0,X.tZ)(gt.G,{keyName:(0,m.t)("Date created"),value:(0,X.tZ)(d.Z,{date:(0,I.Z)({value:e.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),e.createdBy&&(0,X.tZ)(gt.G,{keyName:(0,m.t)("Created By"),value:(0,X.tZ)(Tt,{children:e.createdBy.name??"-"})}),e.dateModified&&(0,X.tZ)(gt.G,{keyName:(0,m.t)("Last Modified"),value:(0,X.tZ)(yt.Z,{date:e.dateModified,suffix:(0,m.t)("ago")})}),(0,X.tZ)(gt.G,{keyName:(0,m.t)("Team"),value:l?(0,X.tZ)(ht.Z,{actor:l,size:24}):(0,m.t)("Unassigned")})]})]})]})}}xt.displayName="Sidebar";const vt=(0,Z.Z)("div",{target:"e1uhir5m11"})("margin-bottom:",(0,C.D)(3),";"),ft=(0,Z.Z)("div",{target:"e1uhir5m10"})({name:"10sya4f",styles:"flex:1;display:flex;flex-direction:column;>*:nth-child(2){flex:1;display:flex;align-items:center;}"}),Zt=(0,Z.Z)("div",{target:"e1uhir5m9"})("position:relative;display:grid;grid-template-columns:auto auto auto;gap:",(0,C.D)(.5),";font-size:",(e=>e.theme.fontSizeLarge),";"),wt=(0,Z.Z)("div",{target:"e1uhir5m8"})("height:60px;display:flex;margin-bottom:",(0,C.D)(1),";"),bt=(0,Z.Z)(ce.OT,{target:"e1uhir5m7"})("margin-top:",(e=>e.noMargin?0:(0,C.D)(2)),";margin-bottom:",(e=>e.noMargin?0:(0,C.D)(1)),";"),Tt=(0,Z.Z)("div",{target:"e1uhir5m6"})((e=>e.theme.overflowEllipsis),";"),St=(0,Z.Z)("div",{target:"e1uhir5m5"})("display:grid;grid-template-rows:auto auto auto;gap:",(0,C.D)(1),";margin-top:",(0,C.D)(4),";"),Dt=(0,Z.Z)("div",{target:"e1uhir5m4"})({name:"z76o0d",styles:"display:grid;grid-template-columns:20px 1fr;align-items:center"}),Ct=(0,Z.Z)("h4",{target:"e1uhir5m3"})("color:",(e=>e.theme.subText),";font-size:",(e=>e.theme.fontSizeMedium),";margin:0;line-height:24px;min-width:40px;"),Rt=(0,Z.Z)("div",{target:"e1uhir5m2"})({name:"9i9rp7",styles:"display:grid;grid-template-columns:40px 1fr;align-items:stretch"}),Nt=(0,Z.Z)("div",{target:"e1uhir5m1"})("display:grid;grid-template-columns:repeat(1fr);gap:",(0,C.D)(.25),";align-items:center;"),Et=(0,Z.Z)("span",{target:"e1uhir5m0"})("display:block;background-color:",(e=>e.theme.surface200),";padding:",(0,C.D)(.25)," ",(0,C.D)(.75),";border-radius:",(e=>e.theme.borderRadius),";color:",(e=>e.theme.textColor),";font-size:",(e=>e.theme.fontSizeSmall),";width:100%;font-weight:400;");class qt extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"handleTimePeriodChange",(e=>{const{start:t,end:r,relative:i}=e;return t&&r?this.props.router.push({...this.props.location,query:{start:n()(t).utc().format(),end:n()(r).utc().format()}}):this.props.router.push({...this.props.location,query:{period:i}})}))}getTimeWindow(){const{rule:e}=this.props;if(!e)return"";const{timeWindow:t}=e;return(0,m._N)("[window]",{window:(0,X.tZ)(b.Z,{seconds:60*t})})}getInterval(){const{timePeriod:{start:e,end:t},rule:r}=this.props,i=n().utc(e),s=n().utc(t),a=r?.timeWindow,o=s.diff(i);return a&&(o<U.UC*a*60*1e3||o===U.e2[v.XH.SEVEN_DAYS])?`${a}m`:(0,w.ZS)({start:e,end:t},"high")}getFilter(){const{rule:e}=this.props,{dataset:t,query:r}=e??{};return e?[(0,G.I)(t)?null:(0,V.r)(e),r].join(" ").split(" "):null}renderLoading(){return(0,X.BX)(c.uT,{children:[(0,X.BX)(c.or,{children:[(0,X.tZ)(D.Z,{height:"38px"}),(0,X.tZ)(jt,{children:(0,X.tZ)(S.N,{withPadding:!0,children:(0,X.tZ)(D.Z,{height:"200px"})})})]}),(0,X.tZ)(c.MF,{children:(0,X.tZ)(D.Z,{height:"200px"})})]})}render(){const{api:e,project:t,rule:r,incidents:i,location:a,organization:n,timePeriod:o,selectedIncident:l}=this.props;if(!r||!t)return this.renderLoading();const{query:d,dataset:u}=r,p=`${d} ${(0,V.r)(r)}`.trim(),h={...U.ud,...r.timeWindow>1?{[v.XH.FOURTEEN_DAYS]:(0,m.t)("Last 14 days")}:{}};return(0,X.BX)(s.Fragment,{children:[l&&l.alertRule.status===j.Gb.SNAPSHOT&&(0,X.tZ)(_t,{children:(0,X.tZ)(It,{type:"warning",showIcon:!0,children:(0,m.t)("Alert Rule settings have been updated since this alert was triggered.")})}),(0,X.BX)(c.uT,{children:[(0,X.BX)(c.or,{children:[(0,X.tZ)(Pt,{organization:n,relative:o.period??"",start:o.custom&&o.start||null,end:o.custom&&o.end||null,utc:null,onUpdate:this.handleTimePeriodChange,relativeOptions:h,showAbsolute:!1}),(0,X.tZ)(Me,{api:e,rule:r,incidents:i,timePeriod:o,selectedIncident:l,organization:n,project:t,interval:this.getInterval(),query:(0,G.I)(u)?d:p,filter:this.getFilter()}),(0,X.tZ)(zt,{children:(0,X.BX)(At,{children:[(0,X.tZ)(F,{incidents:i}),[v.qz.METRICS,v.qz.SESSIONS,v.qz.ERRORS].includes(u)&&(0,X.tZ)(it,{organization:n,rule:r,projects:[t],timePeriod:o,query:u===v.qz.ERRORS?p:(0,G.I)(u)?`${d} error.unhandled:true`:void 0}),u===v.qz.TRANSACTIONS&&(0,X.tZ)(ut,{organization:n,location:a,rule:r,projects:[t],timePeriod:o,filter:(0,V.r)(r)})]})})]}),(0,X.tZ)(c.MF,{children:(0,X.tZ)(xt,{rule:r})})]})]})}}qt.displayName="DetailsBody";const zt=(0,Z.Z)("div",{target:"e1vloqpg5"})("display:flex;flex:1;@media (max-width: ",(e=>e.theme.breakpoints.small),"){flex-direction:column-reverse;}"),_t=(0,Z.Z)(c.uT,{target:"e1vloqpg4"})("flex-grow:0;padding-bottom:0!important;@media (min-width: ",(e=>e.theme.breakpoints.medium),"){grid-template-columns:auto;}"),It=(0,Z.Z)(l.bZ,{target:"e1vloqpg3"})({name:"ti75j2",styles:"margin:0"}),At=(0,Z.Z)("div",{target:"e1vloqpg2"})({name:"qu1srz",styles:"display:flex;flex:1;flex-direction:column;width:100%"}),jt=(0,Z.Z)(S.s_,{target:"e1vloqpg1"})("margin-top:",(0,C.D)(2),";"),Pt=(0,Z.Z)(T.Z,{target:"e1vloqpg0"})("margin-bottom:",(0,C.D)(2),";");var Bt=r("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),Mt=r("./app/components/breadcrumbs.tsx"),Xt=r("./app/components/buttonBar.tsx"),Lt=r("./app/components/idBadge/index.tsx");function kt(e){let{hasMetricRuleDetailsError:t,rule:r,organization:i,project:s}=e;const a=!!r&&!t,n=r&&!t?r.name:"",o=r&&`/organizations/${i.slug}/alerts/${(0,P.Gm)(r)?"rules":"metric-rules"}/${s?.slug??r?.projects?.[0]}/${r.id}/`,l={pathname:`/organizations/${i.slug}/alerts/new/metric/`,query:{project:s?.slug,duplicateRuleId:r?.id,createFromDuplicate:!0,referrer:"metric_rule_details"}};return(0,X.BX)(c.h4,{children:[(0,X.BX)(c.oB,{children:[(0,X.tZ)(Mt.Z,{crumbs:[{label:(0,m.t)("Alerts"),to:`/organizations/${i.slug}/alerts/rules/`},{label:n}]}),(0,X.BX)(Wt,{"data-test-id":"incident-rule-title",loading:!a,children:[s&&(0,X.tZ)(Lt.Z,{project:s,avatarSize:28,hideName:!0,avatarProps:{hasTooltip:!0,tooltip:s.slug}}),n]})]}),(0,X.tZ)(c.kP,{children:(0,X.BX)(Xt.ZP,{gap:1,children:[(0,X.tZ)(re.zx,{size:"sm",icon:(0,X.tZ)(he.vU,{}),to:l,children:(0,m.t)("Duplicate")}),(0,X.tZ)(re.zx,{size:"sm",icon:(0,X.tZ)(he.yl,{}),to:o,children:(0,m.t)("Edit Rule")})]})})]})}kt.displayName="DetailsHeader";const Ft=kt,Wt=(0,Z.Z)(c.Dx,{shouldForwardProp:e=>"string"==typeof e&&(0,Bt.Z)(e)&&"loading"!==e,target:"e3oxdt20"})((e=>e.loading&&"opacity: 0"),";");class $t extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{isLoading:!1,hasError:!1,error:null,selectedIncident:null}),(0,i.Z)(this,"fetchData",(async()=>{const{api:e,organization:t,params:{ruleId:r},location:i}=this.props;this.setState({isLoading:!0,hasError:!1});const s=r===this.state.rule?.id?Promise.resolve(this.state.rule):(0,f.dX)(t.slug,r,{expand:"latestIncident"});let a=null;if(i.query.alert)try{a=await(0,f.yN)(e,t.slug,i.query.alert)}catch{}const n=this.getTimePeriod(a),{start:o,end:l}=n;try{const[e,i]=await Promise.all([(0,f.hl)(t.slug,r,o,l),s]);this.setState({incidents:e,rule:i,selectedIncident:a,isLoading:!1,hasError:!1})}catch(e){this.setState({selectedIncident:a,isLoading:!1,hasError:!0,error:e})}}))}componentDidMount(){const{api:e,organization:t}=this.props;(0,o.MA)(e,t.slug),this.fetchData(),this.trackView()}componentDidUpdate(e){e.location.search===this.props.location.search&&e.organization.slug===this.props.organization.slug&&e.params.ruleId===this.props.params.ruleId||(this.fetchData(),this.trackView())}trackView(){const{params:e,organization:t,location:r}=this.props;(0,h.Gi)("alert_rule_details.viewed",{organization:t,rule_id:parseInt(e.ruleId,10),alert:r.query.alert??"",has_chartcuterie:t.features.includes("metric-alert-chartcuterie").toString()})}getTimePeriod(e){const{location:t}=this.props,r=t.query.period??v.XH.SEVEN_DAYS;if(t.query.start&&t.query.end)return{start:t.query.start,end:t.query.end,period:r,usingPeriod:!1,label:(0,m.t)("Custom time"),display:(0,X.BX)(s.Fragment,{children:[(0,X.tZ)(d.Z,{date:n().utc(t.query.start)})," — ",(0,X.tZ)(d.Z,{date:n().utc(t.query.end)})]}),custom:!0};if(t.query.alert&&e){const{start:t,end:i}=function(e){const t=60*e.alertRule.timeWindow*1e3,r=t*U.U2,i=t*U.UC,s=n().utc(),a=n().utc(e.dateStarted),o=e.dateClosed?n().utc(e.dateClosed):n()(s),l=Math.max(o.diff(a),3*t),d=Math.min(i,Math.max(r,l)),c=n().duration(d/2);return{start:(0,g.v5)(a.subtract(c)),end:(0,g.v5)(n().min(o.add(c),s))}}(e);return{start:t,end:i,period:r,usingPeriod:!1,label:(0,m.t)("Custom time"),display:(0,X.BX)(s.Fragment,{children:[(0,X.tZ)(d.Z,{date:n().utc(t)})," — ",(0,X.tZ)(d.Z,{date:n().utc(i)})]}),custom:!0}}const i=U.v3.find((e=>e.value===r))??U.v3[1];return{start:(0,g.v5)(n()(n().utc().diff(U.e2[i.value]))),end:(0,g.v5)(n().utc()),period:r,usingPeriod:!0,label:i.label,display:i.label}}renderError(){const{error:e}=this.state;return(0,X.tZ)(c.T3,{withPadding:!0,children:(0,X.tZ)(l.bZ,{type:"error",showIcon:!0,children:404===e?.status?(0,m.t)("This alert rule could not be found."):(0,m.t)("An error occurred while fetching the alert rule.")})})}render(){const{rule:e,incidents:t,hasError:r,selectedIncident:i}=this.state,{organization:s,projects:a,loadingProjects:n}=this.props,o=this.getTimePeriod(i);if(r)return this.renderError();const l=a.find((t=>{let{slug:r}=t;return r===e?.projects[0]})),d=void 0!==l&&!n;return(0,X.BX)(u.Z,{skipLoadLastUsed:!0,skipInitializeUrlParams:!0,shouldForceProject:d,forceProject:l,children:[(0,X.tZ)(p.Z,{title:e?.name??""}),(0,X.tZ)(Ft,{hasMetricRuleDetailsError:r,organization:s,rule:e,project:l}),(0,X.tZ)(qt,{...this.props,rule:e,project:l,incidents:t,timePeriod:o,selectedIncident:i})]})}}$t.displayName="MetricAlertDetails";const Ot=(0,y.Z)((0,x.Z)($t))},"./app/views/alerts/rules/metric/utils/getEventTypeFilter.tsx":(e,t,r)=>{r.d(t,{m:()=>o,r:()=>n});var i=r("./app/views/alerts/utils/index.tsx"),s=r("./app/views/alerts/rules/metric/constants.tsx"),a=r("./app/views/alerts/rules/metric/types.tsx");function n(e){const{dataset:t,eventTypes:r}=e;return o(t,r)}function o(e,t){return t?s.P1[(0,i.KC)(e,t)??a.Yh.ERROR]:s.hh[e??a.qz.ERRORS]}},"./app/views/alerts/rules/metric/utils/getMetricDatasetQueryExtras.tsx":(e,t,r)=>{r.d(t,{L:()=>a});var i=r("./app/utils/queryString.tsx"),s=r("./app/views/alerts/wizard/options.tsx");function a(e){let{organization:t,location:r,dataset:a,newAlertOrQuery:n}=e;const o=t.features.includes("mep-rollout-flag"),l="true"===(0,i.ro)(r?.query?.disableMetricDataset);return o&&!l?{dataset:(0,s.S)(a,n)}:{}}},"./app/views/alerts/rules/metric/utils/isCrashFreeAlert.tsx":(e,t,r)=>{r.d(t,{I:()=>s});var i=r("./app/views/alerts/rules/metric/types.tsx");function s(e){return void 0!==e&&[i.qz.SESSIONS,i.qz.METRICS].includes(e)}},"./app/views/alerts/utils/apiCalls.tsx":(e,t,r)=>{r.d(t,{dX:()=>s,hl:()=>a,yN:()=>n});const i=new(r("./app/api.tsx").KU);function s(e,t,r){return i.requestPromise(`/organizations/${e}/alert-rules/${t}/`,{query:r})}function a(e,t,r,s){return i.requestPromise(`/organizations/${e}/incidents/`,{query:{project:"-1",alertRule:t,includeSnapshots:!0,start:r,end:s,expand:["activities","seen_by","original_alert_rule"]}})}function n(e,t,r){return e.requestPromise(`/organizations/${t}/incidents/${r}/`)}},"./app/views/alerts/utils/getChangeStatus.tsx":(e,t,r)=>{r.d(t,{R:()=>s});var i=r("./app/views/alerts/rules/metric/types.tsx");const s=(e,t,r)=>{const s=r?.find((e=>e.label===i.F4.CRITICAL)),a=r?.find((e=>e.label===i.F4.WARNING)),n="number"==typeof s?.alertThreshold?s.alertThreshold:void 0,o="number"==typeof a?.alertThreshold?a.alertThreshold:void 0;return t===i.lT.ABOVE&&n&&e>=n?i.F4.CRITICAL:t===i.lT.ABOVE&&o&&e>=o?i.F4.WARNING:t===i.lT.BELOW&&n&&-1*e>=n?i.F4.CRITICAL:t===i.lT.BELOW&&o&&-1*e>=o?i.F4.WARNING:""}},"./app/views/alerts/wizard/utils.tsx":(e,t,r)=>{r.d(t,{k:()=>a});var i=r("./app/views/alerts/rules/metric/types.tsx");const s={[i.qz.ERRORS]:{num_errors:"count()",users_experiencing_errors:"count_unique(user)"},[i.qz.TRANSACTIONS]:{throughput:"count()",trans_duration:"transaction.duration",apdex:"apdex",failure_rate:"failure_rate()",lcp:"measurements.lcp",fid:"measurements.fid",cls:"measurements.cls"},[i.qz.GENERIC_METRICS]:{throughput:"count()",trans_duration:"transaction.duration",apdex:"apdex",failure_rate:"failure_rate()",lcp:"measurements.lcp",fid:"measurements.fid",cls:"measurements.cls"},[i.qz.SESSIONS]:{crash_free_sessions:i.lK.CRASH_FREE_SESSIONS,crash_free_users:i.lK.CRASH_FREE_USERS},[i.qz.METRICS]:{crash_free_sessions:i.lK.CRASH_FREE_SESSIONS,crash_free_users:i.lK.CRASH_FREE_USERS}};function a(e){let{aggregate:t,dataset:r}=e;const i=s[r],a=Object.entries(i).find((e=>{let[r,i]=e;return i&&t.includes(i)}));return a&&a[0]||"custom"}}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_metric_details_index_tsx.5636e7c3c49e59820787bb9679bcb998.js.map