(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js"],{"./app/utils/slugify.tsx":(e,t,n)=>{"use strict";function r(e){return e.normalize("NFKD").toLowerCase().replace(" ","-").replace(/[^a-z0-9-_]/g,"")}n.d(t,{Z:()=>r})},"./app/utils/useMembers.tsx":(e,t,n)=>{"use strict";n.d(t,{L:()=>d});var r=n("../node_modules/react/index.js"),s=n("../node_modules/lodash/uniqBy.js"),o=n.n(s),i=n("./app/stores/memberListStore.tsx"),a=n("./app/stores/organizationStore.tsx"),l=n("./app/stores/useLegacyStore.tsx"),c=n("./app/utils/parseLinkHeader.tsx"),u=n("./app/utils/useApi.tsx");async function m(e,t){let{emails:n,ids:r,search:s,limit:o,lastSearch:i,cursor:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l={};void 0!==r&&r.length>0&&(l.query=r.map((e=>`user.id:${e}`)).join(" ")),void 0!==n&&n.length>0&&(l.query=n.map((e=>`email:${e}`)).join(" ")),s&&(l.query=`${l.query??""} ${s}`.trim()),(i===s||!i&&!s)&&a&&(l.cursor=a),void 0!==o&&(l.per_page=o);let u=!1,m=null;const[d,,p]=await e.requestPromise(`/organizations/${t}/members/`,{includeAllArgs:!0,query:l}),h=p?.getResponseHeader("Link");if(h){const e=(0,c.Z)(h);u=e?.next?.results,m=e?.next?.cursor}return{results:d,hasMore:u,nextCursor:m}}function d(){let{ids:e,emails:t,limit:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,u.Z)(),{organization:c}=(0,l.X)(a.Z),d=(0,l.X)(i.Z),p=c?.slug,[h,f]=(0,r.useState)(new Set),[g,y]=(0,r.useState)(new Set),b=(0,r.useMemo)((()=>new Set(d.members.map((e=>e.id)))),[d.members]),x=(0,r.useMemo)((()=>e?.filter((e=>!b.has(e)&&!h.has(e)))??[]),[e,h,b]),Z=(0,r.useMemo)((()=>new Set(d.members.map((e=>e.email)))),[d.members]),v=(0,r.useMemo)((()=>t?.filter((e=>!Z.has(e)&&!g.has(e)))??[]),[t,g,Z]),w=v.length>0||x.length>0,_=!w&&d.members.length>0,[k,M]=(0,r.useState)({initiallyLoaded:_,fetching:!1,hasMore:d.hasMore,lastSearch:null,nextCursor:d.cursor,fetchError:null}),S=(0,r.useCallback)((async function(){if(void 0!==p){M((e=>({...e,fetching:!0})));try{const{results:e,hasMore:t,nextCursor:r}=await m(s,p,{ids:x,emails:v,limit:n}),a=e.map((e=>e.user)).filter((e=>null!==e)),l=o()([...a,...d.members],(e=>{let{id:t}=e;return t})),c=x.filter((t=>!e.some((e=>e.user?.id===t))));c.length>0&&f((e=>new Set([...e,...c])));const u=v.filter((t=>!e.some((e=>e.user?.email===t))));u.length>0&&y((e=>new Set([...e,...u]))),i.Z.loadInitialData(l),M((e=>({...e,hasMore:t,fetching:!1,initiallyLoaded:!0,nextCursor:r})))}catch(e){console.error(e),M((t=>({...t,fetching:!1,initiallyLoaded:!0,fetchError:e})))}}}),[s,v,x,n,p,d.members]),j=(0,r.useCallback)((async function(e){const t=k.lastSearch,r=e?k.nextCursor:d.cursor;if(void 0!==p){M((e=>({...e,fetching:!0})));try{s.clear();const{results:a,hasMore:l,nextCursor:c}=await m(s,p,{search:e,limit:n,lastSearch:t,cursor:r}),u=a.map((e=>e.user)).filter((e=>null!==e)),h=o()([...d.members,...u],(e=>{let{email:t}=e;return t}));e?h.length>d.members.length&&i.Z.loadInitialData(h):i.Z.loadInitialData(h,l,c),M((t=>({...t,hasMore:l&&d.hasMore,fetching:!1,lastSearch:e??null,nextCursor:c})))}catch(e){console.error(e),M((t=>({...t,fetching:!1,fetchError:e})))}}else console.error("Cannot fetch members without an organization in context")}),[s,n,p,k.lastSearch,k.nextCursor,d.cursor,d.hasMore,d.members]),C=(0,r.useCallback)((function(e){return""!==e?j(e):(k.hasMore===d.hasMore&&k.nextCursor===d.cursor||M((t=>({...t,lastSearch:e,hasMore:d.hasMore,nextCursor:d.cursor}))),Promise.resolve())}),[j,k.hasMore,k.nextCursor,d.cursor,d.hasMore]);return(0,r.useEffect)((()=>{w&&S()}),[w,S]),{members:(0,r.useMemo)((()=>t||e?d.members.filter((n=>t?.includes(n.email)||e?.includes(n.id))):d.members),[t,d.members,e]),fetching:k.fetching||d.loading,initiallyLoaded:k.initiallyLoaded,fetchError:k.fetchError,hasMore:k.hasMore??d.hasMore,onSearch:C,loadMore:j}}},"./app/views/monitors/components/monitorForm.tsx":(e,t,n)=>{"use strict";n.d(t,{G:()=>V,Z:()=>U});var r=n("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),i=n("../node_modules/mobx-react-lite/es/index.js"),a=n("./app/components/alert.tsx"),l=n("./app/components/alertLink.tsx"),c=n("./app/components/forms/fields/numberField.tsx"),u=n("./app/components/forms/fields/radioField.tsx"),m=n("./app/components/forms/fields/selectField.tsx"),d=n("./app/components/avatar/index.tsx"),p=n("./app/locale.tsx"),h=n("./app/utils/useMembers.tsx"),f=n("./app/utils/useTeams.tsx"),g=n("./app/components/forms/formContext.tsx"),y=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function b(e){let{avatarSize:t=20,placeholder:n=(0,p.t)("Choose Teams and Members"),...r}=e;const{form:s}=(0,o.useContext)(g.Z),i=s?.getValue(r.name,[]),a=(0,o.useMemo)((()=>i?.filter((e=>e.startsWith("member:"))).map((e=>e.slice(7)))),[i]);(0,h.L)({ids:a});const{members:l,fetching:c,onSearch:u,loadMore:b}=(0,h.L)(),x=l?.map((e=>({value:`member:${e.id}`,label:e.name,leadingItems:(0,y.tZ)(d.Z,{user:e,size:t})}))),Z=(0,o.useMemo)((()=>i?.filter((e=>e.startsWith("team:"))).map((e=>e.slice(5)))),[i]);(0,f.y)({ids:Z});const{teams:v,fetching:w,onSearch:_,loadMore:k}=(0,f.y)({provideUserTeams:!0}),M=v?.map((e=>({value:`team:${e.id}`,label:e.name,leadingItems:(0,y.tZ)(d.Z,{team:e,size:t})})));return(0,o.useEffect)((()=>{b(),k()}),[]),(0,y.tZ)(m.Z,{placeholder:n,allowClear:!0,onInputChange:e=>{u(e),_(e)},isLoading:c||w,options:[{label:(0,p.t)("Members"),options:x},{label:(0,p.t)("Teams"),options:M}],...r})}b.displayName="SentryMemberTeamSelectorField";const x=b;var Z=n("./app/components/forms/fields/sentryProjectSelectorField.tsx"),v=n("./app/components/forms/fields/textField.tsx"),w=n("./app/components/forms/form.tsx"),_=n("./app/components/forms/model.tsx"),k=n("./app/components/links/externalLink.tsx"),M=n("./app/components/list/index.tsx"),S=n("./app/components/list/listItem.tsx"),j=n("./app/components/text.tsx"),C=n("./app/data/timezones.tsx"),E=n("./app/styles/space.tsx"),I=n("./app/utils/isActiveSuperuser.tsx"),R=n("./app/utils/slugify.tsx"),T=n("./app/utils/theme.tsx"),q=n("./app/utils/usePageFilters.tsx"),A=n("./app/utils/useProjects.tsx"),N=n("./app/utils/withDomainRequired.tsx"),L=n("./app/views/monitors/utils.tsx"),z=n("./app/views/monitors/types.tsx");const D=[[z.Ix.CRONTAB,(0,p.t)("Crontab")],[z.Ix.INTERVAL,(0,p.t)("Interval")]],O="cron_job",B={team:"Team",member:"Member"},F={Team:"team",Member:"member"},V=30;function $(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,r]=t;if(e.config??={},e.alertRule??={},"alertRule.targets"===n){const t=r?.map((e=>{const[t,n]=e.split(":");return{targetType:B[t],targetIdentifier:Number(n)}}));return e.alertRule.targets=t,e}if("alertRule.environment"===n){const t=""===r?void 0:r;return e.alertRule.environment=t,e}return"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[1,"hour"]),Array.isArray(e.config.schedule)&&"config.schedule.frequency"===n?(e.config.schedule[0]=parseInt(r,10),e):Array.isArray(e.config.schedule)&&"config.schedule.interval"===n?(e.config.schedule[1]=r,e):n.startsWith("config.")?(e.config[n.substring(7)]=r,e):(e[n]=r,e)}),{})}function P(e){if(void 0===e.config)return e;const{config:t,...n}=e;return{...n,...Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;return[`config.${t}`,n]})))}}function X(e){let{monitor:t,submitLabel:n,apiEndpoint:s,apiMethod:c,onSubmitSuccess:m}=e;const d=(0,o.useRef)(new _.Z({transformData:$,mapFormErrors:P})),{projects:h}=(0,A.Z)(),{selection:f}=(0,q.Z)(),g=f.projects[0],b=g?h.find((e=>e.id===g+"")):null,x=(0,I.M)(),Z=h.filter((e=>x||e.isMember)),v=t?.alertRule?.targets.map((e=>`${F[e.targetType]}:${e.targetIdentifier}`)),M=[{label:"All Environments",value:""},...b?.environments.map((e=>({value:e,label:e})))??[]];return(0,y.tZ)(w.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:s,apiMethod:c,model:d.current,initialData:t?{name:t.name,slug:t.slug,type:t.type??O,project:t.project.slug,"alertRule.targets":v,"alertRule.environment":t.alertRule?.environment,...function(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):(n["config.schedule"]=t.schedule,n["config.timezone"]=t.timezone)),n}(t.type,t.config)}:{project:b?b.slug:null,type:O},onSubmitSuccess:m,submitLabel:n,children:(0,y.BX)(K,{symbol:"colored-numeric",children:[(0,y.tZ)(Q,{children:(0,p.t)("Add a name and project")}),(0,y.tZ)(te,{children:(0,p.t)("The monitor name will show up in alerts and notifications")}),(0,y.BX)(ne,{children:[(0,y.tZ)(W,{name:"name",placeholder:(0,p.t)("My Cron Job"),required:!0,stacked:!0,inline:!1}),t&&(0,y.tZ)(W,{name:"slug",help:(0,p._N)("The [strong:monitor-slug] is used to uniquely identify your monitor within your organization. Changing this slug will require updates to any instrumented check-in calls.",{strong:(0,y.tZ)("strong",{})}),placeholder:(0,p.t)("monitor-slug"),required:!0,stacked:!0,inline:!1,transformInput:R.Z}),(0,y.tZ)(G,{name:"project",projects:Z,placeholder:(0,p.t)("Choose Project"),disabled:!!t,disabledReason:(0,p.t)("Existing monitors cannot be moved between projects"),valueIsSlug:!0,required:!0,stacked:!0,inline:!1})]}),(0,y.tZ)(Q,{children:(0,p.t)("Choose your schedule type")}),(0,y.tZ)(te,{children:(0,p._N)("You can use [link:the crontab syntax] or our interval schedule.",{link:(0,y.tZ)(k.Z,{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,y.tZ)(ne,{children:(0,y.tZ)(u.Z,{name:"config.schedule_type",choices:D,defaultValue:z.Ix.CRONTAB,orientInline:!0,required:!0,stacked:!0,inline:!1})}),(0,y.tZ)(Q,{children:(0,p.t)("Choose your schedule")}),(0,y.tZ)(te,{children:(0,p.t)("How often you expect your recurring jobs to run.")}),(0,y.BX)(ne,{children:[void 0!==t&&(0,y.tZ)(a.ZP,{type:"info",children:(0,p.t)("Any changes you make to the execution schedule will only be applied after the next expected check-in.")}),(0,y.tZ)(i.Qj,{children:()=>{const e=d.current.getValue("config.schedule_type"),t="crontab"===e?(0,L.Zf)(d.current.getValue("config.schedule")?.toString()??""):null;return"crontab"===e?(0,y.BX)(re,{columns:"1fr 2fr",children:[(0,y.tZ)(W,{name:"config.schedule",placeholder:"* * * * *",defaultValue:"0 0 * * *",css:(0,r.iv)({input:{fontFamily:T.ZP.text.familyMono}},"",""),required:!0,stacked:!0,inline:!1}),(0,y.tZ)(J,{name:"config.timezone",defaultValue:"UTC",options:C.f,required:!0,stacked:!0,inline:!1}),t&&(0,y.BX)(se,{children:['"',t,'"']})]}):"interval"===e?(0,y.BX)(re,{columns:"auto 1fr 2fr",children:[(0,y.tZ)(ee,{children:(0,p.t)("Every")}),(0,y.tZ)(H,{name:"config.schedule.frequency",placeholder:"e.g. 1",defaultValue:"1",required:!0,stacked:!0,inline:!1}),(0,y.tZ)(J,{name:"config.schedule.interval",options:(n=Number(d.current.getValue("config.schedule.frequency")??1),[{value:"minute",label:(0,p.tn)("minute","minutes",n)},{value:"hour",label:(0,p.tn)("hour","hours",n)},{value:"day",label:(0,p.tn)("day","days",n)},{value:"week",label:(0,p.tn)("week","weeks",n)},{value:"month",label:(0,p.tn)("month","months",n)},{value:"year",label:(0,p.tn)("year","years",n)}]),defaultValue:"day",required:!0,stacked:!0,inline:!1})]}):null;var n}})]}),(0,y.tZ)(Q,{children:(0,p.t)("Set a missed status")}),(0,y.tZ)(te,{children:(0,p.t)("The number of minutes we'll wait before we consider a check-in as missed.")}),(0,y.tZ)(ne,{children:(0,y.tZ)(H,{name:"config.checkin_margin",placeholder:"Defaults to 0 minutes",stacked:!0,inline:!1})}),(0,y.tZ)(Q,{children:(0,p.t)("Set a failed status")}),(0,y.tZ)(te,{children:(0,p.t)("The number of minutes a check-in is allowed to run before it's considered failed.")}),(0,y.tZ)(ne,{children:(0,y.tZ)(H,{name:"config.max_runtime",placeholder:`Defaults to ${V} minutes`,stacked:!0,inline:!1})}),(0,y.BX)(o.Fragment,{children:[(0,y.tZ)(Q,{children:(0,p.t)("Notify members")}),(0,y.tZ)(te,{children:(0,p.t)("Tell us who to notify when a check-in reaches the thresholds above or has an error. You can send notifications to members or teams.")}),(0,y.BX)(ne,{children:[t?.config.alert_rule_id&&(0,y.tZ)(l.Z,{priority:"muted",to:(0,N.D)(`/alerts/rules/${t.project.slug}/${t.config.alert_rule_id}/`),children:(0,p.t)("Customize this monitors notification configuration in Alerts")}),(0,y.BX)(re,{columns:"5fr 3fr",children:[(0,y.tZ)(Y,{name:"alertRule.targets",multiple:!0,stacked:!0,inline:!1,menuPlacement:"auto"}),(0,y.tZ)(J,{name:"alertRule.environment",options:M,stacked:!0,inline:!1,menuPlacement:"auto",defaultValue:""})]})]})]})]})})}X.displayName="MonitorForm";const U=X,K=(0,s.Z)(M.Z,{target:"epnopid11"})({name:"yrf9ut",styles:"width:600px"}),H=(0,s.Z)(c.Z,{target:"epnopid10"})({name:"1hcx8jb",styles:"padding:0"}),J=(0,s.Z)(m.Z,{target:"epnopid9"})({name:"1hcx8jb",styles:"padding:0"}),W=(0,s.Z)(v.Z,{target:"epnopid8"})({name:"1hcx8jb",styles:"padding:0"}),G=(0,s.Z)(Z.Z,{target:"epnopid7"})({name:"1hcx8jb",styles:"padding:0"}),Y=(0,s.Z)(x,{target:"epnopid6"})({name:"1hcx8jb",styles:"padding:0"}),Q=(0,s.Z)(S.Z,{target:"epnopid5"})("font-size:",(e=>e.theme.fontSizeExtraLarge),";font-weight:bold;line-height:1.3;"),ee=(0,s.Z)(j.Z,{target:"epnopid4"})("font-weight:bold;color:",(e=>e.theme.subText),";"),te=(0,s.Z)(ee,{target:"epnopid3"})("font-weight:normal;padding-left:",(0,E.D)(4),";"),ne=(0,s.Z)("div",{target:"epnopid2"})("padding-left:",(0,E.D)(4),";margin-top:",(0,E.D)(1),";margin-bottom:",(0,E.D)(4),";display:flex;flex-direction:column;gap:",(0,E.D)(1),";"),re=(0,s.Z)("div",{target:"epnopid1"})("display:grid;align-items:center;gap:",(0,E.D)(1),";grid-template-columns:",(e=>e.columns),";"),se=(0,s.Z)(ee,{target:"epnopid0"})("font-weight:normal;font-size:",(e=>e.theme.fontSizeExtraSmall),";font-family:",(e=>e.theme.text.familyMono),";grid-column:auto/span 2;")},"./app/views/monitors/types.tsx":(e,t,n)=>{"use strict";let r,s,o,i;n.d(t,{Ix:()=>s,NI:()=>i,wo:()=>o}),function(e){e.UNKNOWN="unknown",e.CRON_JOB="cron_job"}(r||(r={})),function(e){e.CRONTAB="crontab",e.INTERVAL="interval"}(s||(s={})),function(e){e.OK="ok",e.ERROR="error",e.DISABLED="disabled",e.ACTIVE="active",e.MISSED_CHECKIN="missed_checkin",e.TIMEOUT="timeout"}(o||(o={})),function(e){e.OK="ok",e.ERROR="error",e.IN_PROGRESS="in_progress",e.MISSED="missed",e.TIMEOUT="timeout"}(i||(i={}))},"./app/views/monitors/utils.tsx":(e,t,n)=>{"use strict";n.d(t,{Jc:()=>u,Kg:()=>l,Zf:()=>c});var r=n("../node_modules/cronstrue/dist/cronstrue.js"),s=n.n(r),o=n("./app/locale.tsx"),i=n("./app/utils/dates.tsx"),a=n("./app/views/monitors/types.tsx");function l(e,t){return[`/organizations/${e.slug}/monitors/`,{query:{...t.query,includeNew:!0,per_page:20}}]}function c(e){if(!e)return null;let t;try{t=s().toString(e,{verbose:!1,use24HourTimeFormat:(0,i.gn)()})}catch(e){return null}return t}function u(e){if(e.schedule_type===a.Ix.CRONTAB)return c(e.schedule)??(0,o.t)("Unknown schedule");const[t,n]=e.schedule;return"minute"===n?(0,o.tn)("Every minute","Every %s minutes",t):"hour"===n?(0,o.tn)("Every hour","Every %s hours",t):"day"===n?(0,o.tn)("Every day","Every %s days",t):"week"===n?(0,o.tn)("Every week","Every %s weeks",t):"month"===n?(0,o.tn)("Every month","Every %s months",t):(0,o.t)("Unknown schedule")}},"../node_modules/lodash/groupBy.js":(e,t,n)=>{var r=n("../node_modules/lodash/_baseAssignValue.js"),s=n("../node_modules/lodash/_createAggregator.js"),o=Object.prototype.hasOwnProperty,i=s((function(e,t,n){o.call(e,n)?e[n].push(t):r(e,n,[t])}));e.exports=i}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_components_monitorForm_tsx-node_modules_lodash_groupBy_js.ca828f58560d20f026dc1546e4c83cd5.js.map