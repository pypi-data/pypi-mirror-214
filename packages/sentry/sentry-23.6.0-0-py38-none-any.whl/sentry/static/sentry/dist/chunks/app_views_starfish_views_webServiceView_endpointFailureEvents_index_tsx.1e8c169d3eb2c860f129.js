"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_views_webServiceView_endpointFailureEvents_index_tsx"],{"./app/utils/discover/discoverQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>c,_:()=>a});var s=r("./app/utils/discover/genericDiscoverQuery.tsx"),n=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e,t){return e.transactionName!==t.transactionName||e.transactionThreshold!==t.transactionThreshold||e.transactionThresholdMetric!==t.transactionThresholdMetric}function o(e){return(0,n.tZ)(s.ZP,{route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:r,...s}=e.meta??{};return{...e,meta:{...r,...s}}},...e})}function a(e){const t=(0,s.JC)({route:"events",shouldRefetchData:i,afterFetch:(e,t)=>{const{fields:r,...s}=e.meta??{};return{...e,meta:{...r,...s}}},...e}),r=t.response?.getResponseHeader("Link")??void 0;return{...t,pageLinks:r}}o.displayName="DiscoverQuery";const c=o},"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,r)=>{r.d(t,{AA:()=>y,JC:()=>b,ZP:()=>Z,o:()=>h});var s=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),o=r("./app/api.tsx"),a=r("./app/locale.tsx"),c=r("./app/utils/discover/eventView.tsx"),u=r("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=r("./app/utils/useApi.tsx"),d=r("./app/utils/useOrganization.tsx"),p=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class h{constructor(e,t){(0,s.Z)(this,"message",void 0),(0,s.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class m extends n.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new o.KU}),(0,s.Z)(this,"_shouldRefetchData",(e=>{const t=w(this.props),r=w(e);return!(0,c.ze)(t,r)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,s.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new h(t,e);const r=t?.message;return new h("string"==typeof r?r:(0,a.t)("An unknown error occurred."),e)})),(0,s.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:r,didFetch:s,eventView:n,orgSlug:i,route:o,setError:a}=this.props,{api:c}=this.state;if(!n.isValid())return;const u=`/organizations/${i}/${o}/`,l=Symbol("tableFetchID"),d=w(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(c),c.clear();try{const[t,,n]=await y(c,u,d,{queryBatching:e});if(this.state.tableFetchID!==l)return;const i=r?r(t,this.props):t;s?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:n?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),r=!1===e.eventView.isValid()&&this.props.eventView.isValid(),s=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||r||s)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:r,pageLinks:s}=this.state,n={isLoading:e,error:t,tableData:r,pageLinks:s},i=this.props.children;return i?.(n)}}function g(e){const t=(0,d.Z)({allowNull:!0})?.slug,r=(0,n.useContext)(u.uL)?.eventView,s=e.orgSlug??t,i=e.eventView??r;if(void 0===s||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const o={...e,orgSlug:s,eventView:i};return(0,p.tZ)(m,{...o})}m.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const v=200,f=2,x=e=>new Promise((t=>setTimeout(t,e)));async function y(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:n,retry:i}=s;if(n?.batchRequest)return n.batchRequest(e,t,{query:r,includeAllArgs:!0});const o=i?.baseTimeout??v,a=i?.timeoutMultiplier??f,c=i?.statusCodes??[],u=i?.tries??1;let l,d=0,p=0;for(;d<u&&(!l||c.includes(l.status));){p>0&&await x(p);try{return d++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...r}})}catch(e){l=e,p=o*a**(d-1)}}throw l}function w(e){const{cursor:t,limit:r,noPagination:s,referrer:n,getRequestPayload:i,eventView:o,location:a,forceAppendRawQueryString:c}=e,u=i?i(e):o.getEventsAPIPayload(a,c);return t&&(u.cursor=t),r&&(u.per_page=r),s&&(u.noPagination=s),n&&(u.referrer=n),Object.assign(u,e.queryExtras??{}),u}function b(e){const t=(0,l.Z)(),{orgSlug:r,route:s,options:n}=e,o=`/organizations/${r}/${s}/`,a=w(e),c=(0,i.a)([s,a],(()=>y(t,o,a,{queryBatching:e.queryBatching})),n);return{...c,data:c.data?.[0]??void 0,statusCode:c.data?.[1]??void 0,response:c.data?.[2]??void 0}}const Z=g},"./app/utils/performance/contexts/pageError.tsx":(e,t,r)=>{r.d(t,{De:()=>u,V_:()=>a,YY:()=>c});var s=r("../node_modules/react/index.js"),n=r("./app/components/alert.tsx"),i=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const o=(0,s.createContext)({pageError:void 0,setPageError:e=>{}});function a(e){let{children:t}=e;const[r,n]=(0,s.useState)();return(0,i.tZ)(o.Provider,{value:{pageError:r,setPageError:n},children:t})}function c(){const{pageError:e}=(0,s.useContext)(o);return e?(0,i.tZ)(n.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}a.displayName="PageErrorProvider",c.displayName="PageErrorAlert";const u=()=>(0,s.useContext)(o)},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,r)=>{r.d(t,{bq:()=>n,uL:()=>o});var s=r("./app/utils/performance/contexts/utils.tsx");const[n,i,o]=(0,s.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,r)=>{r.d(t,{n:()=>n}),r("../node_modules/core-js/modules/es.error.cause.js");var s=r("../node_modules/react/index.js");function n(e){const{strict:t=!0,errorMessage:r=`useContext for "${e.name}" must be inside a Provider with a value`,name:n}=e,i=(0,s.createContext)(void 0);return i.displayName=n,[i.Provider,function(){const e=(0,s.useContext)(i);if(!e&&t)throw new Error(r);return e},i]}},"./app/views/starfish/views/webServiceView/endpointFailureEvents/index.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>D});var s=r("./app/components/layouts/thirds.tsx"),n=r("./app/utils/performance/contexts/pageError.tsx"),i=r("./app/utils/useOrganization.tsx"),o=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=r("../node_modules/react/index.js"),c=r("./app/components/gridEditable/index.tsx"),u=r("./app/components/links/link.tsx"),l=r("./app/components/pagination.tsx"),d=r("./app/constants/index.tsx"),p=r("./app/locale.tsx"),h=r("./app/styles/space.tsx"),m=r("./app/utils/discover/discoverQuery.tsx"),g=r("./app/utils/discover/eventView.tsx"),v=r("./app/utils/discover/fieldRenderers.tsx"),f=r("./app/utils/discover/fields.tsx"),x=r("./app/utils/queryString.tsx"),y=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=[{key:"id",name:"Event ID",width:300},{key:"http.status_code",name:"HTTP Status Code",width:300},{key:"timestamp",name:"Timestamp"}];function b(e){let{organization:t,location:r,httpOp:s,transactionName:n}=e;const{query:i}=r,o=i.start&&i.end,h={name:(0,p.t)("Failure Sample"),projects:[],start:(0,x.ro)(i.start),end:(0,x.ro)(i.end),range:o?void 0:(0,x.ro)(i.statsPeriod)||d.GY,fields:["id","http.status_code","timestamp","project"],query:`transaction:${n} http.method:${s} http.status_code:[500,502,503,504,521]`,orderby:"-timestamp",version:2},b=g.ZP.fromNewQueryWithLocation(h,r);return(0,y.BX)("div",{children:[(0,y.tZ)(E,{children:(0,p.t)("Sample Events")}),(0,y.tZ)(m.Z,{eventView:b,orgSlug:t.slug,location:r,referrer:"api.starfish.failure-event-list",queryExtras:{dataset:"discover"},limit:5,children:e=>{let{pageLinks:s,isLoading:n,tableData:i}=e;return(0,y.BX)(a.Fragment,{children:[(0,y.tZ)(c.ZP,{isLoading:n,data:i?i.data:[],columnOrder:w,columnSortBy:b.getSorts(),grid:{renderHeadCell:e=>function(e,t){const r=(0,f.qG)(t.name,t.type,e);return(0,y.tZ)(Z,{align:r,children:t.name})}(i?.meta,e),renderBodyCell:(e,s)=>function(e,s,n,i){if(!e||!e.meta)return n[s.key];const o=String(s.key),a=(0,v.Js)(o,e.meta,!1)(n,{organization:t,location:r});return"id"===s.key?(0,y.tZ)(u.Z,{to:`/performance/${n.project}:${n.id}`,children:n.id.slice(0,8)}):a}(i,e,s)},location:r}),(0,y.tZ)(l.Z,{pageLinks:s})]})}})]})}b.displayName="EventList";const Z=(0,o.Z)("div",{target:"e17oe96f1"})("display:block;width:100%;white-space:nowrap;",(e=>e.align?`text-align: ${e.align};`:""),";"),E=(0,o.Z)("h5",{target:"e17oe96f0"})("margin-bottom:",(0,h.D)(1),";");function D(e){let{params:t,location:r}=e;const o=function(e){if(!e)return;const t=e.lastIndexOf(":");if(t<0)return;return{httpOp:e.slice(0,t),transactionName:e.slice(t+1)}}(t.slug),a=(0,i.Z)();if(!o)return(0,y.tZ)("div",{children:"ERROR"});const{httpOp:c,transactionName:u}=o||{};return(0,y.tZ)(s.T3,{children:(0,y.BX)(n.V_,{children:[(0,y.tZ)(s.h4,{children:(0,y.tZ)(s.oB,{children:(0,y.BX)(s.Dx,{children:[c," ",u]})})}),(0,y.tZ)(s.uT,{children:(0,y.BX)(s.or,{fullWidth:!0,children:[(0,y.tZ)(n.YY,{}),(0,y.tZ)(b,{httpOp:c,location:r,organization:a,transactionName:u})]})})]})})}D.displayName="EndpointFailureEvents"}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_views_webServiceView_endpointFailureEvents_index_tsx.8a2c83138a4a62c37dc532a906aa0920.js.map