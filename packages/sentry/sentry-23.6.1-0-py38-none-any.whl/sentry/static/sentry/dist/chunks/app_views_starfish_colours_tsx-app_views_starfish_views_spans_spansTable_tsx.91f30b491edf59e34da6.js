"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_starfish_colours_tsx-app_views_starfish_views_spans_spansTable_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,s)=>{s.d(t,{AA:()=>w,JC:()=>b,ZP:()=>_,o:()=>m});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=(s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/react/index.js")),i=s("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),o=s("./app/api.tsx"),a=s("./app/locale.tsx"),p=s("./app/utils/discover/eventView.tsx"),u=s("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=s("./app/utils/useApi.tsx"),c=s("./app/utils/useOrganization.tsx"),d=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class h extends n.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new o.KU}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=x(this.props),s=x(e);return!(0,p.ze)(t,s)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new m(t,e);const s=t?.message;return new m("string"==typeof s?s:(0,a.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:s,didFetch:r,eventView:n,orgSlug:i,route:o,setError:a}=this.props,{api:p}=this.state;if(!n.isValid())return;const u=`/organizations/${i}/${o}/`,l=Symbol("tableFetchID"),c=x(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(p),p.clear();try{const[t,,n]=await w(p,u,c,{queryBatching:e});if(this.state.tableFetchID!==l)return;const i=s?s(t,this.props):t;r?.(i),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:n?.getResponseHeader("Link")??e.pageLinks,tableData:i})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),s=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||s||r)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:s,pageLinks:r}=this.state,n={isLoading:e,error:t,tableData:s,pageLinks:r},i=this.props.children;return i?.(n)}}function g(e){const t=(0,c.Z)({allowNull:!0})?.slug,s=(0,n.useContext)(u.uL)?.eventView,r=e.orgSlug??t,i=e.eventView??s;if(void 0===r||void 0===i)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const o={...e,orgSlug:r,eventView:i};return(0,d.tZ)(h,{...o})}h.displayName="_GenericDiscoverQuery",g.displayName="GenericDiscoverQuery";const f=200,v=2,y=e=>new Promise((t=>setTimeout(t,e)));async function w(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:n,retry:i}=r;if(n?.batchRequest)return n.batchRequest(e,t,{query:s,includeAllArgs:!0});const o=i?.baseTimeout??f,a=i?.timeoutMultiplier??v,p=i?.statusCodes??[],u=i?.tries??1;let l,c=0,d=0;for(;c<u&&(!l||p.includes(l.status));){d>0&&await y(d);try{return c++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...s}})}catch(e){l=e,d=o*a**(c-1)}}throw l}function x(e){const{cursor:t,limit:s,noPagination:r,referrer:n,getRequestPayload:i,eventView:o,location:a,forceAppendRawQueryString:p}=e,u=i?i(e):o.getEventsAPIPayload(a,p);return t&&(u.cursor=t),s&&(u.per_page=s),r&&(u.noPagination=r),n&&(u.referrer=n),Object.assign(u,e.queryExtras??{}),u}function b(e){const t=(0,l.Z)(),{orgSlug:s,route:r,options:n}=e,o=`/organizations/${s}/${r}/`,a=x(e),p=(0,i.a)([r,a],(()=>w(t,o,a,{queryBatching:e.queryBatching})),n);return{...p,data:p.data?.[0]??void 0,statusCode:p.data?.[1]??void 0,response:p.data?.[2]??void 0}}const _=g},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,s)=>{s.d(t,{bq:()=>n,uL:()=>o});var r=s("./app/utils/performance/contexts/utils.tsx");const[n,i,o]=(0,r.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,s)=>{s.d(t,{n:()=>n}),s("../node_modules/core-js/modules/es.error.cause.js");var r=s("../node_modules/react/index.js");function n(e){const{strict:t=!0,errorMessage:s=`useContext for "${e.name}" must be inside a Provider with a value`,name:n}=e,i=(0,r.createContext)(void 0);return i.displayName=n,[i.Provider,function(){const e=(0,r.useContext)(i);if(!e&&t)throw new Error(s);return e},i]}},"./app/views/starfish/colours.tsx":(e,t,s)=>{s.d(t,{SQ:()=>n,Tn:()=>i,eO:()=>o});var r=s("./app/constants/chartPalette.tsx");const n=r.$[0][0],i=(r.$[3][1],r.$[3][3]),o=r.$[5][3]},"./app/views/starfish/components/tableCells/timeSpentCell.tsx":(e,t,s)=>{s.d(t,{z:()=>a});var r=s("./app/components/tooltip.tsx"),n=s("./app/utils/formatters.tsx"),i=s("./app/views/starfish/views/spans/types.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function a(e){let{timeSpentPercentage:t,totalSpanTime:s}=e;const a=(0,i.g)("timeSpent",s),p=t>1?1:t;return(0,o.tZ)("span",{children:(0,o.tZ)(r.u,{isHoverable:!0,title:a,children:(0,n.rl)(p)})})}a.displayName="TimeSpentCell"},"./app/views/starfish/utils/useSpansQuery.tsx":(e,t,s)=>{s.d(t,{bB:()=>c}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/es.array.push.js");var r=s("../node_modules/moment/moment.js"),n=s.n(r),i=s("./app/utils/discover/discoverQuery.tsx"),o=s("./app/utils/discover/eventView.tsx"),a=s("./app/utils/discover/genericDiscoverQuery.tsx"),p=s("./app/utils/useLocation.tsx"),u=s("./app/utils/useOrganization.tsx");const l="YYYY-MM-DDTHH:mm:ss";function c(e){let{eventView:t,initialData:s,limit:r,enabled:n,referrer:i="use-spans-query",cursor:o}=e;const a=function(e){let{isTimeseriesQuery:t}=e;return t?d:m}({isTimeseriesQuery:(t?.yAxis?.length??0)>0});if(t)return a({eventView:t,initialData:s,limit:r,enabled:n,referrer:i,cursor:o});throw new Error("eventView argument must be defined when Starfish useDiscover is true")}function d(e){let{eventView:t,enabled:s,initialData:r,referrer:n,cursor:i}=e;const l=(0,p.T)(),c=(0,u.Z)(),{isLoading:d,data:m}=(0,a.JC)({route:"events-stats",eventView:t,location:l,orgSlug:c.slug,getRequestPayload:()=>({...t.getEventsAPIPayload(l),yAxis:t.yAxis,topEvents:t.topEvents,excludeOther:0,partial:1,orderby:t.sorts?.[0]?(0,o.uZ)(t.sorts?.[0]):void 0,interval:t.interval,cursor:i}),options:{enabled:s,refetchOnWindowFocus:!1},referrer:n});return{isLoading:d,data:d&&r?r:h(m,t)}}function m(e){let{eventView:t,initialData:s,enabled:r,referrer:n,limit:o,cursor:a}=e;const l=(0,p.T)(),c=(0,u.Z)(),{isLoading:d,data:m,pageLinks:h}=(0,i._)({eventView:t,orgSlug:c.slug,location:l,referrer:n,cursor:a,limit:o,options:{enabled:r,refetchOnWindowFocus:!1}});return{isLoading:d,data:d&&s?s:m?.data,pageLinks:h}}function h(e,t){if(!t.yAxis)return[];let s=[];const r=t.yAxis&&("string"==typeof t.yAxis||1===t.yAxis.length),i="string"==typeof t.yAxis?t.yAxis:t.yAxis[0];return e.data?g(e,r?i:"count"):(Object.keys(e).forEach((t=>{e[t].data?s=f(s,g(e[t],r?i:t)):Object.keys(e[t]).forEach((r=>{"order"!==r&&(s=f(s,g(e[t][r],r,t)))}))})),s.map((e=>({...e,interval:n()(1e3*parseInt(e.interval,10)).format(l)}))))}function g(e,t,s){const r=[];return e.data.forEach((e=>{let[n,[{count:i}]]=e;const o=r.find((e=>e.interval===n&&(!s||e.group===s)));o?o[t]=i:r.push({interval:n,[t]:i,group:s})})),r}function f(e,t){const s=JSON.parse(JSON.stringify(e));return t.forEach((e=>{let{interval:t,group:r,...n}=e;const i=s.find((e=>e.interval===t&&(!r||e.group===r)));i?Object.keys(n).forEach((e=>{i[e]=n[e]})):s.push({interval:t,group:r,...n})})),s}},"./app/views/starfish/views/spans/spansTable.tsx":(e,t,s)=>{s.d(t,{Z:()=>T});var r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/react/index.js")),i=s("../node_modules/react-router/es/index.js"),o=s("../node_modules/@sentry/utils/esm/object.js"),a=s("./app/components/gridEditable/index.tsx"),p=s("./app/components/gridEditable/sortLink.tsx"),u=s("./app/components/links/link.tsx"),l=s("./app/components/pagination.tsx"),c=s("./app/utils/queryString.tsx"),d=s("./app/utils/useLocation.tsx"),m=s("./app/views/starfish/components/tableCells/durationCell.tsx"),h=s("./app/views/starfish/components/tableCells/throughputCell.tsx"),g=s("./app/views/starfish/components/tableCells/timeSpentCell.tsx"),f=s("../node_modules/lodash/omit.js"),v=s.n(f),y=s("./app/utils.tsx"),w=s("./app/utils/discover/eventView.tsx"),x=s("./app/utils/discover/types.tsx"),b=s("./app/views/starfish/types.tsx"),_=s("./app/views/starfish/utils/useSpansQuery.tsx"),S=s("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx");const{SPAN_SELF_TIME:k}=b.SpanMetricsFields,L=["span.op","span.domain","span.action"],j=function(e,t,s,r,n){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"use-span-list",o=arguments.length>6?arguments[6]:void 0;const a=D(e,(0,d.T)(),t,s,r),{isLoading:p,data:u,pageLinks:l}=(0,_.bB)({eventView:a,initialData:[],limit:n,referrer:i,cursor:o});return{isLoading:p,data:u,pageLinks:l}};function D(e,t,s,r,n){const i=function(e,t,s,r){const{query:n}=t,i=Object.keys(n).filter((e=>L.includes(e))).filter((e=>Boolean(n[e]))).map((e=>`${e}:${n[e]}`));return e!==b.rA.ALL&&i.push(`span.module:${e}`),(0,y.ri)(r)&&(r===S.sZ?i.push("!has:span.category"):"Other"!==r&&i.push(`span.category:${r}`)),s&&i.push(`transaction:${s}`),i}(e,t,s,r).filter(Boolean).join(" ");return w.ZP.fromNewQueryWithLocation({name:"",query:i,fields:["span.op","span.group","span.description","span.domain","sps()","sps_percent_change()",`sum(${k})`,`p95(${k})`,"time_spent_percentage()",`percentile_percent_change(${k}, 0.95)`],orderby:n,dataset:x.as.SPANS_METRICS,projects:[1],version:2},v()(t,"span.category"))}var A=s("./app/views/starfish/views/spans/types.tsx"),E=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z="spansCursor",{SPAN_SELF_TIME:C}=b.SpanMetricsFields;function T(e){let{moduleName:t,orderBy:s,onSetOrderBy:r,columnOrder:p,spanCategory:f,endpoint:v,limit:y=25}=e;const w=(0,d.T)(),x=(0,c.ro)(w.query?.[Z]),{isLoading:_,data:S,pageLinks:k}=j(t??b.rA.ALL,void 0,f,s,y,"use-span-list",x);return(0,E.BX)(n.Fragment,{children:[(0,E.tZ)(a.ZP,{isLoading:_,data:S,columnOrder:p??V(t),columnSortBy:s?[]:[{key:s,order:"desc"}],grid:{renderHeadCell:P(s,r),renderBodyCell:(e,t)=>function(e,t,s){return"span.description"===e.key?(0,E.tZ)($,{children:t["span.group"]?(0,E.tZ)(u.Z,{to:`/starfish/span/${t["span.group"]}${s?`?${(0,o._j)({endpoint:s})}`:""}`,children:t["span.description"]||"<null>"}):t["span.description"]||"<null>"}):"time_spent_percentage()"===e.key?(0,E.tZ)(g.z,{timeSpentPercentage:t["time_spent_percentage()"],totalSpanTime:t[`sum(${C})`]}):"sps()"===e.key?(0,E.tZ)(h.Z,{throughputPerSecond:t["sps()"],delta:t["sps_percent_change()"]}):"p95(span.self_time)"===e.key?(0,E.tZ)(m.Z,{milliseconds:t["p95(span.self_time)"],delta:t["percentile_percent_change(span.self_time, 0.95)"]}):t[e.key]}(e,t,v)},location:w}),(0,E.tZ)(l.Z,{pageLinks:k,onCursor:(e,t,s)=>{i.browserHistory.push({pathname:t,query:{...s,[Z]:e}})}})]})}function P(e,t){return function(s){return(0,E.tZ)(p.Z,{align:"left",canSort:!0,direction:e===s.key?"desc":void 0,onClick:()=>{t(`${s.key}`)},title:s.name,generateSortLink:()=>({...location})})}}function V(e){const t=function(e){return e===b.rA.HTTP?"URL":e===b.rA.DB?"Query":"Description"}(e),s=function(e){return e===b.rA.HTTP?"Host":e===b.rA.DB?"Table":"Domain"}(e);return[{key:"span.op",name:"Operation",width:120},{key:"span.description",name:t,width:a.z7},...e!==b.rA.ALL?[{key:"span.domain",name:s,width:a.z7}]:[],{key:"sps()",name:"Throughput",width:175},{key:`p95(${C})`,name:A.F.p95,width:175},{key:"time_spent_percentage()",name:A.F.timeSpent,width:a.z7}]}T.displayName="SpansTable";const $=(0,r.Z)("span",{target:"e5rrkpr0"})({name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_starfish_colours_tsx-app_views_starfish_views_spans_spansTable_tsx.f3729751659ca352c2aa9933ca4466da.js.map