"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx"],{"./app/utils/performance/contexts/pageError.tsx":(e,t,a)=>{a.d(t,{De:()=>d,V_:()=>i,YY:()=>p});var s=a("../node_modules/react/index.js"),r=a("./app/components/alert.tsx"),n=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const o=(0,s.createContext)({pageError:void 0,setPageError:e=>{}});function i(e){let{children:t}=e;const[a,r]=(0,s.useState)();return(0,n.tZ)(o.Provider,{value:{pageError:a,setPageError:r},children:t})}function p(){const{pageError:e}=(0,s.useContext)(o);return e?(0,n.tZ)(r.bZ,{type:"error","data-test-id":"page-error-alert",showIcon:!0,children:e}):null}i.displayName="PageErrorProvider",p.displayName="PageErrorAlert";const d=()=>(0,s.useContext)(o)},"./app/views/starfish/components/chartPanel.tsx":(e,t,a)=>{a.d(t,{Z:()=>i});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(a("../node_modules/react/index.js"),a("./app/components/panels/index.tsx")),n=a("./app/styles/space.tsx"),o=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{title:t,children:a,button:s}=e;return(0,o.tZ)(r.s_,{children:(0,o.BX)(r.N,{withPadding:!0,children:[t&&(0,o.BX)(d,{children:[t&&(0,o.tZ)(p,{children:t}),s]}),a]})})}i.displayName="ChartPanel";const p=(0,s.Z)("p",{target:"e1tvnfsq1"})((e=>e.theme.text.cardTitle),";"),d=(0,s.Z)("div",{target:"e1tvnfsq0"})("padding:0 ",(0,n.D)(1)," 0 0;min-height:36px;width:100%;display:flex;align-items:center;justify-content:space-between;")},"./app/views/starfish/views/spans/spansView.tsx":(e,t,a)=>{a.d(t,{Z:()=>W});var s=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=a("../node_modules/react/index.js"),n=a("./app/components/datePageFilter.tsx"),o=a("./app/styles/space.tsx"),i=a("./app/utils/useLocation.tsx"),p=a("./app/views/starfish/types.tsx"),d=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react-router/es/index.js")),l=a("./app/components/compactSelect/index.tsx"),u=a("./app/locale.tsx"),m=a("./app/utils/discover/eventView.tsx"),c=a("./app/utils/discover/types.tsx"),h=a("./app/utils/usePageFilters.tsx"),v=a("./app/views/starfish/utils/useSpansQuery.tsx"),y=a("./app/views/starfish/views/webServiceView/spanGroupBreakdownContainer.tsx"),g=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function f(e){let{value:t="",moduleName:a=p.rA.ALL,spanCategory:s}=e;const{selection:r}=(0,h.Z)(),n=(0,i.T)(),o=function(e,t,a){const s=[];return e&&s.push('!span.action:""'),a&&(a===y.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),m.ZP.fromSavedQuery({name:"",fields:["span.action","count()"],orderby:"-count",query:s.join(" "),dataset:c.as.SPANS_METRICS,start:t.datetime.start??void 0,end:t.datetime.end??void 0,range:t.datetime.period??void 0,projects:[1],version:2})}(a,r,s),u=a===p.rA.HTTP,{data:f}=(0,v.bB)({eventView:o,initialData:[],enabled:!u}),w=u?x:[{value:"",label:"All"},...f.map((e=>({value:e["span.action"],label:e["span.action"]})))];return(0,g.tZ)(l.Z,{triggerProps:{prefix:Z[a]},value:t,options:w??[],onChange:e=>{d.browserHistory.push({...n,query:{...n.query,"span.action":e.value}})}})}f.displayName="ActionSelector";const x=[{value:"",label:"All"},...["GET","POST","PUT","DELETE"].map((e=>({value:e,label:e})))],Z={http:(0,u.t)("HTTP Method"),db:(0,u.t)("SQL Command"),none:(0,u.t)("Action"),"":(0,u.t)("Action")};function w(e){let{value:t="",moduleName:a=p.rA.ALL,spanCategory:s}=e;const{selection:r}=(0,h.Z)(),n=(0,i.T)(),o=function(e,t,a){const s=['!span.domain:""'];return e&&s.push(`span.module:${e}`),a&&(a===y.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),m.ZP.fromSavedQuery({name:"",fields:["span.domain","count()"],orderby:"-count",query:s.join(" "),dataset:c.as.SPANS_METRICS,start:t.datetime.start??void 0,end:t.datetime.end??void 0,range:t.datetime.period??void 0,projects:[1],version:2})}(a,r,s),{data:u}=(0,v.bB)({eventView:o,initialData:[]}),f=[{value:"",label:"All"},...u.map((e=>({value:e["span.domain"],label:e["span.domain"]})))];return(0,g.tZ)(l.Z,{triggerProps:{prefix:b[a]},value:t,options:f??[],onChange:e=>{d.browserHistory.push({...n,query:{...n.query,"span.domain":e.value}})}})}w.displayName="DomainSelector";const b={http:(0,u.t)("Host"),db:(0,u.t)("Table"),none:(0,u.t)("Domain"),"":(0,u.t)("Domain")};function C(e){let{value:t="",moduleName:a=p.rA.ALL,spanCategory:s}=e;const{selection:r}=(0,h.Z)(),n=(0,i.T)(),o=function(e,t,a){const s=[];return e&&s.push(`span.module:${e}`),a&&(a===y.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),m.ZP.fromSavedQuery({name:"",fields:["span.op","count()"],orderby:"-count",query:s.join(" "),start:t.datetime.start??void 0,end:t.datetime.end??void 0,range:t.datetime.period??void 0,dataset:c.as.SPANS_METRICS,projects:[1],version:2})}(a,r,s),{data:f}=(0,v.bB)({eventView:o,initialData:[]}),x=[{value:"",label:"All"},...f.map((e=>({value:e["span.op"],label:e["span.op"]})))];return(0,g.tZ)(l.Z,{triggerProps:{prefix:(0,u.t)("Operation")},value:t,options:x??[],onChange:e=>{d.browserHistory.push({...n,query:{...n.query,"span.op":e.value}})}})}C.displayName="SpanOperationSelector";var T=a("../node_modules/moment/moment.js"),_=a.n(T),N=a("./app/components/charts/utils.tsx"),A=a("./app/views/starfish/colours.tsx"),P=a("./app/views/starfish/components/chart.tsx"),S=a("./app/views/starfish/components/chartPanel.tsx"),j=a("./app/views/starfish/utils/chartValueFormatters/formatThroughput.ts"),L=a("./app/views/starfish/utils/getDateFilters.tsx");function q(e,t,a,s,r){if(!e?.data?.length)return e;r||(r=0);const n=e.data[0],o=e.data[e.data.length-1],i=_()(n.name).creationData().format?.toString();if(!i)return e;const p=[],d=a&&D(a),l=s&&D(s),u=[...d&&d.diff(_()(n.name))<0?[{value:r,name:d.format(i)}]:[],...e.data,...l&&l.diff(_()(o.name))>0?[{value:r,name:l.format(i)}]:[]];let m,c,h,v,y;for(let e=0;e<u.length-1;e++){for(0===e&&p.push({...u[e],name:_()(u[e].name).format(i)}),m=u[e],c=u[e+1],h=_()(m.name),v=_()(c.name),y=_().duration(v.diff(h));y.asMilliseconds()>t.asMilliseconds();)h.add(t),p.push({value:r,name:_()(h).format(i)}),y=_().duration(_()(c.name).diff(h));p.push({...c,name:_()(c.name).format(i)})}return{...e,data:p}}function D(e){const t=e.hour(),a=e.clone().startOf("day");return t<12?a:a.add(12,"hour")}const E=e=>{const t=(0,i.T)(),a=(0,h.Z)(),s={id:void 0,name:"HTTP Module - HTTP error rate",projects:[1],fields:["http_error_count()"],query:e,version:1,topEvents:"5",dataset:c.as.SPANS_METRICS,interval:(0,N.ZS)(a.selection.datetime,"low"),yAxis:["http_error_count()"]},r=m.ZP.fromNewQueryWithLocation(s,t),n=(0,v.bB)({eventView:r,initialData:[]}),o=n?.data?.map((e=>({interval:(0,T.unix)(e.interval).format("YYYY-MM-DDTHH:mm:ss"),"http_error_count()":e["http_error_count()"]})));return{...n,formattedData:o}};var B=a("./app/views/starfish/views/spans/types.tsx");const{SPAN_SELF_TIME:k}=p.SpanMetricsFields;function F(e,t,a){return"http.client"===e?(0,u.t)("%s requests to %s",t,a):"db"===e?(0,u.t)("%s queries on %s",t,a):e||a||void 0}function O(e){let{moduleName:t,appliedFilters:a,spanCategory:s}=e;const{selection:r}=(0,h.Z)(),n=(0,i.T)(),o=Q(t,n,r,a,s),{isLoading:d}=(0,v.bB)({eventView:o,initialData:[]});(0,P.K4)([!d]);const l={[p.rA.ALL]:[{title:B.F.throughput,Comp:V},{title:B.F.p95,Comp:M}],[p.rA.DB]:[],[p.rA.HTTP]:[{title:B.F.errorCount,Comp:$}],[p.rA.NONE]:[]},u=[...l[p.rA.ALL]];return t!==p.rA.ALL&&u.push(...l[t]),(0,g.tZ)(Y,{children:u.map((e=>{let{title:s,Comp:r}=e;return(0,g.tZ)(R,{children:(0,g.tZ)(S.Z,{title:s,children:(0,g.tZ)(r,{moduleName:t,filters:a})})},s)}))})}function V(e){let{moduleName:t,filters:a}=e;const s=(0,h.Z)(),r=(0,i.T)(),n=Q(t,r,s.selection,a),{startTime:o,endTime:p}=(0,L.tZ)(s),d=F(r.query["span.op"],r.query["span.action"],r.query["span.domain"]),{isLoading:l,data:u}=(0,v.bB)({eventView:n,initialData:[]}),m={[d]:u},c=Object.keys(m).map((e=>q({seriesName:d??"Throughput",data:m[e].map((e=>({value:e["sps()"],name:e.interval})))},_().duration(1,"day"),o,p)));return(0,g.tZ)(P.ZP,{statsPeriod:"24h",height:100,data:c,start:"",end:"",loading:l,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[A.SQ],tooltipFormatterOptions:{valueFormatter:e=>(0,j.Z)(e)}})}function M(e){let{moduleName:t,filters:a}=e;const s=(0,h.Z)(),r=(0,i.T)(),n=Q(t,r,s.selection,a),{startTime:o,endTime:p}=(0,L.tZ)(s),d=F(r.query["span.op"],r.query["span.action"],r.query["span.domain"]),{isLoading:l,data:u}=(0,v.bB)({eventView:n,initialData:[]}),m={[d]:u},c=Object.keys(m).map((e=>q({seriesName:d??`p95(${k})`,data:m[e].map((e=>({value:e[`p95(${k})`],name:e.interval})))},_().duration(1,"day"),o,p)));return(0,g.tZ)(P.ZP,{statsPeriod:"24h",height:100,data:[...c],start:"",end:"",loading:l,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[A.Tn]})}function $(e){let{moduleName:t,filters:a}=e;const s=I(t,a),{isLoading:r,data:n}=E(s),o={seriesName:B.F.errorCount,data:n?.length?n?.map((e=>({name:e.interval,value:e["http_error_count()"]}))):[]};return(0,g.tZ)(P.ZP,{statsPeriod:"24h",height:100,data:[o],start:"",end:"",loading:r,utc:!1,grid:{left:"0",right:"0",top:"8px",bottom:"0"},definedAxisTicks:4,stacked:!0,isLineChart:!0,chartColors:[A.eO]})}O.displayName="SpanTimeCharts",V.displayName="ThroughputChart",M.displayName="DurationChart",$.displayName="ErrorChart";const H=["span_operation","domain","action"],Q=(e,t,a,s,r)=>{const n=I(e,s,r);return m.ZP.fromNewQueryWithLocation({name:"",fields:[""],yAxis:["sps()",`p50(${k})`,`p95(${k})`],query:n,dataset:c.as.SPANS_METRICS,projects:[1],interval:(0,N.ZS)(a.datetime,"low"),version:2},t)},I=(e,t,a)=>{const s=Object.keys(t).filter((e=>H.includes(e))).filter((e=>Boolean(t[e]))).map((e=>`${e}:${t[e]}`));return e!==p.rA.ALL&&s.push(`span.module:${e}`),a&&(a===y.sZ?s.push("!has:span.category"):"Other"!==a&&s.push(`span.category:${a}`)),s.join(" ")},Y=(0,s.Z)("div",{target:"e1evs38o1"})("display:flex;flex-direction:row;flex-wrap:wrap;gap:",(0,o.D)(2),";"),R=(0,s.Z)("div",{target:"e1evs38o0"})({name:"82a6rk",styles:"flex:1"});var X=a("./app/views/starfish/views/spans/spansTable.tsx");const G=25;function W(e){const t=(0,i.T)().query,[a,s]=(0,r.useState)({orderBy:"-time_spent_percentage"}),{orderBy:o}=a;return(0,g.BX)(r.Fragment,{children:[(0,g.BX)(U,{children:[(0,g.tZ)(n.Z,{alignDropdown:"left"}),(0,g.tZ)(C,{moduleName:e.moduleName,value:t["span.op"]||"",spanCategory:e.spanCategory}),(0,g.tZ)(w,{moduleName:e.moduleName,value:t["span.domain"]||"",spanCategory:e.spanCategory}),(0,g.tZ)(f,{moduleName:e.moduleName,value:t["span.action"]||"",spanCategory:e.spanCategory})]}),(0,g.tZ)(K,{children:(0,g.tZ)(O,{moduleName:e.moduleName||p.rA.ALL,appliedFilters:t,spanCategory:e.spanCategory})}),(0,g.tZ)(K,{children:(0,g.tZ)(X.Z,{moduleName:e.moduleName||p.rA.ALL,orderBy:o,spanCategory:e.spanCategory,onSetOrderBy:e=>s({orderBy:e}),limit:G})})]})}W.displayName="SpansView";const K=(0,s.Z)("div",{target:"e1ojq8vq1"})("margin:",(0,o.D)(2),";"),U=(0,s.Z)(K,{target:"e1ojq8vq0"})("display:flex;flex-direction:row;gap:",(0,o.D)(1),";margin-bottom:",(0,o.D)(2),";")}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_pageError_tsx-app_views_starfish_views_spans_spansView_tsx.bef85137dde9aa280630c2ebf355af39.js.map