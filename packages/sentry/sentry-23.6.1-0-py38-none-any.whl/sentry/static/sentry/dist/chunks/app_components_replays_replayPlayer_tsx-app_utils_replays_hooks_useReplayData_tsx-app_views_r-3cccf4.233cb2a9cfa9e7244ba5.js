"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_replays_replayPlayer_tsx-app_utils_replays_hooks_useReplayData_tsx-app_views_r-3cccf4"],{"./app/components/replays/replayPlayer.tsx":(e,t,r)=>{r.d(t,{Z:()=>P});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=r("../node_modules/react/index.js"),a=r("../node_modules/@react-aria/utils/dist/import.mjs"),n=r("./app/components/loadingIndicator.tsx"),o=r("./app/icons/index.tsx"),l=r("./app/locale.tsx"),c=r("./app/styles/space.tsx"),d=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function u(e){let{className:t}=e;return(0,d.tZ)(p,{className:t,children:(0,d.BX)(h,{children:[(0,d.tZ)(o.jo,{size:"sm"}),(0,l.t)("Buffering...")]})})}u.displayName="BufferingOverlay";const p=(0,s.Z)("div",{target:"e1339gql1"})({name:"1p9eycc",styles:"user-select:none;display:grid;place-items:center"}),h=(0,s.Z)("div",{target:"e1339gql0"})("display:grid;grid-template-columns:max-content max-content;gap:",(0,c.D)(.75),";place-items:center;padding:",(0,c.D)(3),";background:",(e=>e.theme.gray300),";border-radius:",(e=>e.theme.borderRadius),";color:",(e=>e.theme.white),";z-index:",(e=>e.theme.zIndex.initial),";"),m=u;var g=r("./app/components/tooltip.tsx");function y(e){let{speed:t,className:r}=e;return(0,d.tZ)(b,{className:r,children:(0,d.BX)(f,{title:(0,l.t)("Fast forwarding at %sx",t),children:[(0,l.t)("Fast forwarding through inactivity"),(0,d.tZ)(o.CC,{size:"sm",direction:"right"})]})})}y.displayName="FastForwardBadge";const b=(0,s.Z)("div",{target:"e1a5fqdb1"})({name:"8y7axy",styles:"user-select:none;display:grid;align-items:end;justify-items:start"}),f=(0,s.Z)(g.u,{target:"e1a5fqdb0"})("display:grid;grid-template-columns:max-content max-content;gap:",(0,c.D)(.5),";align-items:center;background:",(e=>e.theme.gray300),";color:",(e=>e.theme.white),";padding:",(0,c.D)(1.5)," ",(0,c.D)(2),";border-top-right-radius:",(e=>e.theme.borderRadius),";z-index:",(e=>e.theme.zIndex.initial),";"),w=y;var x=r("./app/components/replays/replayContext.tsx"),k=r("./app/utils/analytics.tsx"),v=r("./app/utils/useOrganization.tsx"),S=r("./app/components/button.tsx"),Z=r("./app/utils/useDismissAlert.tsx");function N(){const{dismiss:e,isDismissed:t}=(0,Z.Z)({key:"replay-player-dom-alert-dismissed"});return t?null:(0,d.tZ)(I,{"data-test-id":"player-dom-alert",children:(0,d.BX)(D,{children:[(0,d.tZ)(M,{size:"xs"}),(0,d.tZ)("div",{children:(0,l.t)("Right click & inspect your appâ€™s DOM with your browser")}),(0,d.tZ)(C,{priority:"link",size:"sm",icon:(0,d.tZ)(o.bM,{size:"xs"}),"aria-label":(0,l.t)("Close Alert"),onClick:e})]})})}N.displayName="PlayerDOMAlert";const E=N,I=(0,s.Z)("div",{target:"e138qk33"})("position:absolute;bottom:",(0,c.D)(1),";left:0;width:100%;text-align:center;font-size:",(e=>e.theme.fontSizeMedium),";pointer-events:none;"),D=(0,s.Z)("div",{target:"e138qk32"})("display:inline-flex;align-items:flex-start;justify-items:center;padding:",(0,c.D)(1)," ",(0,c.D)(2),";margin:0 ",(0,c.D)(1),";color:",(e=>e.theme.white),";background-color:",(e=>e.theme.blue400),";border-radius:",(e=>e.theme.borderRadius),";gap:0 ",(0,c.D)(1),";line-height:1em;"),M=(0,s.Z)(o.aU,{target:"e138qk31"})({name:"n27fom",styles:"margin-top:1px;min-width:12px"}),C=(0,s.Z)(S.zx,{target:"e138qk30"})("color:",(e=>e.theme.white),";pointer-events:all;&:hover{color:",(e=>e.theme.white),";opacity:0.5;}");function R(e){let{className:t,isPreview:r=!1}=e;const{dimensions:s,fastForwardSpeed:n,initRoot:o,isBuffering:l,isFetching:c}=(0,x.M)(),u=(0,i.useRef)(null),p=(0,i.useRef)(null),[h,m]=(0,i.useState)({width:0,height:0});!function(e){let{videoDimensions:t,windowDimensions:r}=e;const s=(0,v.Z)(),[a,n]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(a||0===t.width&&0===t.height)return;const e=t.width>t.height?"landscape":"portrait",i=Math.min(r.width/t.width,r.height/t.height,1),o=10*Math.floor(10*i);(0,k.Gi)("replay.render-player",{organization:s,aspect_ratio:e,scale_bucket:o}),n(!0)}),[s,r,t,a])}({videoDimensions:s,windowDimensions:h}),(0,i.useEffect)((()=>o(p.current)),[o]);const g=(0,i.useCallback)((()=>m({width:u.current?.clientWidth||0,height:u.current?.clientHeight||0})),[m]);return(0,a.yU)({ref:u,onResize:g}),(0,i.useEffect)((()=>{void 0===window.ResizeObserver&&g()}),[g]),(0,i.useEffect)((()=>{if(p.current){const e=Math.min(h.width/s.width,h.height/s.height,1);e&&(p.current.style["transform-origin"]="top left",p.current.style.transform=`scale(${e})`,p.current.style.width=s.width*e+"px",p.current.style.height=s.height*e+"px")}}),[h,s]),(0,d.BX)(j,{ref:u,className:"sentry-block",children:[(0,d.tZ)("div",{ref:p,className:t}),n?(0,d.tZ)(T,{speed:n}):null,l?(0,d.tZ)(_,{}):null,r?null:(0,d.tZ)(E,{}),c?(0,d.tZ)(A,{}):null]})}R.displayName="BasePlayerRoot";const j=(0,s.Z)("div",{target:"egqkti35"})("width:100%;display:flex;flex-grow:1;justify-content:center;align-items:center;position:relative;overflow:hidden;background-color:",(e=>e.theme.backgroundSecondary),";background-image:repeating-linear-gradient(\n      -145deg,\n      transparent,\n      transparent 8px,\n      ",(e=>e.theme.backgroundSecondary)," 8px,\n      ",(e=>e.theme.backgroundSecondary)," 11px\n    ),repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent 15px,\n      ",(e=>e.theme.gray100)," 15px,\n      ",(e=>e.theme.gray100)," 16px\n    );"),T=(0,s.Z)(w,{target:"egqkti34"})({name:"m4y3yb",styles:"position:absolute;left:0;bottom:0"}),_=(0,s.Z)(m,{target:"egqkti33"})({name:"j2pfbl",styles:"position:absolute;top:0;left:0;right:0;bottom:0"}),A=(0,s.Z)(n.Z,{target:"egqkti32"})({name:"a4hmbt",styles:"position:absolute"}),z=(0,s.Z)(R,{target:"egqkti31"})({name:"1ak6w60",styles:".replayer-wrapper{user-select:none;}.replayer-wrapper>.replayer-mouse{pointer-events:none;}.replayer-wrapper>.replayer-mouse-tail{position:absolute;pointer-events:none;}.replayer-wrapper>iframe{border:none;background:white;pointer-events:initial!important;}"}),P=(0,s.Z)(z,{target:"egqkti30"})(".replayer-mouse{position:absolute;width:32px;height:32px;transition:left 0.05s linear,top 0.05s linear;background-size:contain;background-repeat:no-repeat;background-image:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxMiAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMTZWMEwxMS42IDExLjZINC44TDQuNCAxMS43TDAgMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNOS4xIDE2LjdMNS41IDE4LjJMMC43OTk5OTkgNy4xTDQuNSA1LjZMOS4xIDE2LjdaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNC42NzQ1MSA4LjYxODUxTDIuODMwMzEgOS4zOTI3MUw1LjkyNzExIDE2Ljc2OTVMNy43NzEzMSAxNS45OTUzTDQuNjc0NTEgOC42MTg1MVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik0xIDIuNFYxMy42TDQgMTAuN0w0LjQgMTAuNkg5LjJMMSAyLjRaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K');border-color:transparent;}.replayer-mouse:after{content:'';display:inline-block;width:32px;height:32px;background:",(e=>e.theme.purple300),";border-radius:100%;transform:translate(-50%, -50%);opacity:0.3;}.replayer-mouse.active:after{animation:click 0.2s ease-in-out 1;}.replayer-mouse.touch-device{background-image:none;width:70px;height:70px;border-radius:100%;margin-left:-37px;margin-top:-37px;border:4px solid rgba(73, 80, 246, 0);transition:left 0s linear,top 0s linear,border-color 0.2s ease-in-out;}.replayer-mouse.touch-device.touch-active{border-color:",(e=>e.theme.purple200),";transition:left 0.25s linear,top 0.25s linear,border-color 0.2s ease-in-out;}.replayer-mouse.touch-device:after{opacity:0;}.replayer-mouse.touch-device.active:after{animation:touch-click 0.2s ease-in-out 1;}@keyframes click{0%{opacity:0.3;width:20px;height:20px;}50%{opacity:0.5;width:10px;height:10px;}}@keyframes touch-click{0%{opacity:0;width:20px;height:20px;}50%{opacity:0.5;width:10px;height:10px;}}")},"./app/utils/replays/hooks/useReplayData.tsx":(e,t,r)=>{r.d(t,{Z:()=>N});var s=r("../node_modules/react/index.js"),i=r("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),a=r("./app/utils/parseLinkHeader.tsx"),n=r("./app/utils/replays/replayDataUtils.tsx"),o=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),l=r("../node_modules/lodash/memoize.js"),c=r.n(l),d=r("../node_modules/moment/moment.js"),u=r("./app/types/breadcrumbs.tsx"),p=(r("../node_modules/core-js/modules/es.array.push.js"),r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/replay/index.js")),h=r("../node_modules/@sentry-internal/rrweb/es/rrweb/packages/rrweb/src/types.js"),m=r("../node_modules/lodash/first.js"),g=r.n(m);const y=window.requestIdleCallback||function(e){const t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)};class b{constructor(e){let{crumbs:t,isFinished:r,onFinish:s}=e;(0,o.Z)(this,"crumbs",void 0),(0,o.Z)(this,"isFinished",void 0),(0,o.Z)(this,"onFinish",void 0),(0,o.Z)(this,"nextExtract",null),(0,o.Z)(this,"activities",[]),this.crumbs=t,this.isFinished=r,this.onFinish=s}handler(e,t,r){let{replayer:s}=r;e.type===h.tw.FullSnapshot?this.extractNextCrumb({replayer:s}):e.type===h.tw.IncrementalSnapshot&&(this.extractCurrentCrumb(e,{replayer:s}),this.extractNextCrumb({replayer:s})),this.isFinished(e)&&this.onFinish(this.activities)}extractCurrentCrumb(e,t){let{replayer:r}=t;const s=g()(this.crumbs),i=+new Date(s?.timestamp||"");if(!s||!i||i>e.timestamp)return;const a=f(s,r)||this.nextExtract;a&&this.activities.push({crumb:s,html:a,timestamp:i}),this.nextExtract=null,this.crumbs.shift()}extractNextCrumb(e){let{replayer:t}=e;const r=g()(this.crumbs),s=+new Date(r?.timestamp||"");r&&s&&(this.nextExtract=f(r,t))}}function f(e,t){const r=t.getMirror(),s=e.data?.nodeId||"",i=r.getNode(s);let a=function(e,t){const r=new DOMParser;try{const t=r.parseFromString(e,"text/html"),s=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let i=0;i<t.length;i++){const a=t[i];"STYLE"===a.nodeName&&(a.textContent="/* Inline CSS */"),"svg"===a.nodeName&&(a.innerHTML="\x3c!-- SVG --\x3e"),e<=r?a.childElementCount>0&&(a.innerHTML=`\x3c!-- ${a.childElementCount} descendents --\x3e`):s(e,a.children,r+1)}};return s(2,t.body.children),t.body.innerHTML}catch(t){return e}}(i?.outerHTML||i?.textContent||"");return a.length>1500&&(a=a.substring(0,1500)),a}r("../node_modules/@sentry-internal/rrweb-snapshot/es/rrweb-snapshot.js");class w{static factory(e){let{attachments:t,replayRecord:r,errors:s}=e;if(!t||!r||!s)return null;try{return new w({attachments:t,replayRecord:r,errors:s})}catch(e){return i.Tb(e),new w({attachments:[],errors:[],replayRecord:r})}}constructor(e){let{attachments:t,replayRecord:r,errors:s}=e;(0,o.Z)(this,"rawErrors",void 0),(0,o.Z)(this,"sortedSpans",void 0),(0,o.Z)(this,"replayRecord",void 0),(0,o.Z)(this,"rrwebEvents",void 0),(0,o.Z)(this,"breadcrumbs",void 0),(0,o.Z)(this,"getDurationMs",(()=>this.replayRecord.duration.asMilliseconds())),(0,o.Z)(this,"getReplay",(()=>this.replayRecord)),(0,o.Z)(this,"getRRWebEvents",(()=>this.rrwebEvents)),(0,o.Z)(this,"getCrumbsWithRRWebNodes",c()((()=>this.breadcrumbs.filter((e=>e.data&&"object"==typeof e.data&&"nodeId"in e.data))))),(0,o.Z)(this,"getUserActionCrumbs",c()((()=>{const e=[u.kS.ERROR,u.kS.INIT,u.kS.NAVIGATION,u.kS.UI,u.kS.USER];return this.breadcrumbs.filter((t=>e.includes(t.type)))}))),(0,o.Z)(this,"getConsoleCrumbs",c()((()=>this.breadcrumbs.filter((e=>"console"===e.category))))),(0,o.Z)(this,"getRawErrors",c()((()=>this.rawErrors))),(0,o.Z)(this,"getIssueCrumbs",c()((()=>this.breadcrumbs.filter((e=>"issue"===e.category))))),(0,o.Z)(this,"getNonConsoleCrumbs",c()((()=>this.breadcrumbs.filter((e=>"console"!==e.category))))),(0,o.Z)(this,"getNavCrumbs",c()((()=>this.breadcrumbs.filter((e=>[u.kS.INIT,u.kS.NAVIGATION].includes(e.type)))))),(0,o.Z)(this,"getNetworkSpans",c()((()=>this.sortedSpans.filter(k)))),(0,o.Z)(this,"getMemorySpans",c()((()=>this.sortedSpans.filter(x)))),(0,o.Z)(this,"getDomNodes",c()((()=>{return e={crumbs:this.getCrumbsWithRRWebNodes(),rrwebEvents:this.getRRWebEvents(),finishedAt:this.replayRecord.finished_at},new Promise(((t,r)=>{y((()=>{(function(e){let{crumbs:t,rrwebEvents:r,finishedAt:s}=e;return!t||!r||r.length<2||!s?Promise.reject():new Promise(((e,a)=>{const n=document.createElement("div");n.className="sentry-block";const{style:o}=n;o.position="fixed",o.inset="0",o.width="0",o.height="0",o.overflow="hidden",document.body.appendChild(n);const l=r[r.length-2],c=new p.x(r,{root:n,loadTimeout:1,showWarning:!1,blockClass:"sentry-block",speed:99999,skipInactive:!0,triggerFocus:!1,plugins:[new b({crumbs:t,isFinished:e=>l===e,onFinish:t=>{e(t),setTimeout((()=>{document.body.contains(n)&&document.body.removeChild(n)}),0)}})],mouseTail:!1});try{c.pause(s.getTime())}catch(e){i.Tb(e),a(e)}}))})(e).then(t).catch(r)}),{timeout:2500})}));var e}))),(0,o.Z)(this,"sdkConfig",c()((()=>{const e=this.rrwebEvents.find((e=>e.type===h.tw.Custom&&"options"===e.data.tag));return e?.data?.payload}))),(0,o.Z)(this,"isNetworkDetailsSetup",c()((()=>this.sdkConfig()?this.sdkConfig()?.networkDetailHasUrls:this.getNetworkSpans().some((e=>Object.keys(e.data.request?.headers||{}).length||Object.keys(e.data.response?.headers||{}).length)))));const{rawBreadcrumbs:a,rawRRWebEvents:l,rawNetworkSpans:m,rawMemorySpans:g}=function(e){const t=[],r=[],s=[],i=[];return e.forEach((e=>{if("performanceSpan"===e.data?.tag){const t=e.data?.payload;"memory"===t.op&&i.push(t),(t.op?.startsWith("navigation.")||t.op?.startsWith("resource."))&&s.push(t)}else"breadcrumb"===e.data?.tag?t.push(e?.data?.payload):r.push(e)})),{rawBreadcrumbs:t,rawRRWebEvents:r,rawNetworkSpans:s,rawMemorySpans:i}}(t),f=[...g,...m],{startTimestampMs:w,endTimestampMs:v}=(0,n.iz)(r,l,a,f);r.started_at=new Date(w),r.finished_at=new Date(v),r.duration=(0,d.duration)(r.finished_at.getTime()-r.started_at.getTime()),this.rawErrors=s,this.sortedSpans=(0,n._O)(f),this.breadcrumbs=(0,n.so)(r,s,a,this.sortedSpans),this.rrwebEvents=(0,n.ay)(r,l),this.replayRecord=r}}const x=e=>"memory"===e.op,k=e=>e.op?.startsWith("navigation.")||e.op?.startsWith("resource.");var v=r("./app/utils/useApi.tsx"),S=r("./app/utils/useProjects.tsx");const Z=Object.freeze({fetchError:void 0,fetchingAttachments:!0,fetchingErrors:!0,fetchingReplay:!0}),N=function(e){let{replaySlug:t,orgSlug:r,errorsPerPage:o=50,segmentsPerPage:l=100}=e;const c=function(e){const t=e.split(":");return 2===t.length?t[1]:t[0]}(t),d=(0,S.Z)(),u=(0,v.Z)(),[p,h]=(0,s.useState)(Z),[m,g]=(0,s.useState)([]),[y,b]=(0,s.useState)([]),[f,x]=(0,s.useState)(),k=(0,s.useMemo)((()=>f?d.projects.find((e=>e.id===f.project_id))?.slug??null:null),[f,d.projects]),N=(0,s.useCallback)((async()=>{const e=await u.requestPromise(function(e,t){return`/organizations/${e}/replays/${t}/`}(r,c)),t=(0,n.qC)(e.data);x(t),h((e=>({...e,fetchingReplay:!1})))}),[u,r,c]),E=(0,s.useCallback)((async()=>{if(!f||!k)return;if(!f.count_segments)return void h((e=>({...e,fetchingAttachments:!1})));const e=Math.ceil(f.count_segments/l),t=new Array(e).fill(0).map(((e,t)=>`0:${l*t}:0`));await Promise.allSettled(t.map((e=>{const t=u.requestPromise(`/projects/${r}/${k}/replays/${f.id}/recording-segments/`,{query:{download:!0,per_page:l,cursor:e}});return t.then((e=>{g((t=>(t??[]).concat(...e)))})),t}))),h((e=>({...e,fetchingAttachments:!1})))}),[l,u,r,f,k]),I=(0,s.useCallback)((async()=>{if(!f)return;const e=new Date(f.finished_at);e.setSeconds(e.getSeconds()+1);const t=function(e,t){try{let{orgSlug:r,start:s,end:i,replayId:n,limit:o=50}=t;return async function*(){let t={cursor:"0:0:0",results:!0,href:""};for(;t&&t.results;){const[{data:c},,d]=await(l=t.cursor,async function(e,t){let{orgSlug:r,start:s,end:i,replayId:a,limit:n=50,cursor:o="0:0:0"}=t;return await e.requestPromise(`/organizations/${r}/replays-events-meta/`,{includeAllArgs:!0,query:{start:s.toISOString(),end:i.toISOString(),query:`replayId:[${a}]`,per_page:n,cursor:o}})}(e,{orgSlug:r,replayId:n,start:s,end:i,limit:o,cursor:l})),u=d?.getResponseHeader("Link")??null;t=(0,a.Z)(u)?.next,yield c}var l}()}catch(e){return Promise.reject(e)}}(u,{orgSlug:r,replayId:f.id,start:f.started_at,end:e,limit:o});for await(const e of t)b((t=>[...t,...e||[]]));h((e=>({...e,fetchingErrors:!1})))}),[u,r,f,o]),D=(0,s.useCallback)((e=>{i.Tb(e),h((t=>({...t,fetchError:e})))}),[]),M=(0,s.useCallback)((()=>N().catch(D)),[N,D]);(0,s.useEffect)((()=>{M()}),[M]),(0,s.useEffect)((()=>{p.fetchError||I().catch(D)}),[p.fetchError,I,D]),(0,s.useEffect)((()=>{p.fetchError||E().catch(D)}),[p.fetchError,E,D]);const C=(0,s.useMemo)((()=>w.factory({attachments:m,errors:y,replayRecord:f})),[m,y,f]);return{replayErrors:y,fetchError:p.fetchError,fetching:p.fetchingAttachments||p.fetchingErrors||p.fetchingReplay,onRetry:M,replay:C,replayRecord:f,projectSlug:k,replayId:c}}},"./app/utils/useDismissAlert.tsx":(e,t,r)=>{r.d(t,{Z:()=>a});var s=r("../node_modules/react/index.js"),i=r("./app/utils/useLocalStorageState.ts");const a=function(e){let{expirationDays:t=Number.MAX_SAFE_INTEGER,key:r}=e;const[a,n]=(0,i.R)(r,(e=>e?String(e):void 0));return{isDismissed:t===Number.MAX_SAFE_INTEGER?Boolean(a):function(e,t){return!(!e||isNaN(e))&&(Date.now()-e)/864e5<t}(Number(a),t),dismiss:(0,s.useCallback)((()=>{n(Date.now().toString())}),[n])}}},"./app/views/replays/detail/layout/fluidHeight.tsx":(e,t,r)=>{r.d(t,{Z:()=>s});const s=(0,r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"eu9w9ak0"})({name:"1i32vcf",styles:"display:flex;flex-direction:column;flex-wrap:nowrap;flex-grow:1;overflow:hidden;height:100%"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_replays_replayPlayer_tsx-app_utils_replays_hooks_useReplayData_tsx-app_views_r-3cccf4.5b9ab32cd5f8db966a16c58aa5f124e4.js.map