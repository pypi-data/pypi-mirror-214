"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx"],{"./app/views/settings/organizationDeveloperSettings/sentryFunctionDetails.tsx":(e,n,t)=>{t.r(n),t.d(n,{default:()=>P}),t("../node_modules/core-js/modules/es.array.push.js");var s=t("../node_modules/react/index.js"),a=t("../node_modules/react-router/es/index.js"),o=t("../node_modules/@monaco-editor/react/lib/es/index.js"),i=t("./app/actionCreators/indicator.tsx"),r=t("./app/components/acl/feature.tsx"),l=t("./app/components/asyncComponent.tsx"),u=t("./app/components/forms/form.tsx"),c=t("./app/components/forms/jsonForm.tsx"),d=t("./app/components/forms/model.tsx"),m=t("./app/components/panels/index.tsx"),p=t("./app/locale.tsx"),g=t("./app/utils/withDomainRequired.tsx"),v=t("./app/utils/withOrganization.tsx"),h=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),y=t("./app/components/button.tsx"),b=t("./app/components/forms/index.tsx"),f=t("./app/icons/index.tsx"),Z=t("./app/styles/space.tsx"),x=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function S(e){const{envVariables:n,setEnvVariables:t}=e;return(0,x.BX)("div",{children:[(0,x.BX)(m.V9,{children:[(0,p.t)("Environment Variables"),(0,x.tZ)(V,{size:"sm",icon:(0,x.tZ)(f.N_,{isCircled:!0}),"aria-label":(0,p.t)("Add Environment Variable"),onClick:()=>{t([...n,{name:"",value:""}])}})]}),(0,x.BX)(C,{children:[(0,x.BX)(F,{children:[(0,x.tZ)(D,{children:(0,p.t)("Name")}),(0,x.tZ)(E,{children:(0,p.t)("Value")})]}),n.map(((e,s)=>(0,x.BX)(F,{children:[(0,x.tZ)(b.nv,{name:`env-variable-name-${s}`,required:!1,inline:!1,defaultValue:e.name,value:e.name,stacked:!0,onChange:e=>((e,s)=>{const a=[...n];for(;a.length<=s;)a.push({name:"",value:""});a[s]={...a[s],name:e},t(a)})(e,s)}),(0,x.tZ)(b.nv,{name:`env-variable-value-${s}`,required:!1,inline:!1,defaultValue:e.value,value:e.value,stacked:!0,onChange:e=>((e,s)=>{const a=[...n];for(;a.length<=s;)a.push({name:"",value:""});a[s]={...a[s],value:e},t(a)})(e,s)}),(0,x.tZ)(_,{children:(0,x.tZ)(V,{size:"sm",icon:(0,x.tZ)(f.Fz,{}),"aria-label":(0,p.t)("Remove Environment Variable %s",s),onClick:()=>(e=>{const s=[...n];s.splice(e,1),t(s)})(s)})})]},s)))]})]})}S.displayName="SentryFunctionEnvironmentVariables";const w=S,F=(0,h.Z)("div",{target:"eeaybgs5"})({name:"1dre63g",styles:"display:grid;grid-template-columns:1fr 1.5fr min-content"}),V=(0,h.Z)(y.zx,{target:"eeaybgs4"})({name:"tjo4qw",styles:"float:right"}),D=(0,h.Z)("div",{target:"eeaybgs3"})("text-align:left;margin-top:",(0,Z.D)(2),";margin-bottom:",(0,Z.D)(1),";color:",(e=>e.theme.gray400),";"),E=(0,h.Z)(D,{target:"eeaybgs2"})("margin-left:-",(0,Z.D)(2),";"),_=(0,h.Z)("div",{target:"eeaybgs1"})("align-items:center;display:flex;margin-bottom:",(0,Z.D)(2),";"),C=(0,h.Z)(m.N,{target:"eeaybgs0"})("padding:",(0,Z.D)(2),";");var z=t("./app/views/settings/organizationDeveloperSettings/constants.tsx"),B=t("./app/views/settings/organizationDeveloperSettings/subscriptionBox.tsx");function $(e){const{events:n,setEvents:t}=e;function s(e,s){s&&!n.includes(e)?t(n.concat(e)):!s&&n.includes(e)&&t(n.filter((n=>n!==e)))}return(0,x.tZ)(k,{children:z.j.map((n=>(0,x.tZ)(B.Z,{disabledFromPermissions:!1,webhookDisabled:!1,checked:e.events.includes(n),resource:n,onChange:s,isNew:"comment"===n},n)))})}$.displayName="SentryFunctionSubscriptions";const j=$,k=(0,h.Z)("div",{target:"e13f5gqz0"})("display:grid;grid-template:auto/1fr 1fr 1fr;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-template:1fr 1fr 1fr/auto;}");function q(e){const n=[];e.onIssue&&n.push("issue"),e.onError&&n.push("error"),e.onComment&&n.push("comment"),delete e.onIssue,delete e.onError,delete e.onComment,e.events=n;const t=[];let s=0;for(;e[`env-variable-name-${s}`];)e[`env-variable-value-${s}`]&&t.push({name:e[`env-variable-name-${s}`],value:e[`env-variable-value-${s}`]}),delete e[`env-variable-name-${s}`],delete e[`env-variable-value-${s}`],s++;e.envVariables=t;const{...a}=e;return a}const N=[{name:"name",type:"string",required:!0,placeholder:"e.g. My Sentry Function",label:"Name",help:"Human readable name of your Sentry Function"},{name:"author",type:"string",placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Sentry Function."},{name:"overview",type:"string",placeholder:"e.g. This Sentry Function does something useful",label:"Overview",help:"A short description of your Sentry Function."}];function X(e){const[n]=(0,s.useState)((()=>new d.Z({transformData:q}))),{functionSlug:t}=e.params,{organization:l,sentryFunction:v}=e,h=t?"PUT":"POST";let y=`/organizations/${l.slug}/functions/`;t&&(y+=`${t}/`);const b=v?v.code:"exports.yourFunction = (req, res) => {\n    let message = req.query.message || req.body.message || 'Hello World!';\n    console.log('Query: ' + req.query);\n    console.log('Body: ' + req.body);\n    res.status(200).send(message);\n  };",[f,Z]=(0,s.useState)(v?.events||[]);(0,s.useEffect)((()=>{n.setValue("onIssue",f.includes("issue")),n.setValue("onError",f.includes("error")),n.setValue("onComment",f.includes("comment"))}),[n,f]);const[S,F]=(0,s.useState)(v?.env_variables?.length?v?.env_variables:[{name:"",value:""}]);return(0,x.tZ)("div",{children:(0,x.BX)(r.Z,{features:["organizations:sentry-functions"],children:[(0,x.tZ)("h2",{children:v?(0,p.t)("Editing Sentry Function"):(0,p.t)("Create Sentry Function")}),(0,x.BX)(u.Z,{apiMethod:h,apiEndpoint:y,model:n,onPreSubmit:()=>{(0,i.E3)((0,p.t)("Saving changes.."))},initialData:{code:b,events:f,envVariables:S,...e.sentryFunction},onSubmitError:e=>{let n=(0,p.t)("Unknown Error");e.status>=400&&e.status<500&&(n=e?.responseJSON.detail??n),(0,i.Iw)(n)},onSubmitSuccess:e=>{(0,i.S9)((0,p.t)("Sentry Function successfully saved.",e.name));const n=`/settings/${l.slug}/developer-settings/sentry-functions/${e.slug}/`;v?(0,i.S9)((0,p.t)("%s successfully saved.",e.name)):(0,i.S9)((0,p.t)("%s successfully created.",e.name)),a.browserHistory.push((0,g.D)(n))},children:[(0,x.tZ)(c.Z,{forms:[{title:(0,p.t)("Sentry Function Details"),fields:N}]}),(0,x.BX)(m.s_,{children:[(0,x.tZ)(m.V9,{children:(0,p.t)("Webhooks")}),(0,x.tZ)(m.N,{children:(0,x.tZ)(j,{events:f,setEvents:Z})})]}),(0,x.tZ)(m.s_,{children:(0,x.tZ)(w,{envVariables:S,setEnvVariables:F})}),(0,x.BX)(m.s_,{children:[(0,x.tZ)(m.V9,{children:(0,p.t)("Write your Code Below")}),(0,x.tZ)(m.N,{children:(0,x.tZ)(o.ZP,{height:"40vh",theme:"light",defaultLanguage:"javascript",defaultValue:b,onChange:function(e,t){n.setValue("code",e)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1}})})]})]})]})})}X.displayName="SentryFunctionDetails";class T extends l.Z{getEndpoints(){const{functionSlug:e}=this.props.params,{organization:n}=this.props;return e?[["sentryFunction",`/organizations/${n.slug}/functions/${e}/`]]:[]}renderBody(){return(0,x.tZ)(X,{sentryFunction:this.state.sentryFunction,...this.props})}}const P=(0,v.Z)(T)}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx.afeff33c2d8ab379aeb6e5a0d69bc11a.js.map