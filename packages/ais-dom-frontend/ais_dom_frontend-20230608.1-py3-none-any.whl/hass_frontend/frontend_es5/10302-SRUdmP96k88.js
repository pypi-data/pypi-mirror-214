"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[10302],{76680:function(e,t,i){function a(e){return void 0===e||Array.isArray(e)?e:[e]}i.d(t,{r:function(){return a}})},349:function(e,t,i){i.d(t,{m:function(){return o}});var a=i(71650),n=i(33368),r=function(){function e(){var t=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.localStorage;(0,a.Z)(this,e),this.storage=void 0,this._storage={},this._listeners={},this.storage=n,i&&window.addEventListener("storage",(function(e){e.key&&t.hasKey(e.key)&&(t._storage[e.key]=e.newValue?JSON.parse(e.newValue):e.newValue,t._listeners[e.key]&&t._listeners[e.key].forEach((function(i){return i(e.oldValue?JSON.parse(e.oldValue):e.oldValue,t._storage[e.key])})))}))}return(0,n.Z)(e,[{key:"addFromStorage",value:function(e){if(!this._storage[e]){var t=this.storage.getItem(e);t&&(this._storage[e]=JSON.parse(t))}}},{key:"subscribeChanges",value:function(e,t){var i=this;return this._listeners[e]?this._listeners[e].push(t):this._listeners[e]=[t],function(){i.unsubscribeChanges(e,t)}}},{key:"unsubscribeChanges",value:function(e,t){if(e in this._listeners){var i=this._listeners[e].indexOf(t);-1!==i&&this._listeners[e].splice(i,1)}}},{key:"hasKey",value:function(e){return e in this._storage}},{key:"getValue",value:function(e){return this._storage[e]}},{key:"setValue",value:function(e,t){this._storage[e]=t;try{void 0===t?this.storage.removeItem(e):this.storage.setItem(e,JSON.stringify(t))}catch(i){}}}]),e}(),s=new r,o=function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;return function(o){var d=i&&!a?s:new r(i,a),l=String(o.key);e=e||String(o.key);var c=o.initializer?o.initializer():void 0;d.addFromStorage(e);var u=function(){return d.hasKey(e)?d.getValue(e):c};return{kind:"method",placement:"prototype",key:o.key,descriptor:{set:function(i){!function(i,a){var n;t&&(n=u()),d.setValue(e,a),t&&i.requestUpdate(o.key,n)}(this,i)},get:function(){return u()},enumerable:!0,configurable:!0},finisher:function(a){if(t&&i){var r=a.prototype.connectedCallback,s=a.prototype.disconnectedCallback;a.prototype.connectedCallback=function(){var t;r.call(this),this["__unbsubLocalStorage".concat(l)]=(t=this,d.subscribeChanges(e,(function(e){t.requestUpdate(o.key,e)})))},a.prototype.disconnectedCallback=function(){s.call(this),this["__unbsubLocalStorage".concat(l)]()}}t&&a.createProperty(o.key,Object.assign({noAccessor:!0},n))}}}}},50239:function(e,t,i){i.d(t,{Y:function(){return n},u:function(){return a}});var a=function(e,t,i){return Math.min(Math.max(e,t),i)},n=function(e,t,i){var a;return a=t?Math.max(e,t):e,a=i?Math.min(a,i):a}},39258:function(e,t,i){i.d(t,{U:function(){return v}});var a=i(55070),n=i(15838),r=i(89525),s=i(58831),o=i(6229),d=i(56007),l=i(22134),c={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};var u=0,h=new Map;function v(e,t,i){return function(e,t,i){var a;if(!i||e===d.nZ)return(0,l.g)("--history-unavailable-color",t);if(e===d.lz)return(0,l.g)("--history-unknown-color",t);var u=(0,o.tD)(i,e);if(u){var h=(0,l.g)(u,t);if(h){var v=(0,s.M)(i.entity_id),k=null===(a=c[v])||void 0===a?void 0:a[e];return k?(0,n.uO)((0,r.C)((0,n.Rw)((0,n.wK)(h)),k)):h}}}(e,t,i)||function(e,t){if(h.has(e))return h.get(e);var i=(0,a.hZ)(u,t);return u++,h.set(e,i),i}(e,t)}},31206:function(e,t,i){i.r(t),i.d(t,{HaCircularProgress:function(){return f}});var a,n=i(88962),r=i(33368),s=i(71650),o=i(82390),d=i(69205),l=i(70906),c=i(91808),u=i(88771),h=i(47838),v=i(30879),k=i(68144),_=i(79932),f=(0,c.Z)([(0,_.Mo)("ha-circular-progress")],(function(e,t){var i=function(t){(0,d.Z)(a,t);var i=(0,l.Z)(a);function a(){var t;(0,s.Z)(this,a);for(var n=arguments.length,r=new Array(n),d=0;d<n;d++)r[d]=arguments[d];return t=i.call.apply(i,[this].concat(r)),e((0,o.Z)(t)),t}return(0,r.Z)(a)}(t);return{F:i,d:[{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"active",value:function(){return!1}},{kind:"field",decorators:[(0,_.Cb)()],key:"alt",value:function(){return"Loading"}},{kind:"field",decorators:[(0,_.Cb)()],key:"size",value:function(){return"medium"}},{kind:"set",key:"density",value:function(e){}},{kind:"get",key:"density",value:function(){switch(this.size){case"tiny":return-8;case"small":return-5;case"medium":default:return 0;case"large":return 5}}},{kind:"set",key:"indeterminate",value:function(e){}},{kind:"get",key:"indeterminate",value:function(){return this.active}},{kind:"get",static:!0,key:"styles",value:function(){return[(0,u.Z)((0,h.Z)(i),"styles",this),(0,k.iv)(a||(a=(0,n.Z)([":host{overflow:hidden}"])))]}}]}}),v.D)},3542:function(e,t,i){i.r(t);var a,n,r,s,o,d,l,c,u=i(53709),h=i(40039),v=i(99312),k=i(81043),_=i(93359),f=i(88962),y=i(33368),g=i(71650),p=i(82390),b=i(69205),m=i(70906),Z=i(91808),w=i(88771),L=i(47838),D=i(59401),V=i(59281),C=i(27088),x=i(70390),P=i(83008),H=i(47538),S=i(79021),B=i(72277),E=i(68144),z=i(79932),I=i(76680),M=i(26410),O=i(349),A=i(83849),U=i(69934),j=i(15493),q=i(87744),N=i(62336),R=(i(51324),i(31206),i(29272),i(10983),i(48932),i(63681),i(57066)),T=i(57292),F=i(74186),J=i(58763),K=i(73826),Q=i(11654),Y=(i(36226),i(2315),(0,Z.Z)(null,(function(e,t){var i,Z=function(t){(0,b.Z)(a,t);var i=(0,m.Z)(a);function a(){var t;(0,g.Z)(this,a),t=i.call(this),e((0,p.Z)(t));var n=new Date;n.setHours(n.getHours()-1,0,0,0),t._startDate=n;var r=new Date;return r.setHours(r.getHours()+2,0,0,0),t._endDate=r,t}return(0,y.Z)(a)}(t);return{F:Z,d:[{kind:"field",decorators:[(0,z.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,z.Cb)({reflect:!0,type:Boolean})],key:"narrow",value:void 0},{kind:"field",decorators:[(0,z.Cb)({reflect:!0,type:Boolean})],key:"rtl",value:function(){return!1}},{kind:"field",decorators:[(0,z.SB)()],key:"_startDate",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_endDate",value:void 0},{kind:"field",decorators:[(0,O.m)("historyPickedValue",!0,!1)],key:"_targetPickerValue",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_isLoading",value:function(){return!1}},{kind:"field",decorators:[(0,z.SB)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_ranges",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_deviceEntityLookup",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_areaEntityLookup",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_areaDeviceLookup",value:void 0},{kind:"field",decorators:[(0,z.SB)()],key:"_showBack",value:void 0},{kind:"field",decorators:[(0,z.IO)("state-history-charts")],key:"_stateHistoryCharts",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"field",key:"_interval",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,w.Z)((0,L.Z)(Z.prototype),"connectedCallback",this).call(this),this.hasUpdated&&this._getHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,w.Z)((0,L.Z)(Z.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"hassSubscribe",value:function(){var e=this;return[(0,F.LM)(this.hass.connection,(function(t){e._deviceEntityLookup=(0,T.pI)(t),e._areaEntityLookup=(0,R.TD)(t)})),(0,T.q4)(this.hass.connection,(function(t){e._areaDeviceLookup=(0,R.Dl)(t)}))]}},{kind:"method",key:"_goBack",value:function(){history.back()}},{kind:"method",key:"render",value:function(){return(0,E.dy)(a||(a=(0,f.Z)([" <ha-top-app-bar-fixed> ",' <div slot="title">',"</div> ",' <ha-icon-button slot="actionItems" @click="','" .disabled="','" .path="','" .label="','"></ha-icon-button> <div class="flex content"> <div class="filters"> <ha-date-range-picker .hass="','" ?disabled="','" .startDate="','" .endDate="','" .ranges="','" @change="','"></ha-date-range-picker> <ha-target-picker .hass="','" .value="','" .disabled="','" addOnTop @value-changed="','"></ha-target-picker> </div> '," </div> </ha-top-app-bar-fixed> "])),this._showBack?(0,E.dy)(n||(n=(0,f.Z)([' <ha-icon-button-arrow-prev slot="navigationIcon" @click="','"></ha-icon-button-arrow-prev> '])),this._goBack):(0,E.dy)(r||(r=(0,f.Z)([' <ha-menu-button slot="navigationIcon" .hass="','" .narrow="','"></ha-menu-button> '])),this.hass,this.narrow),this.hass.localize("panel.history"),this._targetPickerValue?(0,E.dy)(s||(s=(0,f.Z)([' <ha-icon-button slot="actionItems" @click="','" .disabled="','" .path="','" .label="','"></ha-icon-button> '])),this._removeAll,this._isLoading,"M14.76,20.83L17.6,18L14.76,15.17L16.17,13.76L19,16.57L21.83,13.76L23.24,15.17L20.43,18L23.24,20.83L21.83,22.24L19,19.4L16.17,22.24L14.76,20.83M12,12V19.88C12.04,20.18 11.94,20.5 11.71,20.71C11.32,21.1 10.69,21.1 10.3,20.71L8.29,18.7C8.06,18.47 7.96,18.16 8,17.87V12H7.97L2.21,4.62C1.87,4.19 1.95,3.56 2.38,3.22C2.57,3.08 2.78,3 3,3V3H17V3C17.22,3 17.43,3.08 17.62,3.22C18.05,3.56 18.13,4.19 17.79,4.62L12.03,12H12Z",this.hass.localize("ui.panel.history.remove_all")):"",this._getHistory,this._isLoading||!this._targetPickerValue,"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",this.hass.localize("ui.common.refresh"),this.hass,this._isLoading,this._startDate,this._endDate,this._ranges,this._dateRangeChanged,this.hass,this._targetPickerValue,this._isLoading,this._targetsChanged,this._isLoading?(0,E.dy)(o||(o=(0,f.Z)(['<div class="progress-wrapper"> <ha-circular-progress active alt="','"></ha-circular-progress> </div>'])),this.hass.localize("ui.common.loading")):this._targetPickerValue?(0,E.dy)(l||(l=(0,f.Z)([' <state-history-charts .hass="','" .historyData="','" .endTime="','"> </state-history-charts> '])),this.hass,this._stateHistory,this._endDate):(0,E.dy)(d||(d=(0,f.Z)(['<div class="start-search"> '," </div>"])),this.hass.localize("ui.panel.history.start_search")))}},{kind:"method",key:"willUpdate",value:function(e){var t;if((0,w.Z)((0,L.Z)(Z.prototype),"willUpdate",this).call(this,e),!this.hasUpdated){var i=new Date,a=(0,M.Bt)(this.hass.locale),n=(0,D.Z)(i,{weekStartsOn:a}),r=(0,V.Z)(i,{weekStartsOn:a});this._ranges=(t={},(0,_.Z)(t,this.hass.localize("ui.components.date-range-picker.ranges.today"),[(0,C.Z)(),(0,x.Z)()]),(0,_.Z)(t,this.hass.localize("ui.components.date-range-picker.ranges.yesterday"),[(0,P.Z)(),(0,H.Z)()]),(0,_.Z)(t,this.hass.localize("ui.components.date-range-picker.ranges.this_week"),[n,r]),(0,_.Z)(t,this.hass.localize("ui.components.date-range-picker.ranges.last_week"),[(0,S.Z)(n,-7),(0,S.Z)(r,-7)]),t);var s=(0,j.Q2)(),o=s.entity_id,d=s.device_id,l=s.area_id;if((o||d||l)&&(this._targetPickerValue={}),o){var c=o.split(",");this._targetPickerValue.entity_id=c}if(d){var u=d.split(",");this._targetPickerValue.device_id=u}if(l){var h=l.split(",");this._targetPickerValue.area_id=h}var v=s.start_date;v&&(this._startDate=new Date(v));var k=s.end_date;k&&(this._endDate=new Date(k))}}},{kind:"method",key:"firstUpdated",value:function(e){(0,w.Z)((0,L.Z)(Z.prototype),"firstUpdated",this).call(this,e),"1"===(0,j.Q2)().back&&history.length>1&&(this._showBack=!0,(0,A.c)((0,U.q)((0,j.pc)("back")),{replace:!0}))}},{kind:"method",key:"updated",value:function(e){if(this._targetPickerValue&&(e.has("_startDate")||e.has("_endDate")||e.has("_targetPickerValue")||!this._stateHistory&&(e.has("_deviceEntityLookup")||e.has("_areaEntityLookup")||e.has("_areaDeviceLookup")))&&this._getHistory(),e.has("hass")||e.has("_entities")){var t=e.get("hass");t&&t.language===this.hass.language||(this.rtl=(0,q.HE)(this.hass))}}},{kind:"method",key:"_removeAll",value:function(){this._targetPickerValue=void 0,this._updatePath()}},{kind:"method",key:"_getHistory",value:(i=(0,k.Z)((0,v.Z)().mark((function e(){var t,i,a=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._targetPickerValue){e.next=2;break}return e.abrupt("return");case 2:if(this._isLoading=!0,void 0!==(t=this._getEntityIds())){e.next=8;break}return this._isLoading=!1,this._stateHistory=void 0,e.abrupt("return");case 8:if(0!==t.length){e.next=12;break}return this._isLoading=!1,this._stateHistory={line:[],timeline:[]},e.abrupt("return");case 12:this._subscribed&&this._unsubscribeHistory(),i=new Date,this._subscribed=(0,J.Vk)(this.hass,(function(e){a._isLoading=!1,a._stateHistory=(0,J.Nu)(a.hass,e,a.hass.localize)}),this._startDate,this._endDate,t),this._subscribed.catch((function(){a._isLoading=!1,a._unsubscribeHistory()})),this._endDate>i&&this._setRedrawTimer();case 17:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_setRedrawTimer",value:function(){var e=this;clearInterval(this._interval);var t=new Date,i=this._endDate>t?t:this._endDate,a=(0,B.Z)(i,this._startDate);this._interval=window.setInterval((function(){var t;return null===(t=e._stateHistoryCharts)||void 0===t?void 0:t.requestUpdate()}),a<2?1e4:a<10?6e4:N.Q)}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._interval&&(clearInterval(this._interval),this._interval=void 0),this._subscribed&&(this._subscribed.then((function(e){return null==e?void 0:e()})),this._subscribed=void 0)}},{kind:"method",key:"_getEntityIds",value:function(){if(this._targetPickerValue&&void 0!==this._deviceEntityLookup&&void 0!==this._areaEntityLookup&&void 0!==this._areaDeviceLookup){var e=new Set,t=this._targetPickerValue,i=t.area_id,a=t.device_id,n=t.entity_id;if(i){i=(0,I.r)(i);var r,s=(0,h.Z)(i);try{for(s.s();!(r=s.n()).done;){var o=r.value,d=this._areaEntityLookup[o];if(null!=d&&d.length){var l,c=(0,h.Z)(d);try{for(c.s();!(l=c.n()).done;){var v=l.value;null===v.entity_category&&e.add(v.entity_id)}}catch(B){c.e(B)}finally{c.f()}}var k=this._areaDeviceLookup[o];if(null!=k&&k.length){var _,f=(0,h.Z)(k);try{for(f.s();!(_=f.n()).done;){var y=_.value,g=this._deviceEntityLookup[y.id];if(null!=g&&g.length){var p,b=(0,h.Z)(g);try{for(b.s();!(p=b.n()).done;){var m=p.value;m.area_id&&m.area_id!==o||null!==m.entity_category||e.add(m.entity_id)}}catch(B){b.e(B)}finally{b.f()}}}}catch(B){f.e(B)}finally{f.f()}}}}catch(B){s.e(B)}finally{s.f()}}if(a){a=(0,I.r)(a);var Z,w=(0,h.Z)(a);try{for(w.s();!(Z=w.n()).done;){var L=Z.value,D=this._deviceEntityLookup[L];if(null!=D&&D.length){var V,C=(0,h.Z)(D);try{for(C.s();!(V=C.n()).done;){var x=V.value;null===x.entity_category&&e.add(x.entity_id)}}catch(B){C.e(B)}finally{C.f()}}}}catch(B){w.e(B)}finally{w.f()}}if(n){n=(0,I.r)(n);var P,H=(0,h.Z)(n);try{for(H.s();!(P=H.n()).done;){var S=P.value;e.add(S)}}catch(B){H.e(B)}finally{H.f()}}return(0,u.Z)(e)}}},{kind:"method",key:"_dateRangeChanged",value:function(e){this._startDate=e.detail.startDate;var t=e.detail.endDate;0===t.getHours()&&0===t.getMinutes()&&(t.setDate(t.getDate()+1),t.setMilliseconds(t.getMilliseconds()-1)),this._endDate=t,this._updatePath()}},{kind:"method",key:"_targetsChanged",value:function(e){this._targetPickerValue=e.detail.value,this._updatePath()}},{kind:"method",key:"_updatePath",value:function(){var e={};this._targetPickerValue&&(this._targetPickerValue.entity_id&&(e.entity_id=(0,I.r)(this._targetPickerValue.entity_id).join(",")),this._targetPickerValue.area_id&&(e.area_id=(0,I.r)(this._targetPickerValue.area_id).join(",")),this._targetPickerValue.device_id&&(e.device_id=(0,I.r)(this._targetPickerValue.device_id).join(","))),this._startDate&&(e.start_date=this._startDate.toISOString()),this._endDate&&(e.end_date=this._endDate.toISOString()),(0,A.c)("/history?".concat((0,j.ou)(e)),{replace:!0})}},{kind:"get",static:!0,key:"styles",value:function(){return[Q.Qx,(0,E.iv)(c||(c=(0,f.Z)([".content{padding:0 16px 16px;padding-bottom:max(env(safe-area-inset-bottom),16px)}:host([virtualize]){height:100%}.progress-wrapper{position:relative;display:flex;align-items:center;flex-direction:column;padding:16px}.filters{display:flex;align-items:flex-start;margin-top:16px}ha-date-range-picker{margin-right:16px;margin-inline-end:16px;margin-inline-start:initial;max-width:100%;direction:var(--direction)}@media all and (max-width:1025px){.filters{flex-direction:column}ha-date-range-picker{margin-right:0;margin-inline-end:0;width:100%}}.start-search{padding-top:16px;text-align:center;color:var(--secondary-text-color)}"])))]}}]}}),(0,K.f)(E.oi)));customElements.define("ha-panel-history",Y)},46134:function(e,t,i){i.d(t,{o:function(){return s}});var a=i(99312),n=i(81043),r=i(44281),s=function(){var e=(0,n.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,r.j)();case 2:return e.next=4,Promise.all([i.e(51246),i.e(83998)]).then(i.bind(i,83998));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=10302-SRUdmP96k88.js.map