"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{92306:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(40039),o=function(e,t){var n,o={},i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var u=n.value,a=t(u);a in o?o[a].push(u):o[a]=[u]}}catch(s){i.e(s)}finally{i.f()}return o}},81582:function(e,t,n){n.d(t,{DJ:function(){return i},LZ:function(){return r},Nn:function(){return f},Ny:function(){return l},Q4:function(){return o},RQ:function(){return a},SO:function(){return s},T0:function(){return _},iJ:function(){return c},pB:function(){return u}});var r=32143==n.j?["migration_error","setup_error","setup_retry"]:null,o=32143==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,i=function(e,t,n){var r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((function(e){return t(e)}),r)},u=function(e,t){var n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get"},n))},a=function(e,t){return e.callWS({type:"config_entries/get_single",entry_id:t})},s=function(e,t,n){return e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n))},c=function(e,t){return e.callApi("DELETE","config/config_entries/entry/".concat(t))},f=function(e,t){return e.callApi("POST","config/config_entries/entry/".concat(t,"/reload"))},l=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"})},_=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null})}},55424:function(e,t,n){n.d(t,{Bm:function(){return T},Cj:function(){return C},G9:function(){return Q},Jj:function(){return H},KU:function(){return P},P:function(){return W},UB:function(){return A},ZC:function(){return D},_Z:function(){return L},b:function(){return G},gy:function(){return E},iK:function(){return j},jB:function(){return I},o1:function(){return S},rl:function(){return x},vE:function(){return U},xZ:function(){return O},yH:function(){return M}});var r,o,i=n(53709),u=n(68990),a=n(40039),s=n(99312),c=n(81043),f=n(24112),l=n(32182),_=n(79021),y=n(39244),p=n(27088),g=n(83008),d=n(70390),m=n(47538),h=n(59699),v=n(97330),b=n(92306),Z=n(81582),w=n(38014),k=[],T=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},S=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},j=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},x=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},W=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},P=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},C=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},O=function(e){return e.callWS({type:"energy/info"})},E=32143==n.j?(r=(0,c.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}):null,D=function(e){return e.callWS({type:"energy/get_prefs"})},L=32143==n.j?(o=(0,c.Z)((0,s.Z)().mark((function e(t,n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),K(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)}):null,B=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,i){var u,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:u}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),H=function(e){return(0,b.v)(e.energy_sources,(function(e){return e.type}))},M=function(e,t,n){var r,o=[],i=(0,a.Z)(e.energy_sources);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(!n||n.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var s,c=(0,a.Z)(u.flow_from);try{for(c.s();!(s=c.n()).done;){var f=s.value;o.push(f.stat_energy_from),f.stat_cost&&o.push(f.stat_cost);var l=t.cost_sensors[f.stat_energy_from];l&&o.push(l)}}catch(m){c.e(m)}finally{c.f()}var _,y=(0,a.Z)(u.flow_to);try{for(y.s();!(_=y.n()).done;){var p=_.value;o.push(p.stat_energy_to),p.stat_compensation&&o.push(p.stat_compensation);var g=t.cost_sensors[p.stat_energy_to];g&&o.push(g)}}catch(m){y.e(m)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var d=t.cost_sensors[u.stat_energy_from];d&&o.push(d)}else o.push(u.stat_energy_from)}}catch(m){i.e(m)}finally{i.f()}return o},J=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,r,o,c){var p,g,d,m,h,v,b,k,T,S,j,x,W,P,C,E,D,L,H,J,K,A,I,N,Q,U,G,R,q,z,F,V,X,Y,$,ee,te,ne,re,oe,ie,ue,ae,se,ce,fe,le;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,Z.pB)(t,{domain:"co2signal"}),O(t)]);case 2:if(p=e.sent,g=(0,u.Z)(p,2),d=g[0],m=g[1],!(h=d.length?d[0]:void 0)){e.next=21;break}b=0,k=Object.values(t.entities);case 9:if(!(b<k.length)){e.next=21;break}if("co2signal"===(T=k[b]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((S=t.states[T.entity_id])&&"%"===S.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return v=S.entity_id,e.abrupt("break",21);case 18:b++,e.next=9;break;case 21:j=[],x=(0,a.Z)(n.energy_sources);try{for(x.s();!(W=x.n()).done;)if("grid"===(P=W.value).type){C=(0,a.Z)(P.flow_from);try{for(C.s();!(E=C.n()).done;)D=E.value,j.push(D.stat_energy_from)}catch(s){C.e(s)}finally{C.f()}}}catch(s){x.e(s)}finally{x.f()}return L=M(n,m,["grid","solar","battery","gas"]),H=M(n,m,["water"]),J=[].concat((0,i.Z)(L),(0,i.Z)(H)),K=(0,f.Z)(o||new Date,r),A=K>35?"month":K>2?"day":"hour",I=t.config.unit_system.length||"",N={energy:"kWh",volume:"km"===I?"m続":"ft続"},Q={volume:"km"===I?"L":"gal"},U=L.length?(0,w.dL)(t,r,o,L,A,N,["change"]):{},G=H.length?(0,w.dL)(t,r,o,H,A,Q,["change"]):{},F={},V={},c&&(q=K>27&&K<32?(0,l.Z)(r,-1):(0,_.Z)(r,-1*(K+1)),z=(0,y.Z)(r,-1),L.length&&(F=(0,w.dL)(t,q,z,L,A,N,["change"])),H.length&&(V=(0,w.dL)(t,q,z,H,A,Q,["change"]))),void 0!==v&&(X=B(t,r,j,v,o,K>35?"month":K>2?"day":"hour"),c&&(Y=B(t,q,j,v,z,K>35?"month":K>2?"day":"hour"))),$={},ee=J.length?(0,w.Py)(t,J):[],e.next=42,Promise.all([U,G,F,V,ee,X,Y]);case 42:return te=e.sent,ne=(0,u.Z)(te,7),re=ne[0],oe=ne[1],ie=ne[2],ue=ne[3],ae=ne[4],se=ne[5],ce=ne[6],fe=Object.assign(Object.assign({},re),oe),c&&(R=Object.assign(Object.assign({},ie),ue)),J.length&&ae.forEach((function(e){$[e.statistic_id]=e})),le={start:r,end:o,startCompare:q,endCompare:z,info:m,prefs:n,stats:fe,statsMetadata:$,statsCompare:R,co2SignalConfigEntry:h,co2SignalEntity:v,fossilEnergyConsumption:se,fossilEnergyConsumptionCompare:ce},e.abrupt("return",le);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),K=function(e){k.forEach((function(t){var n=A(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];k.push(t.key);var r=(0,v._)(e.connection,n,(0,c.Z)((0,s.Z)().mark((function t(){var n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,D(e);case 3:r.prefs=t.sent;case 4:return r._refreshTimeout&&clearTimeout(r._refreshTimeout),r._active&&(!r.end||r.end>new Date)&&((n=new Date).getMinutes()>=20&&n.setHours(n.getHours()+1),n.setMinutes(20,0,0),r._refreshTimeout=window.setTimeout((function(){return r.refresh()}),n.getTime()-Date.now())),t.abrupt("return",J(e,r.prefs,r.start,r.end,r.compare));case 7:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var i=new Date;r.start=i.getHours()>0?(0,p.Z)():(0,g.Z)(),r.end=i.getHours()>0?(0,d.Z)():(0,m.Z)();var u=function e(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,p.Z)(),r.end=(0,d.Z)(),e()}),(0,h.Z)((0,d.Z)(),1).getTime()-Date.now())};return u(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(e,t){var n;r.start=e,r.end=t,r.start.getTime()!==(0,p.Z)().getTime()||(null===(n=r.end)||void 0===n?void 0:n.getTime())!==(0,d.Z)().getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):u()},r.setCompare=function(e){r.compare=e},r},I=function(e){return e.callWS({type:"energy/solar_forecast"})},N=["volume","energy"],Q=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,a.Z)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=n[i.stat_energy_from];if(N.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(s){o.e(s)}finally{o.f()}},U=function(e,t){var n=Q(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},G=function(e){return"km"===e.config.unit_system.length?"L":"gal"}}}]);
//# sourceMappingURL=55424-8mIUP6Mzi9E.js.map