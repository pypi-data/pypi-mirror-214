var qe=Object.defineProperty;var Ue=(n,t,r)=>t in n?qe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var M=(n,t,r)=>(Ue(n,typeof t!="symbol"?t+"":t,r),r);import{j as Z,r as g,u as Se,a as je,F as Ve,b as Be,c as Ke,d as We,z as Qe,D as Ge,e as ze,k as He,f as Je,g as Xe,h as Ye,i as Ze,l as S,m as b,n as ee,o as et,w as T,A as tt,p as x,q as L,s as Pe,P as H,t as d,v as k,R as nt,x as te,y as $,L as D,B as ne,C as re,E as rt,X as st,S as it,G as at,N as ct,H as ot,I as Le,J as se,K as Re,M as ie,O as ae,Q as ce,T as E,U as N,V as oe,W as C,Y as lt,Z as O,_ as dt,$ as ut,a0 as _e,a1 as ht,a2 as mt,a3 as gt,a4 as le,a5 as U,a6 as ke,a7 as ye,a8 as pt,a9 as xe,aa as ve,ab as $e,ac as ft,ad as yt,ae as xt,af as vt,ag as wt,ah as bt,ai as Nt,aj as Ct,ak as Tt,al as St,am as Pt,an as Lt}from"./vendor-6fdf6ae1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();const R=Z.Fragment,e=Z.jsx,a=Z.jsxs;class Rt extends Error{constructor(r,i){const s=r.status||r.status===0?r.status:"",c=r.statusText||"",l=`${s} ${c}`.trim(),h=l?`status code ${l}`:"an unknown error";super(`Request failed with ${h}`);M(this,"response");M(this,"request");this.name="HTTPError",this.response=r,this.request=i}}const _t=n=>{const t=new URLSearchParams;return Object.entries(n).forEach(([r,i])=>{i!==void 0&&t.set(r,i)}),t};class kt{constructor(t={}){M(this,"config");var r;this.config=t,this.config.baseUrl=(r=this.config.baseUrl)==null?void 0:r.replace(/\/+$/,"")}get baseUrl(){return this.config.baseUrl}async fetch(t){let r,i;if(typeof t=="string")r=t;else{const{url:l,params:h,json:m,...u}=t;if(r=l,i=u,m&&(i.body=JSON.stringify(m),i.headers={"Content-Type":"application/json"}),h){const p=_t(h);r+=`?${p}`}}this.config.baseUrl&&(r=this.config.baseUrl+r);const s=new Request(r,{...i,credentials:"include"}),c=await fetch(s);if(!c.ok)throw new Rt(c,s);return c.headers.get("Content-Type")==="application/json"?await c.json():await c.text()}async fetchForceMethod(t,r){return typeof t=="string"?this.fetch({url:t,method:r}):this.fetch({...t,method:r})}async get(t){return this.fetchForceMethod(t,"get")}async post(t){return this.fetchForceMethod(t,"post")}async put(t){return this.fetchForceMethod(t,"put")}async patch(t){return this.fetchForceMethod(t,"patch")}async delete(t){return this.fetchForceMethod(t,"delete")}}class F{constructor(t,r,i,s,c){this.id=t,this.name=r,this.description=i,this.tasks=s,this.triggers=c}hasTrigger(){return this.triggers.some(t=>!!t.schedule)}getNextFireTime(){const r=this.triggers.filter(i=>!!i.next_fire_time).sort((i,s)=>i.next_fire_time.getTime()-s.next_fire_time.getTime())[0];if(r)return r.next_fire_time}}const $t=`${window.location.protocol}//${window.location.host}/api`,B={}.VITE_API_BASE_URL||$t,P=new kt({baseUrl:B}),Dt=()=>P.baseUrl,Et=async()=>await P.get("/whoami"),Ot=async()=>{await P.post("/logout")},de=()=>{const n=new URL(B);return n.protocol="ws",n.pathname+="/ws",n},It=async()=>{const n=await P.get("/pipelines");return n.forEach(t=>{t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))})}),n.map(t=>new F(t.id,t.name,t.description,t.tasks,t.triggers))},ue=async n=>{const t=await P.get(`/pipelines/${n}`);return t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))}),new F(t.id,t.name,t.description,t.tasks,t.triggers)},Ft=async n=>await P.get(`/pipelines/${n}/input-schema`),he=async(n,t)=>{const r={pipeline_id:n,trigger_id:t},i=await P.get({url:"/runs",params:r});return i.forEach(s=>{s.start_time=new Date(s.start_time)}),i},At=async n=>{const t=await P.get(`/runs/${n}`);return t.start_time=new Date(t.start_time),t},Mt=async n=>{const t=await P.get(`/runs/${n}/logs`);return t?t.split(`
`).map((r,i)=>{const s=JSON.parse(r);return s.id=i,s.timestamp=new Date(s.timestamp),s}):[]},qt=async(n,t)=>await P.get(`/runs/${n}/data/${t}`),z=n=>`${B}/pipelines/${n}/run`,Ut=n=>({async mutationFn(t){await P.post({url:`/pipelines/${n}/run`,json:t})}}),q=(n,t,r=!0)=>`${r?B:""}/pipelines/${n}/triggers/${t}/run`,jt=async(n,t)=>await P.post(q(n,t,!1)),De=g.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),Vt=(n,t)=>{switch(t.type){case"LOGIN":return{...n,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...n,isAuthenticated:!1,user:null};case"POPULATE":return{...n,user:t.payload?{...n.user,...t.payload}:null};case"STOP_LOADING":return{...n,isLoading:!1};default:throw new Error("Unknown action type")}},Bt=({children:n})=>{const[t,r]=g.useReducer(Vt,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await Ot(),r({type:"LOGOUT"})},user:null});return g.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:s,user:c}=await Et();(s&&c||!s)&&r({type:"LOGIN",payload:{user:c,isAuthenticationEnabled:s}})}catch(s){console.error(s)}finally{r({type:"STOP_LOADING"})}})()},[]),e(De.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":n})},me=()=>g.useContext(De),Kt=n=>`translate${n==="bottom"||n==="top"?"Y":"X"}(${n==="bottom"||n==="right"?"-":"+"}10%)`;function Wt({initialOpen:n=!1,placement:t="bottom",modal:r,open:i,onOpenChange:s}={}){const[c,l]=g.useState(n),[h,m]=g.useState(),[u,p]=g.useState(),o=i??c,y=s??l,w=We({placement:t,open:o,onOpenChange:y,whileElementsMounted:Qe,middleware:[Ge(5),ze({fallbackAxisSideDirection:"end"}),He({padding:5})]}),f=w.context,v=Je(f,{enabled:i==null}),_=Xe(f),G=Ye(f),A=Ze([v,_,G]);return g.useMemo(()=>({open:o,setOpen:y,...A,...w,modal:r,labelId:h,descriptionId:u,setLabelId:m,setDescriptionId:p}),[o,y,A,w,r,h,u])}const Ee=g.createContext(null),K=()=>{const n=g.useContext(Ee);if(n==null)throw new Error("Popover components must be wrapped in <Popover />");return n};function Qt({children:n,modal:t=!0,...r}){const i=Wt({modal:t,...r});return e(Ee.Provider,{value:i,children:n})}const Gt=g.forwardRef(function({children:t,asChild:r=!1,...i},s){const c=K(),l=t.ref,h=Se([c.refs.setReference,s,l]);return r&&g.isValidElement(t)?g.cloneElement(t,c.getReferenceProps({ref:h,...i,...t.props,"data-state":c.open?"open":"closed"})):e("button",{ref:h,type:"button","data-state":c.open?"open":"closed",...c.getReferenceProps(i),children:t})}),zt=g.forwardRef(function(t,r){const{context:i,...s}=K(),c=Se([s.refs.setFloating,r]),{isMounted:l,styles:h}=je(i,{initial:({side:m})=>({opacity:0,transform:Kt(m)})});return e(Ve,{children:l&&e(Be,{context:i,modal:s.modal,children:e("div",{ref:c,style:{position:s.strategy,top:s.y??0,left:s.x??0,width:"max-content",...t.style,...h},"aria-labelledby":s.labelId,"aria-describedby":s.descriptionId,...s.getFloatingProps(t),children:t.children})})})});g.forwardRef(function({children:t,...r},i){const{setDescriptionId:s}=K(),c=Ke();return g.useLayoutEffect(()=>(s(c),()=>s(void 0)),[c,s]),e("p",{...r,ref:i,id:c,children:t})});g.forwardRef(function(t,r){const{setOpen:i}=K();return e("button",{type:"button",ref:r,...t,onClick:s=>{var c;(c=t.onClick)==null||c.call(t,s),i(!1)}})});const Ht=()=>{const{logout:n,user:t}=me();if(!t)return e("div",{children:"Not logged in"});const r=t.name.split(" "),i=r.length>1?`${r.at(0)[0]}${r.at(-1)[0]}`:r[0];return a(Qt,{placement:"bottom-start",children:[e(Gt,{children:e("div",{className:"flex justify-center items-center font-medium bg-white ring-1 ring-slate-200 text-indigo-500 rounded-full ml-4 hover:ring-2 transition-shadow",style:{width:34,height:34},children:i})}),e(zt,{children:a(S,{className:"shadow-xl",children:[e(b,{children:t.name}),e(ee,{children:t.email}),e(et,{}),e(T,{size:"xs",variant:"secondary",color:"rose",icon:tt,className:"w-full",onClick:async()=>await n(),children:"Logout"})]})})]})},W=({children:n,header:t})=>{const{isAuthenticated:r,isAuthenticationEnabled:i}=me();return a("div",{className:"bg-slate-50 p-6 sm:p-10 min-h-screen",children:[a(x,{className:"items-start",children:[t&&e("div",{className:"flex-grow max-w-full",children:t}),r&&i&&e(Ht,{})]}),e("main",{children:n})]})},Q=({children:n,footer:t,isOpen:r,maxHeight:i,maxWidth:s="600px",minWidth:c="350px",subtitle:l,title:h,onClose:m})=>{const u=g.createRef();return g.useEffect(()=>{var o,y;r?(o=u.current)==null||o.showModal():(y=u.current)==null||y.close()},[r]),e("dialog",{ref:u,style:{padding:0,background:"transparent",overflow:"visible",maxHeight:i,maxWidth:s,minWidth:c},onClick:o=>{var f;var y=u.current.getBoundingClientRect(),w=y.top<=o.clientY&&o.clientY<=y.top+y.height&&y.left<=o.clientX&&o.clientX<=y.left+y.width;w||(m?m():(f=u.current)==null||f.close())},children:a(S,{children:[h&&e(b,{children:h}),l&&e(ee,{children:l}),e("div",{className:(h||l)&&"mt-6",children:n}),t&&e(x,{className:"justify-end space-x-6 mt-6",children:t})]})})},Jt=n=>{const t=s=>{if(!n.definitions)return;const c=s.split("/").pop();return n.definitions[c]},r=n.properties;if(!r)return e(d,{className:"mt-4",children:"This pipeline has no input"});const i=Object.entries(r).map(([s,c])=>{var o,y,w;if(typeof c=="boolean")return;let l=c,h;if(c.allOf){const f=c.allOf[0];if(h=(o=c.default)==null?void 0:o.toString(),f.$ref){const v=t(f.$ref);v&&(l=v)}}else if(c.$ref){const f=t(c.$ref);f&&(l=f)}else h=(y=l.default)==null?void 0:y.toString();const m=l.title||s,u=(l.enum?"enum":Array.isArray(l.type)?l.type[0]:l.type)||"string",p=(w=n.required)==null?void 0:w.includes(s);if(["number","integer"].includes(u)){const f=l.minimum||l.exclusiveMinimum,v=l.maximum||l.exclusiveMaximum;if(f!==void 0&&v!==void 0){const _=g.createRef(),G=u==="number"?(v-f)/10:1;return a("div",{children:[e(d,{children:m}),e("input",{name:s,type:"range",min:f,max:v,step:G,defaultValue:h,required:p,onInput:A=>_.current&&(_.current.value=A.target.value),className:"w-full mt-2 cursor-ew-resize appearance-none h-2 bg-slate-200 border border-slate-400 rounded"}),a(x,{className:"items-baseline space-x-4",children:[a("div",{className:"ml-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(d,{children:f})]}),e(d,{children:e(k,{children:e("output",{ref:_,className:"px-2 py-1 rounded bg-slate-200 block truncate text-center",children:h})})}),a("div",{className:"mr-1",children:[e("div",{className:"border-r border-slate-300 h-2 w-1"}),e(d,{children:v})]})]})]},s)}else return a("div",{children:[e(d,{children:m}),e("input",{name:s,type:"number",min:f,max:v,defaultValue:h,className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium invalid:border-rose-500 mt-2",style:{textAlign:"end",width:"100%"},required:p})]},s)}else return u==="enum"?a("div",{children:[e(d,{children:m}),a("select",{name:s,defaultValue:h||"",className:"border-gray-300 rounded-md border shadow-sm px-4 py-2 text-sm font-medium w-full invalid:border-rose-500 mt-2",required:p,children:[e("option",{disabled:!0,value:"",children:"Select..."}),l.enum.map(f=>e("option",{value:f.toString(),children:f==null?void 0:f.toString()},f==null?void 0:f.toString()))]})]},s):a("div",{children:[a(d,{children:[m," ",p&&"*"]}),e(nt,{name:s,placeholder:m,defaultValue:h,className:"mt-2"})]},s)});return e("div",{className:"space-y-4",children:i})},ge=({pipeline:n})=>{const[t,r]=g.useState(!1),i=L({queryKey:["pipeline-input",n.id],queryFn:()=>Ft(n.id),enabled:t}),s=Pe(Ut(n.id));return a(R,{children:[e(T,{color:"indigo",variant:"secondary",size:"xs",icon:H,onClick:()=>r(!0),children:"Run"}),e(Q,{isOpen:t,title:`Run ${n.name} manually`,onClose:()=>r(!1),children:a("form",{onSubmit:c=>{c.preventDefault();const l=Object.fromEntries(new FormData(c.target).entries());try{s.mutateAsync(l),r(!1)}catch(h){console.error(h)}},children:[i.isLoading?"Loading...":e("div",{style:{width:350},children:Jt(i.data)}),a(x,{className:"justify-end space-x-6 mt-6",children:[e(T,{type:"button",variant:"secondary",color:"indigo",onClick:()=>{r(!1)},disabled:s.isLoading,children:"Close"}),e(T,{color:"indigo",type:"submit",icon:H,disabled:s.isLoading,children:"Run"})]})]})})]})},Xt=()=>{const n=L({queryKey:["pipelines"],queryFn:It,initialData:[]});if(n.isLoading)return e("div",{children:"Loading..."});if(n.error)return e("div",{children:"An error has occurred"});const t=n.data;return a(S,{children:[e(b,{children:"Pipelines"}),e(te,{children:t.map(r=>{var i;return a($,{className:"gap-x-1",children:[a("div",{className:"min-w-0",children:[e(d,{className:"truncate",children:e(k,{children:e(D,{to:`/pipelines/${r.id}`,children:r.name})})}),r.description&&e(d,{className:"truncate",children:r.description})]}),r.hasTrigger()&&a("div",{className:"min-w-0",title:(i=r.getNextFireTime())==null?void 0:i.toString(),children:[e(d,{className:"truncate",children:"Next fire time"}),e(d,{className:"truncate",children:e(k,{children:ne(r.getNextFireTime(),{addSuffix:!0,includeSeconds:!0})})})]}),e(ge,{pipeline:r})]},r.id)})})]})},j={completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",notrun:"slate",warning:"amber"},J={completed:rt,failed:st,cancelled:it,running:at,notrun:ct,warning:ot},X=["cyan","violet","pink","emerald","orange","stone","fuchsia"],Oe=n=>Object.fromEntries(n.map((t,r)=>[t.id,`bg-${X[r%X.length]}-500`])),we=n=>re(n,"d MMM yyyy HH:mm:ss (XXX)"),Y=n=>re(n,"HH:mm:ss.SSS"),be=n=>re(n,"d MMM yyyy"),Yt=new Intl.NumberFormat,Zt=n=>Yt.format(n),Ie=({status:n})=>e(Le,{color:j[n],icon:J[n],children:n}),en=({startTime:n})=>{const[t,r]=g.useState(Date.now()-n.getTime());return g.useEffect(()=>{const i=setInterval(()=>{r(Date.now()-n.getTime())},500);return()=>{clearInterval(i)}}),e("span",{children:(t/1e3).toFixed(2)})},pe=({pipelineId:n,runs:t,triggerId:r})=>{const[i,s]=g.useState(t),c=se(),l=Re(),{lastJsonMessage:h}=ie(de().toString()),m=g.useCallback(u=>{const{data:p,type:o}=u;if(o==="run-update")if(p.run.start_time=new Date(p.run.start_time),p.run.trigger_id=p.trigger,p.run.status==="running")s([p.run,...i]);else{let y=[...i];const w=y.findIndex(f=>f.id===p.run.id);w>=0?y[w]=p.run:y=[p.run,...y],s(y),c.invalidateQueries({queryKey:["runs",n,r]})}},[n,c,i,r]);return g.useEffect(()=>{h&&m(h)},[h]),g.useEffect(()=>{t.length&&s(t)},[t]),a(S,{children:[e(b,{children:"Runs"}),a(ae,{className:"overflow-auto max-h-[50vh]",children:[e(ce,{className:"sticky top-0 bg-white shadow",children:a(E,{children:[e(N,{className:"text-right",children:"#"}),e(N,{children:"Status"}),!n&&e(N,{children:"Pipeline"}),!r&&e(N,{children:"Trigger"}),e(N,{children:"Started at"}),e(N,{className:"text-right",children:"Duration"})]})}),e(oe,{children:i.map(u=>a(E,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>l(`/pipelines/${u.pipeline_id}/triggers/${u.trigger_id}/runs/${u.id}`),children:[e(C,{className:"text-right",children:u.id}),e(C,{children:e(Ie,{status:u.status})}),!n&&e(C,{children:e(D,{to:`/pipelines/${u.pipeline_id}`,className:"link--arrow",title:"View pipeline details",onClick:p=>p.stopPropagation(),children:u.pipeline_id})}),!r&&e(C,{children:e(D,{to:`/pipelines/${u.pipeline_id}/triggers/${u.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:p=>p.stopPropagation(),children:u.trigger_id})}),e(C,{title:we(u.start_time),children:e(d,{children:lt(new Date,u.start_time)<=1?ne(u.start_time,{addSuffix:!0,includeSeconds:!0}):we(u.start_time)})}),a(C,{className:"text-right",children:[u.status!=="running"?(u.duration/1e3).toFixed(2):e(en,{startTime:u.start_time})," ","s"]})]},u.id))})]})]})},tn=()=>{const n=L({queryKey:["runs",void 0,void 0],queryFn:()=>he(),initialData:[]});return n.isLoading?e("div",{children:"Loading..."}):n.error?e("div",{children:"An error has occurred"}):e(W,{header:e(R,{children:e(b,{children:"Plombery"})}),children:a(O,{numColsMd:2,className:"gap-6 mt-6",children:[e(Xt,{}),n.isLoading?"Loading...":n.isError?"Error loading runs":e(pe,{runs:n.data})]})})},nn=()=>e("div",{className:"h-screen flex justify-center items-center bg-slate-200",children:a(S,{className:"w-auto",children:[e("div",{className:"w-12 rounded-full mx-auto mb-4",children:e("img",{src:"/mario-pipe-flower.png",alt:"Plombery logo"})}),e(b,{className:"mb-6",children:"Welcome to Plombery"}),e(T,{onClick:()=>{location.href=`${Dt()}/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),Fe=({content:n})=>{const[t,r]=g.useState(!1),i=g.useRef();return e(T,{variant:"light",color:"indigo",size:"sm",icon:t?dt:ut,onClick:()=>{navigator.clipboard.writeText(n),r(!0),i.current=setTimeout(()=>r(!1),3e3)}})},I=()=>e(d,{children:"/"}),fe=({pipeline:n,trigger:t,run:r,className:i})=>{if(r&&!t)throw new Error;return a(x,{className:`gap-x-2 justify-start flex-wrap ${i||""}`,children:[e(d,{children:e(D,{to:"/",children:"Pipelines"})}),e(I,{}),e(d,{children:t?e(D,{to:`/pipelines/${n.id}`,children:n.name}):n.name}),t&&a(R,{children:[e(I,{}),e(d,{children:"Triggers"}),e(I,{}),e(d,{children:r?e(D,{to:`/pipelines/${n.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&a(R,{children:[e(I,{}),e(d,{children:"Runs"}),e(I,{}),a(d,{children:["#",r.id]})]})]})},Ne=n=>(n/1e3).toFixed(1)+" s",Ae=({runs:n})=>{const t=n.filter(i=>i.status==="completed").reverse(),r=t.reduce((i,s)=>i+s.duration,0)/t.length||0;return a(S,{children:[e(x,{className:"items-start",children:e(d,{children:"Duration"})}),e(x,{className:"justify-start items-baseline space-x-3 truncate",children:e(_e,{children:Ne(r)})}),e(ht,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:Ne,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},Me=({runs:n,subject:t})=>{var l,h;const i=n.filter(m=>m.status==="completed").length/n.length*100||0,s=(l=n[0])==null?void 0:l.start_time,c=(h=n[n.length-1])==null?void 0:h.start_time;return a(S,{children:[e(x,{children:a(b,{children:[t," health"]})}),n.length?a(R,{children:[a(x,{className:"mt-4",children:[e(d,{children:"Successful runs"}),a(d,{children:[i.toFixed(1)," %"]})]}),e(mt,{className:"mt-2",data:n.map(m=>({key:m.id,color:j[m.status],tooltip:`#${m.id} ${m.status}`}))})]}):e(d,{className:"text-center mt-8",children:a(gt,{children:["This ",t.toLowerCase()," has no runs yet"]})}),a(x,{className:"mt-2",children:[e(d,{children:s&&s.toDateString()}),e(d,{children:c&&c.toDateString()})]})]})},rn=({pipeline:n})=>{const t=Re();return a(S,{children:[e(b,{children:"Triggers"}),a(ae,{children:[e(ce,{children:a(E,{children:[e(N,{children:"Name"}),e(N,{children:"Interval"}),e(N,{children:"Next Fire Time"})]})}),e(oe,{children:n.triggers.map(r=>a(E,{className:"cursor-pointer hover:bg-slate-50 transition-colors",onClick:()=>t(`/pipelines/${n.id}/triggers/${r.id}`),children:[e(C,{children:r.name}),e(C,{children:e(d,{children:r.schedule})}),e(C,{children:ne(n.getNextFireTime(),{includeSeconds:!0,addSuffix:!0})})]},r.id))})]})]})},sn=()=>{const t=le().pipelineId,r=L({queryKey:["pipeline",t],queryFn:()=>ue(t),initialData:new F("","","",[],[]),enabled:!!t}),i=L({queryKey:["runs",t,void 0],queryFn:()=>he(t),initialData:[]});if(i.isLoading||r.isLoading)return e("div",{children:"Loading..."});if(i.error||r.error)return e("div",{children:"An error has occurred"});const s=r.data;return a(W,{header:a("div",{children:[a(x,{className:"items-start",children:[a(x,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[a(b,{className:"truncate max-w-full",children:["Pipeline ",s.name]}),s.description&&a(d,{className:"truncate max-w-full",children:[e("span",{className:"hidden md:inline mx-2",children:"·"}),s.description]})]}),e(ge,{pipeline:s})]}),e(fe,{pipeline:s,className:"mt-4"})]}),children:[a(O,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[a(S,{className:"flex flex-col h-full",children:[e(b,{children:"Tasks"}),e(te,{children:s.tasks.map(c=>e($,{children:a("div",{children:[e(d,{children:e(k,{children:c.name})}),c.description&&e(d,{className:"truncate",children:c.description})]})},c.id))}),e("div",{style:{flexGrow:1}}),a($,{children:[a(x,{className:"justify-start",children:[e(d,{children:"Run URL"}),e(U,{size:"sm",color:"slate",icon:ke,tooltip:"URL to run the pipeline programmatically via an HTTP POST request"})]}),a(x,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:z(t),children:z(t)}),e(Fe,{content:z(t)})]})]})]}),e(Me,{subject:"Pipeline",runs:[...i.data].reverse()}),e(Ae,{runs:i.data})]}),a(O,{numCols:1,numColsSm:1,numColsMd:1,numColsLg:2,className:"gap-6 mt-6",children:[e(ye,{children:e(rn,{pipeline:s})}),e(ye,{children:e(pe,{runs:i.data,pipelineId:t})})]})]})},an=({trigger:n})=>{const[t,r]=g.useState(!1);return a(R,{children:[e(T,{color:"indigo",variant:"light",size:"sm",icon:pt,onClick:()=>r(!0),children:"Show params"}),e(Q,{isOpen:t,title:"Trigger params",subtitle:n.name,footer:e(T,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e("pre",{className:"p-3 bg-slate-100 rounded-md",children:JSON.stringify(n.params,null,2)})})]})},V={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},cn=()=>{const n=le(),t=n.pipelineId,r=n.triggerId,i=L({queryKey:["pipeline",t],queryFn:()=>ue(t),initialData:new F("","","",[],[]),enabled:!!t}),s=L({queryKey:["runs",t,r],queryFn:()=>he(t,r),initialData:[],enabled:!!r}),c=Pe({mutationFn:()=>jt(t,r)});if(s.isLoading||i.isLoading)return e("div",{children:"Loading..."});if(s.error||i.error)return e("div",{children:"An error has occurred"});const l=i.data,h=r===V.id,m=h?V:l.triggers.find(p=>p.id===r);if(!m)return e("div",{children:"Trigger not found"});const u=h?e(ge,{pipeline:l}):e(T,{size:"xs",color:"indigo",variant:"secondary",icon:H,onClick:()=>{c.mutateAsync()},children:"Run"});return a(W,{header:a("div",{children:[a(x,{className:"items-start",children:[a(x,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[a(b,{className:"truncate max-w-full",children:["Trigger ",m.name]}),m.description&&a(d,{className:"truncate max-w-full",children:[e("span",{className:"hidden md:inline mx-2",children:"·"}),m.description]})]}),u]}),e(fe,{pipeline:l,trigger:m,className:"mt-4"})]}),children:[a(O,{numColsMd:2,numColsLg:3,className:"gap-6 mt-6",children:[a(S,{className:"flex flex-col h-full",children:[e(b,{children:m.name}),e(ee,{children:m.description}),e("div",{style:{flexGrow:1}}),a($,{children:[e(d,{children:"Schedule"}),e(d,{children:e(k,{children:m.schedule})})]}),a($,{children:[e(d,{children:"Params"}),m.params?e(an,{trigger:m}):e(d,{children:e("em",{children:"No params"})})]}),a($,{children:[a(x,{className:"justify-start",children:[e(d,{children:"Run URL"}),e(U,{size:"sm",color:"slate",icon:ke,tooltip:"URL to run the trigger programmatically via an HTTP POST request"})]}),a(x,{className:"justify-end",children:[e("div",{className:"bg-slate-100 border-slate-300 rounded border text-slate-500 text-xs truncate px-1 py-0.5 mr-2",style:{maxWidth:200},title:q(t,r),children:q(t,r)}),e(Fe,{content:q(t,r)})]})]})]}),e(Me,{subject:"Trigger",runs:[...s.data].reverse()}),e(Ae,{runs:s.data})]}),e("div",{className:"mt-6",children:e(pe,{runs:s.data,pipelineId:t,triggerId:r})})]})},on=({logEntry:n})=>{const[t,r]=g.useState(!1);return a(x,{className:"mt-1",children:[e(T,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e(Q,{isOpen:t,title:"Traceback info",footer:e(T,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),maxWidth:"80%",onClose:()=>r(!1),children:e("div",{className:"flex flex-col",children:e("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-slate-100 rounded-md whitespace-pre font-mono",children:n.exc_info})})})]})},Ce={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},ln=({pipeline:n,runId:t})=>{const[r,i]=g.useState({levels:[],tasks:[]}),{lastJsonMessage:s}=ie(de().toString()),c=se(),l=L({queryKey:["logs",t],queryFn:()=>Mt(t),enabled:!!t,initialData:[]}),h=g.useCallback(o=>{const{data:y,type:w}=o;w==="logs"&&c.setQueryData(["logs",t],(f=[])=>{const v=JSON.parse(y);return v.id=f.length,v.timestamp=new Date(v.timestamp),[...f,v]})},[t]);g.useEffect(()=>{s&&h(s)},[s]);const m=g.useCallback(o=>{i(y=>({...y,...o}))},[]);if(l.isLoading)return e("div",{children:"Loading..."});if(l.isError)return e("div",{children:"Error loading logs"});const u=l.data.filter(o=>(r.levels.length===0||r.levels.includes(o.level))&&(r.tasks.length===0||r.tasks.includes(o.task))),p=Oe(n.tasks);return a(R,{children:[a(O,{numColsMd:3,className:"gap-6",children:[a("div",{children:[e(d,{children:"Tasks"}),e(xe,{className:"mt-1",onValueChange:o=>{m({tasks:o})},children:n.tasks.map(o=>e(ve,{text:o.name,value:o.id},o.id))})]}),a("div",{children:[e(d,{children:"Log level"}),e(xe,{className:"mt-1",onValueChange:o=>{m({levels:o})},children:Object.keys(Ce).map(o=>e(ve,{text:o,value:o},o))})]})]}),e("div",{className:"logs-table",children:a(ae,{className:"mt-6",children:[e(ce,{children:a(E,{children:[e(N,{children:"Time"}),e(N,{children:"Level"}),e(N,{children:"Task"}),e(N,{children:"Message"})]})}),e(oe,{children:u.map((o,y)=>{const w=y!==0?o.timestamp.getTime()-u[y-1].timestamp.getTime():-1;return a(E,{children:[e(C,{children:a(d,{className:"font-mono text-xs",children:[e("span",{children:Y(o.timestamp)}),w>=0&&a("span",{className:"text-slate-400 ml-2",children:["+",Zt(w)," ms"]})]})}),e(C,{children:e(Le,{size:"xs",color:Ce[o.level],children:o.level})}),e(C,{children:a(x,{children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${p[o.task]}`}),o.task]})}),a(C,{children:[e(d,{children:o.message}),o.exc_info&&e(on,{logEntry:o})]})]},o.id)})})]})})]})},dn="modulepreload",un=function(n){return"/"+n},Te={},hn=function(t,r,i){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(c=>{if(c=un(c),c in Te)return;Te[c]=!0;const l=c.endsWith(".css"),h=l?'[rel="stylesheet"]':"";if(!!i)for(let p=s.length-1;p>=0;p--){const o=s[p];if(o.href===c&&(!l||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":dn,l||(u.as="script",u.crossOrigin=""),u.href=c,document.head.appendChild(u),l)return new Promise((p,o)=>{u.addEventListener("load",p),u.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${c}`)))})})).then(()=>t())},mn=$e.lazy(()=>hn(()=>import("./HandsonTable-1b4bac0d.js"),["assets/HandsonTable-1b4bac0d.js","assets/vendor-6fdf6ae1.js","assets/HandsonTable-c504e472.css"])),gn=({runId:n,taskId:t,open:r,onClose:i})=>{const s=L({queryKey:["getRunData",{runId:n,taskId:t}],queryFn:()=>qt(n,t),enabled:r});return e(R,{children:a(Q,{title:t,subtitle:"View data",isOpen:r,maxWidth:"90%",minWidth:"90%",footer:e(T,{variant:"secondary",color:"indigo",onClick:()=>i(),children:"Close"}),onClose:i,children:[!s.isLoading&&!s.isError&&e(g.Suspense,{fallback:e("div",{children:"Loading..."}),children:e(mn,{data:s.data,rowHeaders:!0,colHeaders:Object.keys(s.data[0]),height:"70vh",width:"100%",licenseKey:"non-commercial-and-evaluation"})}),s.isError&&(s.error.response.status===404?e(d,{children:"The task has no data"}):a(d,{color:"rose",children:["Error fetching task data: ",s.error.message]}))]})})},pn=({pipeline:n,run:t})=>{const[r,i]=g.useState(),s=Oe(n.tasks);return a(S,{children:[e(gn,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>i(void 0)}),e(b,{children:"Tasks"}),e(te,{children:n.tasks.map((c,l)=>{var h;return a($,{className:"space-x-4",children:[t.tasks_run&&t.tasks_run[l]?e(U,{variant:"light",icon:J[t.tasks_run[l].status],color:j[t.tasks_run[l].status]}):e(U,{variant:"light",icon:J.notrun,color:j.notrun}),a("div",{className:"truncate flex-grow",children:[a(x,{className:"justify-start",children:[e("div",{className:`h-2 w-2 mr-2 rounded-full ${s[c.id]}`}),e(d,{className:"truncate",children:e(k,{children:c.name})})]}),c.description&&e(d,{className:"truncate",children:c.description})]}),t.tasks_run&&((h=t.tasks_run[l])==null?void 0:h.has_output)&&e(T,{variant:"light",color:"indigo",size:"xs",icon:ft,onClick:()=>i(c.id),children:"Data"})]},c.id)})})]})},fn=()=>{const{lastJsonMessage:n}=ie(de().toString()),t=se(),r=le(),i=r.pipelineId,s=r.triggerId,c=parseInt(r.runId);g.useEffect(()=>{if(n){const{data:v,type:_}=n;_==="run-update"&&t.invalidateQueries({queryKey:["run",i,s,c]}).catch(()=>{})}},[n,i]);const l=L({queryKey:["pipeline",i],queryFn:()=>ue(i),initialData:new F("","","",[],[]),enabled:!!i}),h=L({queryKey:["run",i,s,c],queryFn:()=>At(c),enabled:!!(i&&s&&c)}),m=l.data,p=s===V.id?V:m.triggers.find(v=>v.id===s),o=h.data;if(!o)return e("div",{children:"Run not found"});if(!p)return e("div",{children:"Trigger not found"});const y=(o.tasks_run||[]).reduce((v,_)=>v+_.duration,0),w=(o.tasks_run||[]).map(v=>y?v.duration/y*100:0),f=yt(o.start_time,o.duration);return a(W,{header:a(R,{children:[a(b,{children:["Run #",c]}),e(fe,{pipeline:m,trigger:p,run:o})]}),children:[a(O,{numColsMd:3,className:"gap-6 mt-6",children:[e(pn,{pipeline:m,run:o}),a(S,{children:[a(x,{className:"items-start",children:[e(d,{children:"Duration"}),e(Ie,{status:o.status})]}),e(x,{className:"justify-start items-baseline space-x-3 truncate",children:a(_e,{children:[(o.duration/1e3).toFixed(1),"s"]})}),e(xt,{categoryPercentageValues:w,colors:X,showLabels:!1,className:"mt-3"}),a(x,{alignItems:"start",className:"mt-2",children:[a("div",{children:[e(d,{children:e(k,{children:Y(o.start_time)})}),e(d,{className:"mt-1",children:be(o.start_time)})]}),a("div",{className:"text-right",children:[e(d,{children:e(k,{children:Y(f)})}),!vt(o.start_time,f)&&e(d,{children:be(f)})]})]})]})]}),e("div",{className:"mt-6",children:e(S,{children:e(ln,{pipeline:m,runId:c})})})]})},yn=({children:n})=>{const{isAuthenticated:t,isLoading:r}=me(),i=wt();return!t&&!r?e(bt,{to:"/login",replace:!0,state:{from:i}}):e(R,{children:n})},xn=Object.assign({"./pages/index.tsx":tn,"./pages/login.tsx":nn,"./pages/pipelines/[pipelineId]/index.tsx":sn,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":cn,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":fn}),vn=Object.entries(xn).map(([n,t])=>{const r=n.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(i=>i.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e(yn,{children:e(t,{})}):e(t,{})}}),wn=()=>e(Nt,{children:vn.map(n=>e(Ct,{path:n.path,element:n.element},n.path))}),bn=new Tt({defaultOptions:{queries:{retry:!1}}});function Nn(){return e(St,{client:bn,children:e(Pt,{children:e(Bt,{children:e(wn,{})})})})}Lt.createRoot(document.getElementById("root")).render(e($e.StrictMode,{children:e(Nn,{})}));export{e as j};
